!function(f){"use strict";function S(){}function v(n){return n}var l=function(t,o){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(o.apply(null,n))}},O=function(n){return function(){return n}};function s(o){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=r.concat(n);return o.apply(null,t)}}function d(t){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!t.apply(null,n)}}function i(n){return function(){throw new Error(n)}}function r(n){return n()}var c=O(!1),u=O(!0),m=(Wr=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"==e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}})("string"),t=Wr("object"),a=Wr("array"),g=Wr("boolean"),p=Wr("function"),h=Wr("number"),y=Object.prototype.hasOwnProperty,b=(Ur=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},o=0;o<n.length;o++){var r,i=n[o];for(r in i)y.call(i,r)&&(t[r]=u(t[r],i[r]))}return t}})(function(n,e){return t(n)&&t(e)?b(n,e):e}),w=Ur(function(n,e){return e}),n=function(){return x},x=(Gr=function(n){return n.isNone()},Gr={fold:function(n,e){return n()},is:c,isSome:c,isNone:u,getOr:o,getOrThunk:e,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:O(null),getOrUndefined:O(void 0),or:o,orThunk:e,map:n,each:S,bind:n,exists:c,forall:u,filter:n,equals:Gr,equals_:Gr,toArray:function(){return[]},toString:O("none()")},Object.freeze&&Object.freeze(Gr),Gr);function e(n){return n()}function o(n){return n}function T(n,t){return He(n,function(n,e){return{k:e,v:t(n,e)}})}function k(t){var o,r=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return r||(r=!0,o=t.apply(null,n)),o}}function C(n,e){return function(){return e===n}}function E(n,e){return function(){return e===n}}function D(n,e){return n=n,e=e,-1<mt.call(n,e)}function I(n,e){for(var t=0,o=n.length;t<o;t++)e(n[t],t)}function A(n,e){for(var t=[],o=0,r=n.length;o<r;o++){var i=n[o];e(i,o)&&t.push(i)}return t}function M(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t)}(n,function(n){t=e(t,n)}),t}function F(n,e,t){return I(n,function(n){t=e(t,n)}),t}function R(n,e){for(var t=0,o=n.length;t<o;t++){var r=n[t];if(e(r,t))return Ne.some(r)}return Ne.none()}function B(n,e){for(var t=0,o=n.length;t<o;t++)if(e(n[t],t))return Ne.some(t);return Ne.none()}function V(n){for(var e=[],t=0,o=n.length;t<o;++t){if(!a(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);gt.apply(e,n[t])}return e}function N(n,e){return e=pt(n,e),V(e)}function _(n,e){for(var t=0,o=n.length;t<o;++t)if(!0!==e(n[t],t))return!1;return!0}function j(n){return(n=dt.call(n,0)).reverse(),n}function H(n){return[n]}function z(n,e){var t=String(e).toLowerCase();return R(n,function(n){return n.search(t)})}function L(n,e){return-1!==n.indexOf(e)}function P(n,e){Nt(n,n.element(),e,{})}function $(n,e,t){Nt(n,n.element(),e,t)}function W(n){P(n,Et())}function U(n,e,t){Nt(n,e,t,{})}function G(n,e){return function(n,e){for(var t=null!=e?e:Pt,o=0;o<n.length&&null!=t;++o)t=t[n[o]];return t}(n.split("."),e)}function q(n){return n.dom().nodeName.toLowerCase()}function Y(n){return null!=(n=Ut(n)?n.dom().parentNode:n.dom())&&n.ownerDocument.body.contains(n)}function K(n){return n.slice(0).sort()}function X(n,e){throw new Error("All required keys ("+K(n).join(", ")+") were not specified. Specified keys were: "+K(e).join(", ")+".")}function J(n){throw new Error("Unsupported keys for object: "+K(n).join(", "))}function Q(e,n){if(!a(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");I(n,function(n){if(!m(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})}function Z(n){var t=K(n);R(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")})}function nn(r,i){var u=r.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return Q("required",r),Q("optional",i),Z(u),function(e){var t=_e(e);_(r,function(n){return D(t,n)})||X(r,t);var n=A(t,function(n){return!D(u,n)});0<n.length&&J(n);var o={};return I(r,function(n){o[n]=O(e[n])}),I(i,function(n){o[n]=O(Object.prototype.hasOwnProperty.call(e,n)?Ne.some(e[n]):Ne.none())}),o}}function en(n,e){if((n=n.dom()).nodeType!==Kt)return!1;if(void 0!==n.matches)return n.matches(e);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(e);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(e);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}function tn(n){return n.nodeType!==Kt&&n.nodeType!==Xt||0===n.childElementCount}function on(n,e){return e=void 0===e?f.document:e.dom(),tn(e)?[]:pt(e.querySelectorAll(n),jt.fromDom)}function rn(n,e){return e=void 0===e?f.document:e.dom(),tn(e)?Ne.none():Ne.from(e.querySelector(n)).map(jt.fromDom)}function un(n,e){return n.dom()===e.dom()}function cn(n){return jt.fromDom(n.dom().ownerDocument)}function an(n){return jt.fromDom(n.dom().ownerDocument.defaultView)}function sn(n){return Ne.from(n.dom().parentNode).map(jt.fromDom)}function fn(n){return function(n,e){n=n.dom().childNodes;return Ne.from(n[e]).map(jt.fromDom)}(n,0)}function ln(n,o){var e;(e=n,Ne.from(e.dom().nextSibling).map(jt.fromDom)).fold(function(){sn(n).each(function(n){Qt(n,o)})},function(n){var e,t;t=o,sn(e=n).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})})}function dn(e,t){fn(e).fold(function(){Qt(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})}function mn(e,n){I(n,function(n){Qt(e,n)})}function gn(n){n.dom().textContent="",I(Jt(n),function(n){Zt(n)})}function pn(n,e){to(n,e,Qt)}function hn(n){no(n),Zt(n.element()),n.getSystem().removeFromWorld(n)}function vn(e){var n=sn(e.element()).bind(function(n){return e.getSystem().getByDom(n).fold(Ne.none,Ne.some)});hn(e),n.each(function(n){n.syncComponents()})}function yn(n){return co.defaultedThunk(O(n))}function bn(n){var e=[],t=[];return I(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}function wn(n){return l(io.error,V)(n)}function xn(e){return function(n){return n.hasOwnProperty(e)?Ne.from(n[e]):Ne.none()}}function Tn(n,e){return xn(e)(n)}function Sn(n,e){var t={};return t[n]=e,t}function On(n,e){return t=n,o={},I(e,function(n){void 0!==t[n]&&t.hasOwnProperty(n)&&(o[n]=t[n])}),o;var t,o}function kn(n,e){return t=e,o={},je(n,function(n,e){D(t,e)||(o[e]=n)}),o;var t,o}function Cn(n,e){return t=n,o=e,function(n){return xn(t)(n).getOr(o)};var t,o}function En(n){return e={},I(n,function(n){e[n.key]=n.value}),e;var e}function Dn(n,e){return mo(n,e)}function In(n,e){return e=e,(n=n).hasOwnProperty(e)&&void 0!==n[e]&&null!==n[e]}function An(){return $t("JSON")}function Mn(n){return t(n)&&100<_e(n).length?" removed due to size":wo(n,null,2)}function Fn(n,e){return io.error([{path:n,getErrorInfo:e}])}function Rn(t,o,r){return Tn(o,r).fold(function(){return n=r,e=o,Fn(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+Mn(e)});var n,e},io.value)}function Bn(n,e,t){return e=Tn(n,e).fold(function(){return t(n)},v),io.value(e)}function Vn(u,c,n,a){return n.fold(function(t,e,n,o){function r(n){return o.extract(u.concat([t]),a,n).map(function(n){return Sn(e,a(n))})}function i(n){return n.fold(function(){var n=Sn(e,a(Ne.none()));return io.value(n)},function(n){return o.extract(u.concat([t]),a,n).map(function(n){return Sn(e,a(Ne.some(n)))})})}return n.fold(function(){return Rn(u,c,t).bind(r)},function(n){return Bn(c,t,n).bind(r)},function(){return n=c,e=t,io.value(Tn(n,e)).bind(i);var n,e},function(n){return function(e,n,t){n=Tn(e,n).map(function(n){return!0===n?t(e):n});return io.value(n)}(c,t,n).bind(i)},function(n){var e=n(c);return Bn(c,t,O({})).map(function(n){return b(e,n)}).bind(r)})},function(n,e){e=e(c);return io.value(Sn(n,a(e)))})}function Nn(o){return{extract:function(t,n,e){return o(e,n).fold(function(n){return e=n,Fn(t,function(){return e});var e},io.value)},toString:function(){return"val"},toDsl:function(){return yo.itemOf(o)}}}function _n(n){var u=To(n),c=M(n,function(e,n){return n.fold(function(n){return b(e,vo(n,!0))},O(e))},{});return{extract:function(n,e,t){var o,r,i=g(t)?[]:(i=_e(o=t),A(i,function(n){return In(o,n)})),i=A(i,function(n){return!In(c,n)});return 0===i.length?u.extract(n,e,t):(r=i,Fn(n,function(){return"There are unsupported fields: ["+r.join(", ")+"] specified"}))},toString:u.toString,toDsl:u.toDsl}}function jn(t,e,o,r,i){return ho(r,i).fold(function(){return n=r,e=i,Fn(t,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+Mn(n)});var n,e},function(n){return To(n).extract(t.concat(["branch: "+i]),e,o)})}function Hn(n,e,t,o){return e.extract([n],t,o).fold(function(n){return io.error({input:o,errors:n})},io.value)}function zn(n,e,t){return Hn(n,e,O,t)}function Ln(n){return n.fold(function(n){throw new Error(Io(n))},v)}function Pn(n,e,t){return Ln(Hn(n,e,v,t))}function $n(n,e,t){return Ln(zn(n,e,t))}function Wn(n){return Co(n,n,ao(),Oo())}function Un(n,e){return Co(n,n,ao(),e)}function Gn(n,e){return Co(n,n,ao(),To(e))}function qn(n){return Co(n,n,so(),Oo())}function Yn(n,e){return Co(n,n,so(),To(e))}function Kn(n,e){return Co(n,n,so(),_n(e))}function Xn(n,e){return Co(n,n,yn(e),Oo())}function Jn(n,e,t){return Co(n,n,yn(e),t)}function Qn(n,e){return ko(n,e)}function Zn(n){if(!In(n,"can")&&!In(n,"abort")&&!In(n,"run"))throw new Error("EventHandler defined by: "+wo(n,null,2)+" does not have can, abort, or run!");return Pn("Extracting event.handler",_n([Xn("can",O(!0)),Xn("abort",O(!1)),Xn("run",S)]),n)}function ne(t){var e,o,r,i,n=(o=function(n){return n.can},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return F(e,function(n,e){return n&&o(e).apply(void 0,t)},!0)}),u=(r=e=t,i=function(n){return n.abort},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return F(r,function(n,e){return n||i(e).apply(void 0,t)},!1)});return Zn({can:n,abort:u,run:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];I(t,function(n){n.run.apply(void 0,e)})}})}function ee(n,e){return{key:n,value:Zn({abort:e})}}function te(n,e){return{key:n,value:Zn({run:e})}}function oe(n,e,t){return{key:n,value:Zn({run:function(n){e.apply(void 0,[n].concat(t))}})}}function re(i,e){return te(i,function(n,r){n.getSystem().getByUid(e).each(function(n){var e,t,o;t=(e=n).element(),o=i,n=r,e.getSystem().triggerEvent(o,t,n.event())})})}function ie(n,e,t){return t=e.partUids()[t],re(n,t)}function ue(n){return te(n,function(n,e){e.cut()})}function ce(n,e){var t=n.toString(),o=t.indexOf(")")+1,r=t.indexOf("("),i=t.substring(r+1,o-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:Ho(i)}},n}function ae(e,n,t){return n.fold(function(){return t.fold(function(){return{}},function(n){return vo(e,n)})},function(n){return t.fold(function(){return vo(e,n)},function(n){return vo(e,n)})})}function se(t,o,r){return _o(function(n,e){r(n,t,o)})}function fe(n,e,t,o,r,i){var u=n,c=Yn(e,[(c=n,Co(n="config",n,so(),c))]);return $o(u,c,e,t,o,r,i)}function le(r,i,u){var n,e,t,o,c,a;return n=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var o=[t].concat(n);return t.config({name:O(r)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+r+". Using API: "+u)},function(n){var e=Array.prototype.slice.call(o,1);return i.apply(void 0,[t,n.config,n.state].concat(e))})},e=u,o=(t=i).toString(),c=o.indexOf(")")+1,t=o.indexOf("("),a=o.substring(t+1,c-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:e,parameters:Ho(a.slice(0,1).concat(a.slice(3)))}},n}function de(n){return{key:n,value:void 0}}function me(n,e){return Wo(n,e,{validate:p,label:"function"})}function ge(e,n){0<(n=A(n,function(n){return!D(e,n)})).length&&J(n)}function pe(n){var e,t,o,r,i,u=Pn("Creating behaviour: "+n.name,Xo,n);return e=u.fields,t=u.name,o=u.active,r=u.apis,i=u.extra,n=u.state,u=_n(e),e=Yn(t,[Kn("config",e)]),$o(u,e,t,o,r,i,n)}function he(n,e,t){if(!(m(t)||g(t)||h(t)))throw f.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}function ve(n,e,t){he(n.dom(),e,t)}function ye(n,e){var t=n.dom();je(e,function(n,e){he(t,e,n)})}function be(n,e){return null===(e=n.dom().getAttribute(e))?void 0:e}function we(n,e){return!(!(n=n.dom())||!n.hasAttribute)&&n.hasAttribute(e)}function xe(n,e){n.dom().removeAttribute(e)}function Te(n,e){return void 0===(e=be(n,e))||""===e?[]:e.split(" ")}function Se(n){return void 0!==n.dom().classList}function Oe(n){return Te(n,"class")}function ke(n,e){return function(n,e,t){t=Te(n,e).concat([t]);return ve(n,e,t.join(" ")),!0}(n,"class",e)}function Ce(n,e){return o=e,0<(n=A(Te(t=n,e="class"),function(n){return n!==o})).length?ve(t,e,n.join(" ")):xe(t,e),!1;var t,o}function Ee(n,e){Se(n)?n.dom().classList.add(e):ke(n,e)}function De(n,e){Se(n)?n.dom().classList.remove(e):Ce(n,e),0===(Se(n=n)?n.dom().classList:Oe(n)).length&&xe(n,"class")}function Ie(n,e){return Se(n)?n.dom().classList.toggle(e):(e=e,(D(Oe(n=n),e)?Ce:ke)(n,e))}function Ae(n,e){return Se(n)&&n.dom().classList.contains(e)}function Me(n,e,t){De(n,t),Ee(n,e)}var Fe,Re,Be,Ve=function(t){function n(){return r}function e(n){return n(t)}var o=O(t),r={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:u,isNone:c,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return Ve(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?r:x},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(c,function(n){return e(t,n)})}};return r},Ne={some:Ve,none:n,from:function(n){return null==n?x:Ve(n)}},_e=Object.keys,je=function(n,e){for(var t=_e(n),o=0,r=t.length;o<r;o++){var i=t[o];e(n[i],i)}},He=function(n,t){var o={};return je(n,function(n,e){e=t(n,e);o[e.k]=e.v}),o},ze=function(n,t){var o=[];return je(n,function(n,e){o.push(t(n,e))}),o},Le=O("touchstart"),Pe=O("touchmove"),$e=O("touchend"),We=O("mousedown"),Ue=O("mousemove"),Ge=O("mouseup"),qe=O("mouseover"),Ye=O("keydown"),Ke=O("input"),Xe=O("change"),Je=O("click"),Qe=O("transitionend"),Ze=O("selectstart"),nt=function(){return et(0,0)},et=function(n,e){return{major:n,minor:e}},tt={nu:et,detect:function(n,e){e=String(e).toLowerCase();return 0===n.length?nt():function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var o=n[t];if(o.test(e))return o}}(n,e);if(!t)return{major:0,minor:0};n=function(n){return Number(e.replace(t,"$"+n))};return et(n(1),n(2))}(n,e)},unknown:nt},ot="Firefox",rt=function(n){var e=n.current;return{current:e,version:n.version,isEdge:C("Edge",e),isChrome:C("Chrome",e),isIE:C("IE",e),isOpera:C("Opera",e),isFirefox:C(ot,e),isSafari:C("Safari",e)}},it={unknown:function(){return rt({current:void 0,version:tt.unknown()})},nu:rt,edge:O("Edge"),chrome:O("Chrome"),ie:O("IE"),opera:O("Opera"),firefox:O(ot),safari:O("Safari")},ut="Windows",ct="Android",at="Solaris",st="FreeBSD",ft=function(n){var e=n.current;return{current:e,version:n.version,isWindows:E(ut,e),isiOS:E("iOS",e),isAndroid:E(ct,e),isOSX:E("OSX",e),isLinux:E("Linux",e),isSolaris:E(at,e),isFreeBSD:E(st,e)}},lt={unknown:function(){return ft({current:void 0,version:tt.unknown()})},nu:ft,windows:O(ut),ios:O("iOS"),android:O(ct),linux:O("Linux"),osx:O("OSX"),solaris:O(at),freebsd:O(st)},dt=Array.prototype.slice,mt=Array.prototype.indexOf,gt=Array.prototype.push,pt=function(n,e){for(var t=n.length,o=new Array(t),r=0;r<t;r++){var i=n[r];o[r]=e(i,r)}return o},ht=(p(Array.from)&&Array.from,function(n,t){return z(n,t).map(function(n){var e=tt.detect(n.versionRegexes,t);return{current:n.name,version:e}})}),vt=function(n,t){return z(n,t).map(function(n){var e=tt.detect(n.versionRegexes,t);return{current:n.name,version:e}})},yt=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return L(n,"edge/")&&L(n,"chrome")&&L(n,"safari")&&L(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,qr=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/],search:function(n){return L(n,"chrome")&&!L(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return L(n,"msie")||L(n,"trident")}},{name:"Opera",versionRegexes:[qr,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:(Yr=function(e){return function(n){return L(n,e)}})("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Yr("firefox")},{name:"Safari",versionRegexes:[qr,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(L(n,"safari")||L(n,"mobile/"))&&L(n,"applewebkit")}}],bt=[{name:"Windows",search:Yr("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return L(n,"iphone")||L(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Yr("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:Yr("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Yr("linux"),versionRegexes:[]},{name:"Solaris",search:Yr("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Yr("freebsd"),versionRegexes:[]}],wt={browsers:O(yt),oses:O(bt)},xt=function(n){var e,t,o,r=wt.browsers(),i=wt.oses(),u=ht(r,n).fold(it.unknown,it.nu),c=vt(i,n).fold(lt.unknown,lt.nu);return{browser:u,os:c,deviceType:(t=u,o=n,r=(e=c).isiOS()&&!0===/ipad/i.test(o),i=e.isiOS()&&!r,u=e.isAndroid()&&3===e.version.major,n=e.isAndroid()&&4===e.version.major,c=r||u||n&&!0===/mobile/i.test(o),u=e.isiOS()||e.isAndroid(),n=u&&!c,o=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(o),{isiPad:O(r),isiPhone:O(i),isTablet:O(c),isPhone:O(n),isTouch:O(u),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:O(o)})}},Tt={detect:k(function(){var n=f.navigator.userAgent;return xt(n)})},St={tap:O("alloy.tap")},Ot=O("alloy.focus"),kt=O("alloy.blur.post"),Ct=O("alloy.receive"),Et=O("alloy.execute"),Dt=O("alloy.focus.item"),It=St.tap,At=Tt.detect().deviceType.isTouch()?St.tap:Je,Mt=O("alloy.longpress"),Ft=O("alloy.system.init"),Rt=O("alloy.system.scroll"),Bt=O("alloy.system.attached"),Vt=O("alloy.system.detached"),Nt=function(n,e,t,o){o=b({target:e},o);n.getSystem().triggerEvent(t,e,T(o,O))},_t=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:O(n)}},jt={fromHtml:function(n,e){e=(e||f.document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw f.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return _t(e.childNodes[0])},fromTag:function(n,e){n=(e||f.document).createElement(n);return _t(n)},fromText:function(n,e){n=(e||f.document).createTextNode(n);return _t(n)},fromDom:_t,fromPoint:function(n,e,t){n=n.dom();return Ne.from(n.elementFromPoint(e,t)).map(_t)}},Ht=(f.Node.ATTRIBUTE_NODE,f.Node.CDATA_SECTION_NODE,f.Node.COMMENT_NODE,f.Node.DOCUMENT_NODE),zt=(f.Node.DOCUMENT_TYPE_NODE,f.Node.DOCUMENT_FRAGMENT_NODE,f.Node.ELEMENT_NODE),Lt=f.Node.TEXT_NODE,Pt=(f.Node.PROCESSING_INSTRUCTION_NODE,f.Node.ENTITY_REFERENCE_NODE,f.Node.ENTITY_NODE,f.Node.NOTATION_NODE,void 0!==f.window?f.window:Function("return this;")()),$t=function(n,e){e=G(n,e);if(null==e)throw new Error(n+" not available on this browser");return e},Wt=(Qr=function(e){return function(n){return n.dom().nodeType===e}})(zt),Ut=Qr(Lt),Gt=k(function(){return qt(jt.fromDom(f.document))}),qt=function(n){n=n.dom().body;if(null==n)throw new Error("Body is not available yet");return jt.fromDom(n)},Yt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var o={};return I(e,function(n,e){o[n]=O(t[e])}),o}},Kt=zt,Xt=Ht,Jt=(Tt.detect().browser.isIE(),function(n){return pt(n.dom().childNodes,jt.fromDom)}),Qt=(Yt("element","offset"),function(n,e){n.dom().appendChild(e.dom())}),Zt=function(n){n=n.dom();null!==n.parentNode&&n.parentNode.removeChild(n)},no=function(n){P(n,Vt());n=n.components();I(n,no)},eo=function(n){var e=n.components();I(e,eo),P(n,Bt())},to=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),Y(n.element())&&eo(e),n.syncComponents()},oo=function(t){return{is:function(n){return t===n},isValue:u,isError:c,getOr:O(t),getOrThunk:O(t),getOrDie:O(t),or:function(n){return oo(t)},orThunk:function(n){return oo(t)},fold:function(n,e){return e(t)},map:function(n){return oo(n(t))},mapError:function(n){return oo(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return Ne.some(t)}}},ro=function(t){return{is:c,isValue:c,isError:u,getOr:v,getOrThunk:function(n){return n()},getOrDie:function(){return i(String(t))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n,e){return n(t)},map:function(n){return ro(t)},mapError:function(n){return ro(n(t))},each:S,bind:function(n){return ro(t)},exists:c,forall:u,toOption:Ne.none}},io={value:oo,error:ro,fromOption:function(n,e){return n.fold(function(){return ro(e)},oo)}},uo=function(u){if(!a(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var c=[],t={};return I(u,function(n,o){var e=_e(n);if(1!==e.length)throw new Error("one and only one name per case");var r=e[0],i=n[r];if(void 0!==t[r])throw new Error("duplicate key detected:"+r);if("cata"===r)throw new Error("cannot have a case named cata (sorry)");if(!a(i))throw new Error("case arguments must be an array");c.push(r),t[r]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+r+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[o].apply(null,t)},match:function(n){var e=_e(n);if(c.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+c.join(",")+"\nActual: "+e.join(","));if(!_(c,function(n){return D(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+c.join(", "));return n[r].apply(null,t)},log:function(n){f.console.log(n,{constructors:c,constructor:r,params:t})}}}}),t},co=uo([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),ao=co.strict,so=co.asOption,fo=co.defaultedThunk,lo=co.mergeWithThunk,mo=(uo([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n,e){n=bn(n);return 0<n.errors.length?wn(n.errors):(n=n.values,e=e,io.value(b.apply(void 0,[e].concat(n))))}),go=function(n){n=bn(n);return 0<n.errors.length?wn(n.errors):io.value(n.values)},po=xn,ho=Tn,vo=Sn,yo=uo([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),bo=uo([{field:["name","presence","type"]},{state:["name"]}]),wo=function(n,e,t){return An().stringify(n,e,t)},xo=uo([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),To=function(o){return{extract:function(n,e,t){return function(e,t,n,o){n=pt(n,function(n){return Vn(e,t,n,o)});return mo(n,{})}(n,t,o,e)},toString:function(){return"obj{\n"+pt(o,function(n){return n.fold(function(n,e,t,o){return n+" -> "+o.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return yo.objOf(pt(o,function(n){return n.fold(function(n,e,t,o){return bo.field(n,t,o)},function(n,e){return bo.state(n)})}))}}},So=function(t,r){function i(n,e){return r=Nn(t),function(t,o,n){n=pt(n,function(n,e){return r.extract(t.concat(["["+e+"]"]),o,n)});return go(n)}(n,v,e);var r}return{extract:function(e,t,o){var n=_e(o);return i(e,n).bind(function(n){n=pt(n,function(n){return xo.field(n,n,ao(),r)});return To(n).extract(e,t,o)})},toString:function(){return"setOf("+r.toString()+")"},toDsl:function(){return yo.setOf(t,r)}}},Oo=O(Nn(io.value)),ko=xo.state,Co=xo.field,Eo=function(r,i){return{extract:function(e,t,o){return ho(o,r).fold(function(){return n=r,Fn(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return jn(e,t,o,i,n)})},toString:function(){return"chooseOn("+r+"). Possible values: "+_e(i)},toDsl:function(){return yo.choiceOf(r,i)}}},Do=Nn(io.value),Io=function(n){return"Errors: \n"+function(n){n=10<n.length?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return pt(n,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()})}(n.errors)+"\n\nInput object: "+Mn(n.input)},Ao=Eo,Mo=O(Do),Fo=(Fe=p,Re="function",Nn(function(n){var e=typeof n;return Fe(n)?io.value(n):io.error("Expected type: "+Re+" but got: "+e)})),Ro=function(n){return Un(n,Fo)},Bo=En,Vo=(Mu=function(n){return function(o){return{key:n,value:Zn({run:function(n,e){var t;t=e,un(n.element(),t.event().target())&&o(n,e)}})}}})(Bt()),No=Mu(Vt()),_o=Mu(Ft()),jo=(Be=Et(),function(n){return te(Be,n)}),Ho=function(n){return pt(n,function(n){return o=t="/*",t=(e=e=n).length-t.length,""!==o&&(e.length<o.length||e.substr(t,t+o.length)!==o)?n:n.substring(0,n.length-"/*".length);var e,t,o})},zo=nn(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),Lo=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().fold(function(){return"<none>"},function(n){return wo(n,null,2)}),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},Po=nn([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),$o=function(t,n,o,r,e,i,u){function c(n){return In(n,o)?n[o]():Ne.none()}var e=T(e,function(n,e){return le(o,n,e)}),i=T(i,ce),a=b(i,e,{revoke:s(de,o),config:function(n){var e=$n(o+"-config",t,n);return{key:o,value:{config:e,me:a,configAsRaw:k(function(){return Pn(o+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return c(n).bind(function(e){return ho(r,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(Po({}))},name:function(){return o},handlers:function(n){return c(n).bind(function(e){return ho(r,"events").map(function(n){return n(e.config,e.state)})}).getOr({})}});return a},Wo=function(n,r,i){if(0===r.length)throw new Error("You must specify at least one required field.");return Q("required",r),Z(r),function(e){var t=_e(e);_(r,function(n){return D(t,n)})||X(r,t),n(r,t);var o=A(r,function(n){return!i.validate(e[n],n)});return 0<o.length&&function(n){throw new Error("All values need to be of type: "+n+". Keys ("+K(o).join(", ")+") were not.")}(i.label),e}},Uo=S,Go=function(n){return me(ge,n)},qo={init:function(){return Yo({readState:function(){return"No State required"}})}},Yo=function(n){return me(Uo,["readState"])(n),n},Ko=En,Xo=_n([Wn("fields"),Wn("name"),Xn("active",{}),Xn("apis",{}),Xn("state",qo),Xn("extra",{})]),Jo=_n([Wn("branchKey"),Wn("branches"),Wn("name"),Xn("active",{}),Xn("apis",{}),Xn("state",qo),Xn("extra",{})]),Qo=O(void 0),Zo=Object.freeze({toAlpha:function(n,e,t){Me(n.element(),e.alpha(),e.omega())},toOmega:function(n,e,t){Me(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e,t){return Ae(n.element(),e.alpha())},isOmega:function(n,e,t){return Ae(n.element(),e.omega())},clear:function(n,e,t){De(n.element(),e.alpha()),De(n.element(),e.omega())}}),nr=[Wn("alpha"),Wn("omega")],er=pe({fields:nr,name:"swapping",apis:Zo}),tr=function(n){var e=n,n=function(){return e};return{get:n,set:function(n){e=n},clone:function(){return tr(e)}}};function or(n,e,t,o,r){return n(t,o)?Ne.some(t):p(r)&&r(t)?Ne.none():e(t,o,r)}function rr(n,e,t){for(var o=n.dom(),r=p(t)?t:O(!1);o.parentNode;){var o=o.parentNode,i=jt.fromDom(o);if(e(i))return Ne.some(i);if(r(i))break}return Ne.none()}function ir(n,e,t){return or(function(n,e){return e(n)},rr,n,e,t)}function ur(n){n.dom().focus()}function cr(n){n.dom().blur()}function ar(n){return n=void 0!==n?n.dom():f.document,Ne.from(n.activeElement).map(jt.fromDom)}function sr(e){return ar(cn(e)).filter(function(n){return e.dom().contains(n.dom())})}function fr(n){return n.dom().innerHTML}function lr(n,e){var t=cn(n).dom(),o=jt.fromDom(t.createDocumentFragment()),t=function(n,e){e=(e||f.document).createElement("div");return e.innerHTML=n,Jt(jt.fromDom(e))}(e,t);mn(o,t),gn(n),Qt(n,o)}function dr(n){return e=n,n=!1,jt.fromDom(e.dom().cloneNode(n));var e}function mr(n){var e=dr(n);return n=e,e=jt.fromTag("div"),n=jt.fromDom(n.dom().cloneNode(!0)),Qt(e,n),fr(e)}function gr(n){for(var e=[],t=function(n){e.push(n)},o=0;o<n.length;o++)n[o].each(t);return e}function pr(n,e,t){var o,r="*"===jr||D(jr,n)?(o=[],{logEventCut:function(n,e,t){o.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){o.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){o.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){o.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){o.push({outcome:"response",purpose:t,target:e})},write:function(){D(["mousemove","mouseover","mouseout",Ft()],n)||f.console.log(n,{event:n,target:e.dom(),sequence:pt(o,function(n){return D(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+mr(n.target)+")":n.outcome})})}}):zr,t=t(r);return r.write(),t}function hr(n,e,t){var o,r;return void 0!==(r=new Error).stack&&(r=r.stack.split("\n"),R(r,function(e){return 0<e.indexOf("alloy")&&!function(n,e){for(var t=0,o=n.length;t<o;t++)if(e(n[t],t))return!0;return!1}(Hr,function(n){return-1<e.indexOf(n)})}).getOr(_r)),Co(e,e,t,(o=function(t){return io.value(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(void 0,n)})},Nn(function(n){return o(n)})))}function vr(n,e){return Qn(n,O(e))}function yr(n){return Qn(n,v)}function br(n,e){var t=Xr(n,e);(e=e.aria()).update()(n,e,t)}function wr(n,e,t){Ie(n.element(),e.toggleClass()),br(n,e)}function xr(n,e,t){Ee(n.element(),e.toggleClass()),br(n,e)}function Tr(n,e,t){De(n.element(),e.toggleClass()),br(n,e)}function Sr(n,e,t){(e.selected()?xr:Tr)(n,e,t)}function Or(n,e){e.ignore()||(ur(n.element()),e.onFocus()(n))}function kr(n){return void 0!==n.style&&p(n.style.getPropertyValue)}function Cr(n,e,t){if(!m(t))throw f.console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);kr(n)&&n.style.setProperty(e,t)}function Er(n,e){var t=n.dom();je(e,function(n,e){Cr(t,e,n)})}function Dr(n,e){var t=n.dom(),o=f.window.getComputedStyle(t).getPropertyValue(e);return null===(e=""!==o||Y(n)?o:ci(t,e))?void 0:e}function Ir(n,e){return n=n.dom(),e=ci(n,e),Ne.from(e).filter(function(n){return 0<n.length})}function Ar(n,e){var t=n.dom();e=e,kr(t=t)&&t.style.removeProperty(e),we(n,"style")&&""===be(n,"style").replace(/^\s+|\s+$/g,"")&&xe(n,"style")}function Mr(n){return n.dom().offsetWidth}var Fr=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Rr=tinymce.util.Tools.resolve("tinymce.ThemeManager"),Br=function(n){var e=f.document.createElement("a");e.target="_blank",e.href=n.href,e.rel="noreferrer noopener";n=f.document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,f.window,0,0,0,0,0,!1,!1,!1,!1,0,null),f.document.body.appendChild(e),e.dispatchEvent(n),f.document.body.removeChild(e)},Vr={formatChanged:O("formatChanged"),orientationChanged:O("orientationChanged"),dropupDismissed:O("dropupDismissed")},Nr=Object.freeze({events:function(t){return Bo([te(Ct(),function(o,r){var e,i=t.channels(),n=_e(i),n=(n=n,(e=r).universal()?n:A(n,function(n){return D(e.channels(),n)}));I(n,function(n){var e=i[n](),t=e.schema(),t=$n("channel["+n+"] data\nReceiver: "+mr(o.element()),t,r.data());e.onReceive()(o,t)})})])}}),_r="unknown",jr=[],Hr=["alloy/data/Fields","alloy/debugging/Debugging"],zr={logEventCut:S,logEventStopped:S,logNoParent:S,logEventNoHandlers:S,logEventResponse:S,write:S},Lr=O([Wn("menu"),Wn("selectedMenu")]),Pr=O([Wn("item"),Wn("selectedItem")]),$r=(O(_n(Pr().concat(Lr()))),O(_n(Pr()))),Wr=Gn("initSize",[Wn("numColumns"),Wn("numRows")]),Ur=function(n){return hr(0,n,yn(S))},Gr=function(n){return hr(0,n,yn(Ne.none))},n=function(n){return hr(0,n,ao())},qr=function(n){return hr(0,n,ao())},Yr=O(Wr),yt=[Un("channels",So(io.value,_n([n("onReceive"),Xn("schema",Mo())])))],Kr=pe({fields:yt,name:"receiving",active:Nr}),Xr=function(n,e){return Ae(n.element(),e.toggleClass())},bt=Object.freeze({onLoad:Sr,toggle:wr,isOn:Xr,on:xr,off:Tr}),St=Object.freeze({exhibit:function(n,e,t){return Po({})},events:function(n,e){var t,o,r,i=(t=n,o=e,r=wr,jo(function(n){r(n,t,o)})),e=se(n,e,Sr);return Bo(V([n.toggleOnExecute()?[i]:[],[e]]))}}),Jr=function(n,e,t){ve(n.element(),"aria-expanded",t)},Qr=[Xn("selected",!1),Wn("toggleClass"),Xn("toggleOnExecute",!0),Jn("aria",{mode:"none"},Ao("mode",{pressed:[Xn("syncWithExpanded",!1),vr("update",function(n,e,t){ve(n.element(),"aria-pressed",t),e.syncWithExpanded()&&Jr(n,e,t)})],checked:[vr("update",function(n,e,t){ve(n.element(),"aria-checked",t)})],expanded:[vr("update",Jr)],selected:[vr("update",function(n,e,t){ve(n.element(),"aria-selected",t)})],none:[vr("update",S)]}))],Zr=pe({fields:Qr,name:"toggling",active:St,apis:bt}),ni=function(t,o){return Kr.config({channels:vo(Vr.formatChanged(),{onReceive:function(n,e){e.command===t&&o(n,e.state)}})})},ei=function(n){return Kr.config({channels:vo(Vr.orientationChanged(),{onReceive:n})})},ti=function(n,e){return{key:n,value:{onReceive:e}}},oi="tinymce-mobile",ri={resolve:function(n){return oi+"-"+n},prefix:O(oi)},Lt=Object.freeze({focus:Or,blur:function(n,e){e.ignore()||cr(n.element())},isFocused:function(n){return e=n.element(),n=cn(e).dom(),e.dom()===n.activeElement;var e}}),zt=Object.freeze({exhibit:function(n,e){return e.ignore()?Po({}):Po({attributes:{tabindex:"-1"}})},events:function(t){return Bo([te(Ot(),function(n,e){Or(n,t),e.stop()})])}}),Ht=[Ur("onFocus"),Xn("ignore",!1)],ii=pe({fields:Ht,name:"focusing",active:zt,apis:Lt}),ui=function(n,e,t){n=n.dom();Cr(n,e,t)},ci=function(n,e){return kr(n)?n.style.getPropertyValue(e):""};function ai(t,o){function n(n){var e=o(n);if(e<=0||null===e){n=Dr(n,t);return parseFloat(n)||0}return e}function r(t,n){return F(n,function(n,e){e=Dr(t,e),e=void 0===e?0:parseInt(e,10);return isNaN(e)?n:n+e},0)}return{set:function(n,e){if(!h(e)&&!e.match(/^[0-9]+$/))throw new Error(t+".set accepts only positive integer values. Value was "+e);n=n.dom();kr(n)&&(n.style[t]=e+"px")},get:n,getOuter:n,aggregate:r,max:function(n,e,t){t=r(n,t);return t<e?e-t:0}}}function si(n){return bu.get(n)}function fi(n,e,t){return A(function(n,e){for(var t=p(e)?e:c,o=n.dom(),r=[];null!==o.parentNode&&void 0!==o.parentNode;){var i=o.parentNode,u=jt.fromDom(i);if(r.push(u),!0===t(u))break;o=i}return r}(n,t),e)}function li(n,e){return A(sn(t=n).map(Jt).map(function(n){return A(n,function(n){return!un(t,n)})}).getOr([]),e);var t}function di(n,e){return on(e,n)}function mi(n,e,t){return rr(n,function(n){return en(n,e)},t)}function gi(n,e){return rn(e,n)}function pi(n,e,t){return or(en,mi,n,e,t)}function hi(n,e,t){var o=j(n.slice(0,e)),e=j(n.slice(e+1));return R(o.concat(e),t)}function vi(n,e,t){return e=j(n.slice(0,e)),R(e,t)}function yi(n,e,t){var o=n.slice(0,e),e=n.slice(e+1);return R(e.concat(o),t)}function bi(n,e,t){return e=n.slice(e+1),R(e,t)}function wi(e){return function(n){n=n.raw();return D(e,n.which)}}function xi(n){return function(e){return _(n,function(n){return n(e)})}}function Ti(n){return!0===n.raw().shiftKey}function Si(n){return!0===n.raw().ctrlKey}function Oi(n,e){return{matches:n,classification:e}}function ki(n,e,t,o){return o<(e=n+e)?t:e<t?o:e}function Ci(n,e,t){return n<=e?e:t<=n?t:n}function Ei(e,t,n){var o=di(e.element(),"."+t.highlightClass());I(o,function(n){De(n,t.highlightClass()),e.getSystem().getByDom(n).each(function(n){t.onDehighlight()(e,n)})})}function Di(n,e,t,o){t=xu(n,e,t,o),Ei(n,e),Ee(o.element(),e.highlightClass()),t||e.onHighlight()(n,o)}function Ii(e,t,n,o){var r=di(e.element(),"."+t.itemClass());return B(r,function(n){return Ae(n,t.highlightClass())}).bind(function(n){n=ki(n,o,0,r.length-1);return e.getSystem().getByDom(r[n]).toOption()})}function Ai(){return{get:function(n){return sr(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}}function Mi(n,e,u,t,o,i){function c(e,t,o,r){var i,n;return n=n=u(e,t,o,r),i=t.event(),R(n,function(n){return n.matches(i)}).map(function(n){return n.classification}).bind(function(n){return n(e,t,o,r)})}var r={schema:function(){return n.concat([Xn("focusManager",Ai()),vr("handler",r),vr("state",e)])},processKey:c,toEvents:function(o,r){var n=t(o,r),e=Bo(i.map(function(t){return te(Ot(),function(n,e){t(n,o,r,e),e.stop()})}).toArray().concat([te(Ye(),function(n,e){c(n,e,o,r).each(function(n){e.stop()})})]));return b(n,e)},toApis:o};return r}function Fi(n){return"input"===q(n)&&"radio"!==be(n,"type")||"textarea"===q(n)}function Ri(n,e,t){return t.execute()(n,e,n.element())}function Bi(e,t){return function(n){return"rtl"===Cu(n)?t:e}}function Vi(i){return function(n,e,t,o){var r=i(n.element());return Eu(r,n,e,t,o)}}function Ni(n,e){return e=Bi(n,e),Vi(e)}function _i(n,e){return n=Bi(e,n),Vi(n)}function ji(n){return!((n=n=n.dom()).offsetWidth<=0&&n.offsetHeight<=0)}function Hi(n,e,t){return Au(n,e,t)}function zi(n,e){return B(n,function(n){return un(e,n)})}function Li(e,n,t,o){return o(Math.floor(n/t),n%t).bind(function(n){n=n.row()*t+n.column();return 0<=n&&n<e.length?Ne.some(e[n]):Ne.none()})}function Pi(o,n,r,i,u){return Li(o,n,i,function(n,e){var t=n===r-1?o.length-n*i:i,t=ki(e,u,0,t-1);return Ne.some({row:O(n),column:O(t)})})}function $i(o,n,r,i,u){return Li(o,n,i,function(n,e){var t=ki(n,u,0,r-1),n=t===r-1?o.length-t*i:i,n=Ci(e,0,n-1);return Ne.some({row:O(t),column:O(n)})})}function Wi(n,e,t,o){return Hi(n,t,e).bind(function(n){var e=n.index(),n=n.candidates(),e=ki(e,o,0,n.length-1);return Ne.from(n[e])})}function Ui(e,t,o){return n=e,(r=o).focusManager().get(n).bind(function(n){return pi(n,r.selector())}).bind(function(n){return o.execute()(e,t,n)});var n,r}function Gi(n,e,t){return Wi(n,t.selector(),e,-1)}function qi(n,e,t){return Wi(n,t.selector(),e,1)}function Yi(o){return function(n,e,t){return o(n,e,t).bind(function(){return t.executeOnMove()?Ui(n,e,t):Ne.some(!0)})}}function Ki(n,e,t){return Ne.from(n[e]).bind(function(n){return Ne.from(n[t]).map(function(n){return Fu({rowIndex:e,columnIndex:t,cell:n})})})}function Xi(n,e,t,o){var r=n[e].length,r=ki(t,o,0,r-1);return Ki(n,e,r)}function Ji(n,e,t,o){return t=ki(t,o,0,n.length-1),o=n[t].length,o=Ci(e,0,o-1),Ki(n,t,o)}function Qi(n,e,t,o){var r=n[e].length,r=Ci(t+o,0,r-1);return Ki(n,e,r)}function Zi(n,e,t,o){return t=Ci(t+o,0,n.length-1),o=n[t].length,o=Ci(e,0,o-1),Ki(n,t,o)}function nu(n,e,t){return Wi(n,t.selector(),e,-1)}function eu(n,e,t){return Wi(n,t.selector(),e,1)}function tu(n){return n.dump()}function ou(n,e,t,o){return t.uiType===Bu?(i=t,u=o,(r=n).exists(function(n){return n!==i.owner})?Vu.single(!0,O(i)):ho(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+_e(u)+"]\nNamespace: "+r.getOr("none")+"\nSpec: "+wo(i,null,2))},function(n){return n.replace()})):Vu.single(!1,O(t));var r,i,u}function ru(e,t,n,o){var r,i,u,o=T(o,function(n,e){return o=n,r=!1,{name:O(t=e),required:function(){return o.fold(function(n,e){return n},function(n,e){return n})},used:function(){return r},replace:function(){if(!0===r)throw new Error("Trying to use the same placeholder more than once: "+t);return r=!0,o}};var t,o,r}),n=(r=e,i=t,u=o,N(n,function(n){return Nu(r,i,n,u)}));return je(o,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+wo(t.components(),null,2))}),n}function iu(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++zu+String(e)}function uu(n){function e(n){return n.name()}return n.fold(e,e,e,e)}function cu(n,e,t,o){var r=t;return b(e.defaults()(n,t,o),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,o),{"debug.sketcher":vo("part-"+e.name(),r)})}function au(r,n){var e={};return I(n,function(n){n.fold(Ne.some,Ne.none,Ne.some,Ne.some).each(function(t){var o=Wu(r,t.pname());e[t.name()]=function(n){var e=Pn("Part: "+t.name()+" in "+r,To(t.schema()),n);return b(o,{config:n,validated:e})}})}),e}function su(n,e,t){return o=e,i={},r={},I(t,function(n){n.fold(function(o){i[o.pname()]=_u(!0,function(n,e,t){return o.factory().sketch(cu(n,o,e,t))})},function(n){var e=o.parts()[n.name()]();r[n.name()]=O(cu(o,n,e[$u()]()))},function(o){i[o.pname()]=_u(!1,function(n,e,t){return o.factory().sketch(cu(n,o,e,t))})},function(r){i[r.pname()]=ju(!0,function(e,n,t){var o=e[r.name()]();return pt(o,function(n){return r.factory().sketch(b(r.defaults()(e,n),n,r.overrides()(e,n)))})})})}),{internals:O(i),externals:O(r)};var o,i,r}function fu(n,e,t){return ru(Ne.some(n),e,e.components(),t)}function lu(n,e,t){return t=e.partUids()[t],n.getSystem().getByUid(t).toOption()}function du(n,e,t){return lu(n,e,t).getOrDie("Could not find part: "+t)}function mu(e,n){return n=pt(n,uu),En(pt(n,function(n){return{key:n,value:e+"-"+n}}))}function gu(e){return Co("partUids","partUids",lo(function(n){return mu(n.uid,e)}),Mo())}function pu(n){return vo(Uu,n)}function hu(r){return n=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var o=n.config(Gu);return r.apply(void 0,[o].concat([n].concat(e)))},t=(e=r).toString(),o=t.indexOf(")")+1,e=t.indexOf("("),i=t.substring(e+1,o-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Ho(i.slice(1))}},n;var n,e,t,o,i}function vu(n,e,t,o,r){return r=r,r=(0<(o=o).length?[Gn("parts",o)]:[]).concat([Wn("uid"),Xn("dom",{}),Xn("components",[]),yr("originalSpec"),Xn("debug.sketcher",{})]).concat(r),$n(n+" [SpecSchema]",_n(r.concat(e)),t)}function yu(n,e,t,o,r){var i=Zu(r),u=N(t,function(n){return n.fold(Ne.none,Ne.some,Ne.none,Ne.none).map(function(n){return Gn(n.name(),n.schema().concat([yr($u())]))}).toArray()}),c=gu(t),u=vu(n,e,i,u,[c]),c=su(0,u,t),t=fu(n,u,c.internals());return b(o(u,t,i,c.externals()),{"debug.sketcher":vo(n,r)})}var bu=ai("height",function(n){var e=n.dom();return Y(n)?e.getBoundingClientRect().height:e.offsetHeight}),wu=d(Ti),xu=function(n,e,t,o){return Ae(o.element(),e.highlightClass())},Tu=function(n,e,t,o){e=di(n.element(),"."+e.itemClass());return Ne.from(e[o]).fold(function(){return io.error("No element found with index "+o)},n.getSystem().getByDom)},Su=function(e,n,t){return gi(e.element(),"."+n.itemClass()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},Ou=function(e,n,t){n=di(e.element(),"."+n.itemClass());return(0<n.length?Ne.some(n[n.length-1]):Ne.none()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},Eo=Object.freeze({dehighlightAll:Ei,dehighlight:function(n,e,t,o){t=xu(n,e,t,o);De(o.element(),e.highlightClass()),t&&e.onDehighlight()(n,o)},highlight:Di,highlightFirst:function(e,t,o){Su(e,t).each(function(n){Di(e,t,o,n)})},highlightLast:function(e,t,o){Ou(e,t).each(function(n){Di(e,t,o,n)})},highlightAt:function(e,t,o,n){Tu(e,t,o,n).fold(function(n){throw new Error(n)},function(n){Di(e,t,o,n)})},highlightBy:function(e,t,o,n){var r=di(e.element(),"."+t.itemClass()),r=gr(pt(r,function(n){return e.getSystem().getByDom(n).toOption()}));R(r,n).each(function(n){Di(e,t,o,n)})},isHighlighted:xu,getHighlighted:function(e,n,t){return gi(e.element(),"."+n.highlightClass()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},getFirst:Su,getLast:Ou,getPrevious:function(n,e,t){return Ii(n,e,0,-1)},getNext:function(n,e,t){return Ii(n,e,0,1)}}),Do=[Wn("highlightClass"),Wn("itemClass"),Ur("onHighlight"),Ur("onDehighlight")],ku=pe({fields:Do,name:"highlighting",apis:Eo}),nr=(Mu=function(n){function i(n,e){return n=n.visibilitySelector().bind(function(n){return pi(e,n)}).getOr(e),0<si(n)}function c(e,n,t,o,r){return r(n,t,function(n){return i(e=o,n=n)&&e.useTabstopAt()(n);var e}).fold(function(){return o.cyclic()?Ne.some(!0):Ne.none()},function(n){return o.focusManager().set(e,n),Ne.some(!0)})}function u(e,n,t,o){var r,i,u=di(e.element(),t.selector());return r=e,(i=t).focusManager().get(r).bind(function(n){return pi(n,i.selector())}).bind(function(n){return B(u,s(un,n)).bind(function(n){return c(e,u,n,t,o)})})}var e=[qn("onEscape"),qn("onEnter"),Xn("selector",'[data-alloy-tabstop="true"]'),Xn("firstTabstop",0),Xn("useTabstopAt",O(!0)),qn("visibilitySelector")].concat([n]),t=O([Oi(xi([Ti,wi([9])]),function(n,e,t,o){var r=t.cyclic()?hi:vi;return u(n,0,t,r)}),Oi(wi([9]),function(n,e,t,o){var r=t.cyclic()?yi:bi;return u(n,0,t,r)}),Oi(wi([27]),function(e,t,n,o){return n.onEscape().bind(function(n){return n(e,t)})}),Oi(xi([wu,wi([13])]),function(e,t,n,o){return n.onEnter().bind(function(n){return n(e,t)})})]),o=O({}),n=O({});return Mi(e,qo.init,t,o,n,Ne.some(function(e,t){!function(n,e){n=di(n.element(),e.selector()),n=A(n,function(n){return i(e,n)});return Ne.from(n[e.firstTabstop()])}(e,t).each(function(n){t.focusManager().set(e,n)})}))})(Qn("cyclic",O(!1))),Zo=Mu(Qn("cyclic",O(!0))),yt=[Xn("execute",Wr=function(n,e,t){return Fi(t)&&wi([32])(e.event())?Ne.none():(U(n,t,Et()),Ne.some(!0))}),Xn("useSpace",!1),Xn("useEnter",!0),Xn("useControlEnter",!1),Xn("useDown",!1)],Nr=O({}),Qr=O({}),St=Mi(yt,qo.init,function(n,e,t,o){var r=t.useSpace()&&!Fi(n.element())?[32]:[],i=t.useEnter()?[13]:[],n=t.useDown()?[40]:[],n=r.concat(i).concat(n);return[Oi(wi(n),Ri)].concat(t.useControlEnter()?[Oi(xi([Si,wi([13])]),Ri)]:[])},Nr,Qr,Ne.none()),bt=function(n){var t=tr(Ne.none());return Yo({readState:O({}),setGridSize:function(n,e){t.set(Ne.some({numRows:O(n),numColumns:O(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},Ht=Object.freeze({flatgrid:bt,init:function(n){return n.state()(n)}}),Cu=function(n){return"rtl"===Dr(n,"direction")?"rtl":"ltr"},zt=function(r){return function(n,e,t,o){return Eu(r,n,e,t,o)}},Eu=function(e,t,n,o,r){return o.focusManager().get(t).bind(function(n){return e(t.element(),n,o,r)}).map(function(n){return o.focusManager().set(t,n),!0})},Lt=zt,Do=zt,Du=zt,Iu=nn(["index","candidates"],[]),Au=function(n,e,t,o){var r,e=s(un,e),t=di(n,t),t=A(t,ji);return B(r=t,e).map(function(n){return Iu({index:n,candidates:r})})},Eo=[Wn("selector"),Xn("execute",Wr),Gr("onEscape"),Xn("captureTab",!1),Yr()],yt=function(n,e,t,o){return t.captureTab()?Ne.some(!0):Ne.none()},Nr=(Mu=function(r){return function(n,e,t,o){return Hi(n,e,t.selector()).bind(function(n){return r(n.candidates(),n.index(),o.getNumRows().getOr(t.initSize().numRows()),o.getNumColumns().getOr(t.initSize().numColumns()))})}})(function(n,e,t,o){return Pi(n,e,t,o,-1)}),Qr=Mu(function(n,e,t,o){return Pi(n,e,t,o,1)}),zt=Mu(function(n,e,t,o){return $i(n,e,t,o,-1)}),Mu=Mu(function(n,e,t,o){return $i(n,e,t,o,1)}),Nr=O([Oi(wi([37]),Ni(Nr,Qr)),Oi(wi([39]),_i(Nr,Qr)),Oi(wi([38]),Lt(zt)),Oi(wi([40]),Do(Mu)),Oi(xi([Ti,wi([9])]),yt),Oi(xi([wu,wi([9])]),yt),Oi(wi([27]),function(n,e,t,o){return t.onEscape()(n,e)}),Oi(wi([32].concat([13])),function(e,t,o,n){return r=e,(i=o).focusManager().get(r).bind(function(n){return pi(n,i.selector())}).bind(function(n){return o.execute()(e,t,n)});var r,i})]),Qr=O({}),zt=Mi(Eo,bt,Nr,Qr,{},Ne.some(function(e,t,n){gi(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),Mu=[Wn("selector"),Xn("getInitial",Ne.none),Xn("execute",Wr),Xn("executeOnMove",!1),Xn("allowVertical",!0)],yt=O({}),Eo=O({}),bt=Mi(Mu,qo.init,function(n,e,t,o){var r=[37].concat(t.allowVertical()?[38]:[]),t=[39].concat(t.allowVertical()?[40]:[]);return[Oi(wi(r),Yi(Ni(Gi,qi))),Oi(wi(t),Yi(_i(Gi,qi))),Oi(wi([13]),Ui),Oi(wi([32]),Ui)]},yt,Eo,Ne.some(function(e,t){t.getInitial()(e).or(gi(e.element(),t.selector())).each(function(n){t.focusManager().set(e,n)})})),Fu=nn(["rowIndex","columnIndex","cell"],[]),Nr=[Gn("selectors",[Wn("row"),Wn("cell")]),Xn("cycles",!0),Xn("previousSelector",Ne.none),Xn("execute",Wr)],Mu=(Qr=function(n,e){return function(t,o,i){var u=i.cycles()?n:e;return pi(o,i.selectors().row()).bind(function(n){var e=di(n,i.selectors().cell());return zi(e,o).bind(function(o){var r=di(t,i.selectors().row());return zi(r,n).bind(function(n){var e,t=(e=i,pt(r,function(n){return di(n,e.selectors().cell())}));return u(t,n,o).map(function(n){return n.cell()})})})})}})(function(n,e,t){return Xi(n,e,t,-1)},function(n,e,t){return Qi(n,e,t,-1)}),yt=Qr(function(n,e,t){return Xi(n,e,t,1)},function(n,e,t){return Qi(n,e,t,1)}),Eo=Qr(function(n,e,t){return Ji(n,t,e,-1)},function(n,e,t){return Zi(n,t,e,-1)}),Qr=Qr(function(n,e,t){return Ji(n,t,e,1)},function(n,e,t){return Zi(n,t,e,1)}),Eo=O([Oi(wi([37]),Ni(Mu,yt)),Oi(wi([39]),_i(Mu,yt)),Oi(wi([38]),Lt(Eo)),Oi(wi([40]),Do(Qr)),Oi(wi([32].concat([13])),function(e,t,o){return sr(e.element()).bind(function(n){return o.execute()(e,t,n)})})]),Do=O({}),Qr=O({}),Nr=Mi(Nr,qo.init,Eo,Do,Qr,Ne.some(function(e,t){t.previousSelector()(e).orThunk(function(){var n=t.selectors();return gi(e.element(),n.cell())}).each(function(n){t.focusManager().set(e,n)})})),Eo=[Wn("selector"),Xn("execute",Wr),Xn("moveOnTab",!1)],Do=function(e,t,o){return o.focusManager().get(e).bind(function(n){return o.execute()(e,t,n)})},Qr=O([Oi(wi([38]),Du(nu)),Oi(wi([40]),Du(eu)),Oi(xi([Ti,wi([9])]),function(n,e,t){return t.moveOnTab()?Du(nu)(n,e,t):Ne.none()}),Oi(xi([wu,wi([9])]),function(n,e,t){return t.moveOnTab()?Du(eu)(n,e,t):Ne.none()}),Oi(wi([13]),Do),Oi(wi([32]),Do)]),Wr=O({}),Do=O({}),Wr=Mi(Eo,qo.init,Qr,Wr,Do,Ne.some(function(e,t){gi(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),Do=[Gr("onSpace"),Gr("onEnter"),Gr("onShiftEnter"),Gr("onLeft"),Gr("onRight"),Gr("onTab"),Gr("onShiftTab"),Gr("onUp"),Gr("onDown"),Gr("onEscape"),qn("focusIn")],Gr=Mi(Do,qo.init,function(n,e,t){return[Oi(wi([32]),t.onSpace()),Oi(xi([wu,wi([13])]),t.onEnter()),Oi(xi([Ti,wi([13])]),t.onShiftEnter()),Oi(xi([Ti,wi([9])]),t.onShiftTab()),Oi(xi([wu,wi([9])]),t.onTab()),Oi(wi([38]),t.onUp()),Oi(wi([40]),t.onDown()),Oi(wi([37]),t.onLeft()),Oi(wi([39]),t.onRight()),Oi(wi([32]),t.onSpace()),Oi(wi([27]),t.onEscape())]},function(){return{}},function(){return{}},Ne.some(function(e,t){return t.focusIn().bind(function(n){return n(e,t)})})),Do=nr.schema(),nr=Zo.schema(),Zo=bt.schema(),bt=zt.schema(),zt=Nr.schema(),Nr=St.schema(),St=Wr.schema(),Wr=Gr.schema(),Ru=function(n){n=Pn("Creating behaviour: "+n.name,Jo,n);return fe(Ao(n.branchKey,n.branches),n.name,n.active,n.apis,n.extra,n.state)}({branchKey:"mode",branches:Object.freeze({acyclic:Do,cyclic:nr,flow:Zo,flatgrid:bt,matrix:zt,execution:Nr,menu:St,special:Wr}),name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,e,t,o,r){In(t,"setGridSize")?t.setGridSize(o,r):f.console.error("Layout does not support setGridSize")}},state:Ht}),Gr=function(o,n){return e=o,t={},n=pt(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+o,Co(e,e,so(),Nn(function(n){return io.error("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([Qn("dump",v)]),Co(e,e,yn(t),To(n));var e,t},Bu="placeholder",Vu=uo([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Nu=function(o,r,i,u){return ou(o,0,i,u).fold(function(n,e){var t=e(r,i.config,i.validated),e=ho(t,"components").getOr([]),e=N(e,function(n){return Nu(o,r,n,u)});return[b(t,{components:e})]},function(n,e){return e(r,i.config,i.validated)})},_u=Vu.single,ju=Vu.multiple,Hu=O(Bu),zu=0,Do=uo([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),nr=Xn("factory",{sketch:v}),Zo=Xn("schema",[]),bt=Wn("name"),zt=Co("pname","pname",fo(function(n){return"<alloy."+iu(n.name)+">"}),Mo()),Nr=Xn("defaults",O({})),St=Xn("overrides",O({})),Wr=To([nr,Zo,bt,zt,Nr,St]),Ht=To([nr,Zo,bt,zt,Nr,St]),fo=To([nr,Zo,bt,Wn("unit"),zt,Nr,St]),Lu=(nr=function(e,t){return function(n){n=$n("Converting part type",t,n);return e(n)}})(Do.required,Wr),Pu=nr(Do.optional,Ht),Zo=nr(Do.group,fo),$u=O("entirety"),Wu=function(n,e){return{uiType:Hu(),owner:n,name:e}},Uu=iu("alloy-premade"),Gu=iu("api"),qu=O(Gu),bt=O("alloy-id-"),Yu=O("data-alloy-id"),Ku=bt(),Xu=Yu(),Ju=function(n){n=Wt(n)?be(n,Xu):null;return Ne.from(n)},Qu=iu,Zu=function(n){return b({uid:Qu("uid")},n)};function nc(n){var e=jt.fromHtml(n),t=Jt(e),o=function(n){n=void 0!==n.dom().attributes?n.dom().attributes:[];return F(n,function(n,e){return"class"===e.name?n:b(n,vo(e.name,e.value))},{})}(e),n=(n=e,Array.prototype.slice.call(n.dom().classList,0)),t=0===t.length?{}:{innerHtml:fr(e)};return b({tag:q(e),classes:n,attributes:o},t)}function ec(n){return{dom:Ec(n)}}function tc(n){return Ko([Zr.config({toggleClass:ri.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),ni(n,function(n,e){(e?Zr.on:Zr.off)(n)})])}function oc(n,e,t){return Math.max(e,Math.min(t,n))}function rc(n,e,t,o,r,i,u){var c=t-e;if(o<n.left)return e-1;if(o>n.right)return t+1;var a,s,f,l,o=Math.min(n.right,Math.max(o,n.left))-n.left,n=oc(o/n.width*c+e,e-1,t+1),c=Math.round(n);return i&&e<=n&&n<=t?(a=n,s=e,f=t,l=r,u.fold(function(){var n=a-s,n=Math.round(n/l)*l;return oc(s+n,s-1,f+1)},function(n){var e=(a-n)%l,t=Math.round(e/l),o=Math.floor((a-n)/l),e=Math.floor((f-n)/l),t=n+Math.min(e,o+t)*l;return Math.max(n,t)})):c}function ic(n){return function(n){n=n.event().raw();return Rc?void 0!==n.touches&&1===n.touches.length?Ne.some(n.touches[0]).map(function(n){return Mc(n.clientX,n.clientY)}):Ne.none():void 0!==n.clientX?Ne.some(n).map(function(n){return Mc(n.clientX,n.clientY)}):Ne.none()}(n).map(function(n){return n.left()})}function uc(n,e){$(n,Fc,{value:e})}function cc(r,i,u,n){return ic(n).map(function(n){var e,t,o;return e=r,o=n,t=rc(u,(t=i).min(),t.max(),o,t.stepSize(),t.snapToGrid(),t.snapStart()),uc(e,t),n})}function ac(n,e){var t,o,r,e=(t=e.value().get(),o=e.min(),r=e.max(),e=e.stepSize(),t<o?t:r<t?r:t===o?o-1:Math.max(o,t-e));uc(n,e)}function sc(n,e){var t,o,r,e=(t=e.value().get(),o=e.min(),r=e.max(),e=e.stepSize(),r<t?t:t<o?o:t===r?r+1:Math.min(r,t+e));uc(n,e)}function fc(n,e,t){e.store().manager().onLoad(n,e,t)}function lc(n,e,t){e.store().manager().onUnload(n,e,t)}function dc(n,e,t,o){e.store().getDataKey(),t.set({}),e.store().setData()(n,o),e.onSetValue()(n,o)}function mc(n,e){Nc.set(n,e)}function gc(n){return Nc.get(n)}function pc(e,t,o){return Ic.forToolbar(t,function(){var n=o();e.setContextToolbar([{label:t+" group",items:n}])},{})}function hc(o){function r(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"}return jc.sketch({dom:Ec('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[jc.parts()["left-edge"](ec('<div class="${prefix}-hue-slider-black"></div>')),jc.parts().spectrum({dom:Ec('<div class="${prefix}-slider-gradient-container"></div>'),components:[ec('<div class="${prefix}-slider-gradient"></div>')],behaviours:Ko([Zr.config({toggleClass:ri.resolve("thumb-active")})])}),jc.parts()["right-edge"](ec('<div class="${prefix}-hue-slider-white"></div>')),jc.parts().thumb({dom:Ec('<div class="${prefix}-slider-thumb"></div>'),behaviours:Ko([Zr.config({toggleClass:ri.resolve("thumb-active")})])})],onChange:function(n,e,t){t=r(t);ui(e.element(),"background-color",t),o.onChange(n,e,t)},onDragStart:function(n,e){Zr.on(e)},onDragEnd:function(n,e){Zr.off(e)},onInit:function(n,e,t){t=r(t);ui(e.element(),"background-color",t)},stepSize:10,min:0,max:360,getInitialValue:o.getInitialValue,sliderBehaviours:Ko([ei(jc.refresh)])})}function vc(n){return[hc(n)]}function yc(n){var e,t=n.selection.getStart(),t=jt.fromDom(t),o=jt.fromDom(n.getBody()),r=(e=function(n){return un(o,n)},(Wt(t=t)?Ne.some(t):sn(t).filter(Wt)).map(function(n){return ir(n,function(n){return Ir(n,"font-size").isSome()},e).bind(function(n){return Ir(n,"font-size")}).getOrThunk(function(){return Dr(n,"font-size")})}).getOr(""));return R(Pc,function(n){return r===n}).getOr("medium")}function bc(n){return[ec('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),Lc({onChange:(n=n).onChange,sizes:Wc,category:"font",getInitialValue:n.getInitialValue}),ec('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]}function wc(n){var e=void 0!==n.uid&&In(n,"uid")?n.uid:Qu("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(Ne.none,Ne.some)},asSpec:function(){return b(n,{uid:e})}}}var xc,Tc,Sc=_n([Wn("name"),Wn("factory"),Wn("configFields"),Xn("apis",{}),Xn("extraApis",{})]),Oc=_n([Wn("name"),Wn("factory"),Wn("configFields"),Wn("partFields"),Xn("apis",{}),Xn("extraApis",{})]),Nr=function(n){var e=Pn("Sketcher for "+n.name,Oc,n),t=au(e.name,e.partFields),o=T(e.apis,hu),n=T(e.extraApis,ce);return b({name:O(e.name),partFields:O(e.partFields),configFields:O(e.configFields),sketch:function(n){return yu(e.name,e.configFields,e.partFields,e.factory,n)},parts:O(t)},o,n)},kc=(zt=function(n){var i=Pn("Sketcher for "+n.name,Sc,n),e=T(i.apis,hu),n=T(i.extraApis,ce);return b({name:O(i.name),partFields:O([]),configFields:O(i.configFields),sketch:function(n){return e=i.name,t=i.configFields,o=i.factory,n=Zu(r=n),t=vu(e,t,n,[],[]),b(o(t,n),{"debug.sketcher":vo(e,r)});var e,t,o,r}},e,n)})({name:"Button",factory:function(n){var e,e=(e=n.action(),t=function(n,e){e.stop(),W(n)},t=Tt.detect().deviceType.isTouch()?[te(It(),t)]:[te(Je(),t),te(We(),function(n,e){e.cut()})],Bo(V([e.map(function(t){return te(Et(),function(n,e){t(n),e.stop()})}).toArray(),t]))),t=ho(n.dom(),"attributes").bind(po("type")),o=ho(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:e,behaviours:b(Ko([ii.config({}),Ru.config({mode:"execution",useSpace:!0,useEnter:!0})]),tu(n.buttonBehaviours())),domModification:{attributes:b(t.fold(function(){return o.is("button")?{type:"button"}:{}},function(n){return{}}),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[Xn("uid",void 0),Wn("dom"),Xn("components",[]),Gr("buttonBehaviours",[ii,Ru]),qn("action"),qn("role"),Xn("eventOrder",{})]}),Cc=pe({fields:[],name:"unselecting",active:Object.freeze({events:function(n){return Bo([ee(Ze(),O(!0))])},exhibit:function(n,e){return Po({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}})}),Ec=function(n){var t,n=(n=n,t={prefix:ri.prefix()},n.replace(/\$\{([^{}]*)\}/g,function(n,e){e=t[e];return function(n){n=typeof n;return"string"==n||"number"==n}(e)?e.toString():n}));return nc(n)},Dc=function(n,e,t){return kc.sketch({dom:Ec('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:b(Ko([Cc.config({})]),t)})},Ic={forToolbar:Dc,forToolbarCommand:function(n,e){return Dc(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,o){t=tc(t);return Dc(e,o,t)},forToolbarStateCommand:function(n,e){var t=tc(e);return Dc(e,function(){n.execCommand(e)},t)}},Ac=function(t,o){return{left:O(t),top:O(o),translate:function(n,e){return Ac(t+n,o+e)}}},Mc=Ac,Fc="slider.change.value",Rc=Tt.detect().deviceType.isTouch(),Bc=Tt.detect().deviceType.isTouch(),Wr=[(St=function(n,t){return Pu({name:n+"-edge",overrides:function(n){var e=Bo([oe(Le(),t,[n])]),n=Bo([oe(We(),t,[n]),oe(Ue(),function(n,e){e.mouseIsDown().get()&&t(n,e)},[n])]);return{events:Bc?e:n}}})})("left",function(n,e){uc(n,e.min()-1)}),St("right",function(n,e){uc(n,e.max()+1)}),Lu({name:"thumb",defaults:O({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Bo([ie(Le(),n,"spectrum"),ie(Pe(),n,"spectrum"),ie($e(),n,"spectrum")])}}}),Lu({schema:[ko("mouseIsDown",function(){return tr(!1)})],name:"spectrum",overrides:function(o){function t(n,e){var t=n.element().dom().getBoundingClientRect();cc(n,o,t,e)}var n=Bo([te(Le(),t),te(Pe(),t)]),e=Bo([te(We(),t),te(Ue(),function(n,e){o.mouseIsDown().get()&&t(n,e)})]);return{behaviours:Ko(Bc?[]:[Ru.config({mode:"special",onLeft:function(n){return ac(n,o),Ne.some(!0)},onRight:function(n){return sc(n,o),Ne.some(!0)}}),ii.config({})]),events:Bc?n:e}}})],Ht=Object.freeze({onLoad:fc,onUnload:lc,setValue:function(n,e,t,o){e.store().manager().setValue(n,e,t,o)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),nr=Object.freeze({events:function(t,o){var n=t.resetOnDom()?[Vo(function(n,e){fc(n,t,o)}),No(function(n,e){lc(n,t,o)})]:[se(t,o,fc)];return Bo(n)}}),Do=function(){var n=tr(null);return Yo({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},fo=function(){var n=tr({});return Yo({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},bt=Object.freeze({memory:Do,dataset:fo,manual:function(){return Yo({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),St=[qn("initialValue"),Wn("getFallbackEntry"),Wn("getDataKey"),Wn("setData"),vr("manager",{setValue:dc,getValue:function(n,e,t){var o=e.store().getDataKey()(n),t=t.get();return ho(t,o).fold(function(){return e.store().getFallbackEntry()(o)},function(n){return n})},onLoad:function(e,t,o){t.store().initialValue().each(function(n){dc(e,t,o,n)})},onUnload:function(n,e,t){t.set({})},state:fo})],fo=[Wn("getValue"),Xn("setValue",S),qn("initialValue"),vr("manager",{setValue:function(n,e,t,o){e.store().setValue()(n,o),e.onSetValue()(n,o)},getValue:function(n,e,t){return e.store().getValue()(n)},onLoad:function(e,t,n){t.store().initialValue().each(function(n){t.store().setValue()(e,n)})},onUnload:S,state:qo.init})],Do=[qn("initialValue"),vr("manager",{setValue:function(n,e,t,o){t.set(o),e.onSetValue()(n,o)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:Do})],St=[Jn("store",{mode:"memory"},Ao("mode",{memory:Do,manual:fo,dataset:St})),Ur("onSetValue"),Xn("resetOnDom",!1)],Vc=pe({fields:St,name:"representing",active:nr,apis:Ht,extra:{setValueFrom:function(n,e){e=Vc.getValue(e);Vc.setValue(n,e)}},state:bt}),Ht=Tt.detect().deviceType.isTouch(),bt=[Wn("min"),Wn("max"),Xn("stepSize",1),Xn("onChange",S),Xn("onInit",S),Xn("onDragStart",S),Xn("onDragEnd",S),Xn("snapToGrid",!1),qn("snapStart"),Wn("getInitialValue"),Gr("sliderBehaviours",[Ru,Vc]),ko("value",function(n){return tr(n.min)})].concat(Ht?[]:[ko("mouseIsDown",function(){return tr(!1)})]),Nc=ai("width",function(n){return n.dom().offsetWidth}),_c=Tt.detect().deviceType.isTouch(),jc=Nr({name:"Slider",configFields:bt,partFields:Wr,factory:function(u,n,e,t){function c(n){return((n=n.element().dom().getBoundingClientRect()).left+n.right)/2}function r(n){return du(n,u,"thumb")}function o(n){var e,t,o=du(n,u,"spectrum").element().dom().getBoundingClientRect(),r=n.element().dom().getBoundingClientRect(),i=(e=n,t=o,(n=(i=u).value().get())<i.min()?lu(e,i,"left-edge").fold(function(){return 0},function(n){return c(n)-t.left}):n>i.max()?lu(e,i,"right-edge").fold(function(){return t.width},function(n){return c(n)-t.left}):(i.value().get()-i.min())/s*t.width);return o.left-r.left+i}function i(n){var e=o(n),t=r(n),n=gc(t.element())/2;ui(t.element(),"left",e-n+"px")}function a(n,e){var t=u.value().get(),o=r(n);return t!==e||Ir(o.element(),"left").isNone()?(u.value().set(e),i(n),u.onChange()(n,o,e),Ne.some(!0)):Ne.none()}var s=u.max()-u.min(),f=_c?[te(Le(),function(n,e){u.onDragStart()(n,r(n))}),te($e(),function(n,e){u.onDragEnd()(n,r(n))})]:[te(We(),function(n,e){e.stop(),u.onDragStart()(n,r(n)),u.mouseIsDown().set(!0)}),te(Ge(),function(n,e){u.onDragEnd()(n,r(n)),u.mouseIsDown().set(!1)})];return{uid:u.uid(),dom:u.dom(),components:n,behaviours:b(Ko(V([_c?[]:[Ru.config({mode:"special",focusIn:function(n){return lu(n,u,"spectrum").map(Ru.focusIn).map(O(!0))}})],[Vc.config({store:{mode:"manual",getValue:function(n){return u.value().get()}}})]])),tu(u.sliderBehaviours())),events:Bo([te(Fc,function(n,e){a(n,e.event().value())}),Vo(function(n,e){u.value().set(u.getInitialValue()());var t=r(n);i(n),u.onInit()(n,t,u.value().get())})].concat(f)),apis:{resetToMin:function(n){a(n,u.min())},resetToMax:function(n){a(n,u.max())},refresh:i},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),Hc=function(n,o){var e={onChange:function(n,e,t){o.undoManager.transact(function(){o.formatter.apply("forecolor",{value:t}),o.nodeChanged()})},getInitialValue:function(){return-1}};return pc(n,"color",function(){return vc(e)})},zc=_n([Wn("getInitialValue"),Wn("onChange"),Wn("category"),Wn("sizes")]),Lc=function(n){var r=Pn("SizeSlider",zc,n);return jc.sketch({dom:{tag:"div",classes:[ri.resolve("slider-"+r.category+"-size-container"),ri.resolve("slider"),ri.resolve("slider-size-container")]},onChange:function(n,e,t){var o;0<=(o=t)&&o<r.sizes.length&&r.onChange(t)},onDragStart:function(n,e){Zr.on(e)},onDragEnd:function(n,e){Zr.off(e)},min:0,max:r.sizes.length-1,stepSize:1,getInitialValue:r.getInitialValue,snapToGrid:!0,sliderBehaviours:Ko([ei(jc.refresh)]),components:[jc.parts().spectrum({dom:Ec('<div class="${prefix}-slider-size-container"></div>'),components:[ec('<div class="${prefix}-slider-size-line"></div>')]}),jc.parts().thumb({dom:Ec('<div class="${prefix}-slider-thumb"></div>'),behaviours:Ko([Zr.config({toggleClass:ri.resolve("thumb-active")})])})]})},Pc=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],$c={candidates:O(Pc),get:function(n){var e,n=yc(n);return e=n,B(Pc,function(n){return n===e}).getOr(2)},apply:function(t,n){n=n,Ne.from(Pc[n]).each(function(n){var e;e=n,yc(n=t)!==e&&n.execCommand("fontSize",!1,e)})}},Wc=$c.candidates(),Uc=window.Promise||(xc=Gc.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){f.setTimeout(n,1)},Tc=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)},Gc.prototype.catch=function(n){return this.then(null,n)},Gc.prototype.then=function(t,o){var r=this;return new Gc(function(n,e){Yc.call(r,new Qc(t,o,n,e))})},Gc.all=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var c=Array.prototype.slice.call(1===n.length&&Tc(n[0])?n[0]:n);return new Gc(function(r,i){if(0===c.length)return r([]);var u=c.length;for(var n=0;n<c.length;n++)!function e(t,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if("function"==typeof o)return void o.call(n,function(n){e(t,n)},i)}c[t]=n,0==--u&&r(c)}catch(n){i(n)}}(n,c[n])})},Gc.resolve=function(e){return e&&"object"==typeof e&&e.constructor===Gc?e:new Gc(function(n){n(e)})},Gc.reject=function(t){return new Gc(function(n,e){e(t)})},Gc.race=function(r){return new Gc(function(n,e){for(var t=0,o=r;t<o.length;t++)o[t].then(n,e)})},Gc);function Gc(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],Zc(n,qc(Kc,this),qc(Xc,this))}function qc(n,e){return function(){return n.apply(e,arguments)}}function Yc(t){var o=this;null!==this._state?xc(function(){var n,e=o._state?t.onFulfilled:t.onRejected;if(null!==e){try{n=e(o._value)}catch(n){return void t.reject(n)}t.resolve(n)}else(o._state?t.resolve:t.reject)(o._value)}):this._deferreds.push(t)}function Kc(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void Zc(qc(e,n),qc(Kc,this),qc(Xc,this))}this._state=!0,this._value=n,Jc.call(this)}catch(n){Xc.call(this,n)}}function Xc(n){this._state=!1,this._value=n,Jc.call(this)}function Jc(){for(var n=0,e=this._deferreds;n<e.length;n++){var t=e[n];Yc.call(this,t)}this._deferreds=[]}function Qc(n,e,t,o){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=o}function Zc(n,e,t){var o=!1;try{n(function(n){o||(o=!0,e(n))},function(n){o||(o=!0,t(n))})}catch(n){if(o)return;o=!0,t(n)}}function na(n){return t=n,new Uc(function(n){var e=new f.FileReader;e.onloadend=function(){n(e.result)},e.readAsDataURL(t)}).then(function(n){return n.split(",")[1]});var t}function ea(t){var e=wc({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Bo([ue(Je()),te(Xe(),function(n,e){!function(n){n=n.event(),n=n.raw().target.files||n.raw().dataTransfer.files;return Ne.from(n[0])}(e).each(function(n){var o,r;o=t,is(r=n).then(function(t){o.undoManager.transact(function(){var n=o.editorUpload.blobCache,e=n.create(iu("mceu"),r,t);n.add(e);e=o.dom.createHTML("img",{src:e.blobUri()});o.insertContent(e)})})})})])});return kc.sketch({dom:Ec('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})}function ta(n){return n.dom().textContent}function oa(n){return 0<n.length}function ra(n){return null==n?"":n}function ia(e,t,n){return n.text.filter(oa).fold(function(){return be(n=e,"href")===ta(n)?Ne.some(t):Ne.none();var n},Ne.some)}function ua(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)}function ca(n){return n.dom().value}function aa(n,e){if(void 0===e)throw new Error("Value.set was undefined");n.dom().value=e}function sa(n){return b(Ko([Vc.config({store:{mode:"manual",initialValue:n.data().getOr(void 0),getValue:function(n){return ca(n.element())},setValue:function(n,e){ca(n.element())!==e&&aa(n.element(),e)}},onSetValue:n.onSetValue()})]),(e=n,Ko([ii.config({onFocus:!1===e.selectOnFocus()?S:function(n){var e=n.element(),n=ca(e);e.dom().setSelectionRange(0,n.length)}})])),tu(n.inputBehaviours()));var e}function fa(n,e){var t=wc(gs.sketch({placeholder:e,onSetValue:function(n,e){P(n,Ke())},inputBehaviours:Ko([ls.config({find:Ne.some}),ps.config({}),Ru.config({mode:"execution"})]),selectOnFocus:!1})),e=wc(kc.sketch({dom:Ec('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){n=t.get(n);Vc.setValue(n,"")}}));return{name:n,spec:ds.sketch({dom:Ec('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),e.asSpec()],containerBehaviours:Ko([Zr.config({toggleClass:ri.resolve("input-container-empty")}),ls.config({find:function(n){return Ne.some(t.get(n))}}),fs("input-clearing",[te(Ke(),function(n){var e=t.get(n);(0<Vc.getValue(e).length?Zr.off:Zr.on)(n)})])])})}}function la(n,e,t){e.disabled()&&vs(n,e)}function da(n){return D(hs,q(n.element()))}function ma(n){ve(n.element(),"disabled","disabled")}function ga(n){xe(n.element(),"disabled")}function pa(n){ve(n.element(),"aria-disabled","true")}function ha(n){ve(n.element(),"aria-disabled","false")}function va(n){return da(n)?we(n.element(),"disabled"):"true"===be(n.element(),"aria-disabled")}function ya(n){return"<alloy.field."+n+">"}function ba(){function e(){t.get().each(function(n){n.destroy()})}var t=tr(Ne.none());return{clear:function(){e(),t.set(Ne.none())},isSet:function(){return t.get().isSome()},set:function(n){e(),t.set(Ne.some(n))},run:function(n){t.get().each(n)}}}function wa(){var e=tr(Ne.none());return{clear:function(){e.set(Ne.none())},set:function(n){e.set(Ne.some(n))},isSet:function(){return e.get().isSome()},on:function(n){e.get().each(n)}}}function xa(n){function o(e,n,t){return kc.sketch({dom:Ec('<span class="${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:function(n){$(n,u,{direction:e})},buttonBehaviours:Ko([ys.config({disableClass:ri.resolve("toolbar-navigation-disabled"),disabled:!t})])})}function r(n,o){var r=di(n.element(),"."+ri.resolve("serialised-dialog-screen"));gi(n.element(),"."+ri.resolve("serialised-dialog-chain")).each(function(t){0<=c.state.currentScreen.get()+o&&c.state.currentScreen.get()+o<r.length&&(Ir(t,"left").each(function(n){var e=parseInt(n,10),n=gc(r[0]);ui(t,"left",e-o*n+"px")}),c.state.currentScreen.set(c.state.currentScreen.get()+o))})}function i(t){var n=di(t.element(),"input");Ne.from(n[c.state.currentScreen.get()]).each(function(n){t.getSystem().getByDom(n).each(function(n){var e;e=t,n=n.element(),e.getSystem().triggerFocus(n,e.element())})}),n=s.get(t),ku.highlightAt(n,c.state.currentScreen.get())}var u="navigateEvent",e=To([Wn("fields"),Xn("maxFieldIndex",n.fields.length-1),Wn("onExecute"),Wn("getInitialValue"),ko("state",function(){return{dialogSwipeState:wa(),currentScreen:tr(0)}})]),c=Pn("SerialisedDialog",e,n),a=wc(xs(function(t){return{dom:Ec('<div class="${prefix}-serialised-dialog"></div>'),components:[ds.sketch({dom:Ec('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:pt(c.fields,function(n,e){return e<=c.maxFieldIndex?ds.sketch({dom:Ec('<div class="${prefix}-serialised-dialog-screen"></div>'),components:V([[o(-1,"previous",0<e)],[t.field(n.name,n.spec)],[o(1,"next",e<c.maxFieldIndex)]])}):t.field(n.name,n.spec)})})],formBehaviours:Ko([ei(function(n,e){var t;t=e,gi(n.element(),"."+ri.resolve("serialised-dialog-chain")).each(function(n){ui(n,"left",-c.state.currentScreen.get()*t.width+"px")})}),Ru.config({mode:"special",focusIn:function(n){i(n)},onTab:function(n){return r(n,1),Ne.some(!0)},onShiftTab:function(n){return r(n,-1),Ne.some(!0)}}),fs("form-events",[Vo(function(e,n){c.state.currentScreen.set(0),c.state.dialogSwipeState.clear();var t=s.get(e);ku.highlightFirst(t),c.getInitialValue(e).each(function(n){Vc.setValue(e,n)})}),jo(c.onExecute),te(Qe(),function(n,e){"left"===e.event().raw().propertyName&&i(n)}),te(u,function(n,e){e=e.event().direction();r(n,e)})])])}})),s=wc({dom:Ec('<div class="${prefix}-dot-container"></div>'),behaviours:Ko([ku.config({highlightClass:ri.resolve("dot-active"),itemClass:ri.resolve("dot-item")})]),components:N(c.fields,function(n,e){return e<=c.maxFieldIndex?[ec('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:Ec('<div class="${prefix}-serializer-wrapper"></div>'),components:[a.asSpec(),s.asSpec()],behaviours:Ko([Ru.config({mode:"special",focusIn:function(n){n=a.get(n);Ru.focusIn(n)}}),fs("serializer-wrapper-events",[te(Le(),function(n,e){e=e.event();c.state.dialogSwipeState.set(Ts(e.touches[0].clientX))}),te(Pe(),function(n,e){var t=e.event();c.state.dialogSwipeState.on(function(n){e.event().prevent(),c.state.dialogSwipeState.set(Ss(n,t.raw().touches[0].clientX))})}),te($e(),function(t){c.state.dialogSwipeState.on(function(n){var e=a.get(t),n=-1*Os(n);r(e,n)})})])])}}function Ta(e){function n(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+mr(e().element())+" is not in context.")}}return Is({debugInfo:O("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),isConnected:O(!1)})}function Sa(n,r){var i={};return je(n,function(n,o){je(n,function(n,e){var t=Cn(e,[])(i);i[e]=t.concat([r(o,n)])})}),i}function Oa(n){return n.cHandler}function ka(n,e){return{name:O(n),handler:O(e)}}function Ca(n,e,t){var o,r,e=b(t,(o=n,r={},I(e,function(n){r[n.name()]=n.handlers(o)}),r));return Sa(e,ka)}function Ea(n){var r=p(n=n)?{can:O(!0),abort:O(!1),run:n}:n;return function(n,e){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];n=[n,e].concat(t);r.abort.apply(void 0,n)?e.stop():r.can.apply(void 0,n)&&r.run.apply(void 0,n)}}function Da(n,e,t){return(e=e[t])?function(r,i,n,u){var e=n.slice(0);try{var t=e.sort(function(n,e){var t=n[i](),o=e[i](),n=u.indexOf(t),e=u.indexOf(o);if(-1===n)throw new Error("The ordering for "+r+" does not have an entry for "+t+".\nOrder specified: "+wo(u,null,2));if(-1===e)throw new Error("The ordering for "+r+" does not have an entry for "+o+".\nOrder specified: "+wo(u,null,2));return n<e?-1:e<n?1:0});return io.value(t)}catch(n){return io.error([n])}}("Event: "+t,"name",n,e).map(function(n){n=pt(n,function(n){return n.handler()});return ne(n)}):(t=t,n=n,io.error(["The event ("+t+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+wo(pt(n,function(n){return n.name()}),null,2)]))}function Ia(n){return zn("custom.definition",_n([Co("dom","dom",ao(),_n([Wn("tag"),Xn("styles",{}),Xn("classes",[]),Xn("attributes",{}),qn("value"),qn("innerHtml")])),Wn("components"),Wn("uid"),Xn("events",{}),Xn("apis",O({})),Co("eventOrder","eventOrder",co.mergeWithThunk(O({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]})),Mo()),qn("domModification"),yr("originalSpec"),Xn("debug.sketcher","unknown")]),n)}function Aa(n){var e={tag:n.dom().tag(),classes:n.dom().classes(),attributes:b((e=n,vo(Yu(),e.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:pt(n.components(),function(n){return n.element()})};return zo(b(e,n.dom().innerHtml().map(function(n){return vo("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return vo("value",n)}).getOr({})))}function Ma(e,n){I(n,function(n){Ee(e,n)})}function Fa(e,n){I(n,function(n){De(e,n)})}function Ra(e){if(e.domChildren().isSome()&&e.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+function(n){n=Lo(n);return wo(n,null,2)}(e));return e.domChildren().fold(function(){var n=e.defChildren().getOr([]);return pt(n,Rs)},function(n){return n})}function Ba(n){var e=jt.fromTag(n.tag());ye(e,n.attributes().getOr({})),Ma(e,n.classes().getOr([])),Er(e,n.styles().getOr({})),lr(e,n.innerHtml().getOr(""));var t=Ra(n);return mn(e,t),n.value().each(function(n){aa(e,n)}),e}function Va(n,e){return t=n,e=pt(n=e,function(n){return Yn(n.name(),[Wn("config"),Xn("state",qo)])}),e=zn("component.behaviours",To(e),t.behaviours).fold(function(n){throw new Error(Io(n)+"\nComplete spec:\n"+wo(t,null,2))},function(n){return n}),{list:n,data:T(e,function(n){var e=n().map(function(n){return{config:n.config(),state:n.state().init(n.config())}});return function(){return e}})};var t}function Na(n){var e,t=(e=ho(t=n,"behaviours").getOr({}),t=A(_e(e),function(n){return void 0!==e[n]}),pt(t,function(n){return e[n].me}));return Va(n,t)}function _a(n,e,t){var o=Aa(n);return function(n,e){n=b({tag:n.tag(),classes:e.classes().getOr([]).concat(n.classes().getOr([])),attributes:w(n.attributes().getOr({}),e.attributes().getOr({})),styles:w(n.styles().getOr({}),e.styles().getOr({}))},e.innerHtml().or(n.innerHtml()).map(function(n){return vo("innerHtml",n)}).getOr({}),ae("domChildren",e.domChildren(),n.domChildren()),ae("defChildren",e.defChildren(),n.defChildren()),e.value().or(n.value()).map(function(n){return vo("value",n)}).getOr({}));return zo(n)}(o,function(e,n,t,o){var r=b({},n);I(t,function(n){r[n.name()]=n.exhibit(e,o)});t=Sa(r,function(n,e){return{name:function(){return n},modification:e}}),t=T(t,function(n,e){return N(n,function(e){return e.modification().fold(function(){return[]},function(n){return[e]})})}),t=ze(t,function(e,t){return ho(As,t).fold(function(){return io.error("Unknown field type: "+t)},function(n){return n(e,t)})});return Dn(t,{}).map(Po)}(t,{"alloy.base.modification":n.domModification().fold(function(){return Po({})},Po)},e,o).getOrDie())}function ja(n,e,t){var o={"alloy.base.behaviour":n.events()};return function(n,e,t,o){o=Ca(n,t,o);return Fs(o,e)}(t,n.eventOrder(),e,o).getOrDie()}function Ha(n){var t,e,o,r,i,u,c,n=function(n){n=Cn("components",[])(n);return pt(n,Ns)}(a=Ds(n)),a=b(Es,a,vo("components",n));return io.value((t=a,e=tr(Ta(s)),o=Ln(Ia(b(t,{behaviours:void 0}))),n=Na(t),a=n.list,r=n.data,n=_a(o,a,r),i=Ba(n),a=ja(o,a,r),u=tr(o.components()),c=Bs({getSystem:e.get,config:function(n){if(n===qu())return o.apis();if(m(n))throw new Error("Invalid input: only API constant is allowed");var e=r;return(p(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+wo(t,null,2))})()},hasConfigured:function(n){return p(r[n.name()])},spec:O(t),readState:function(n){return r[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){e.set(n)},disconnect:function(){e.set(Ta(s))},element:O(i),syncComponents:function(){var n=Jt(i),n=N(n,function(n){return e.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});u.set(n)},components:u.get,events:O(a)})));function s(){return c}}function za(n){return n=jt.fromText(n),Vs({element:n})}function La(n){(sr(n.element()).isNone()||ii.isFocused(n))&&(ii.isFocused(n)||ii.focus(n),$(n,js,{item:n}))}function Pa(n){$(n,Hs,{item:n})}function $a(){return"item-widget"}function Wa(n,t){var o=cn(t),e=ar(o).bind(function(e){function n(n){return un(e,n)}var o,r;return n(t)?Ne.some(t):(o=n,(r=function(n){for(var e=0;e<n.childNodes.length;e++){var t=jt.fromDom(n.childNodes[e]);if(o(t))return Ne.some(t);t=r(n.childNodes[e]);if(t.isSome())return t}return Ne.none()})(t.dom()))}),n=n(t);return e.each(function(e){ar(o).filter(function(n){return un(n,e)}).fold(function(){ur(e)},S)}),n}function Ua(n,e,t,o){o=n.getSystem().build(o),to(n,o,t)}function Ga(n,e){var t={};je(n,function(n,e){I(n,function(n){t[n]=e})});var o=e,r=He(e,function(n,e){return{k:n,v:e}}),i=T(r,function(n,e){return[e].concat(Ys(t,o,r,e))});return T(t,function(n){return ho(i,n).getOr([n])})}function qa(n,e,t,o){return ho(e.routes(),o.start()).map(r).bind(function(n){return ho(n,o.destination()).map(r)})}function Ya(e,t,n){var o,r,i;i=n,Zs(o=e,r=t).bind(function(n){return Qs(o,r,i,n)}).each(function(n){n=n.transition();De(e.element(),n.transitionClass()),xe(e.element(),t.destinationAttr())})}function Ka(n,e,t,o){Ya(n,e,t),we(n.element(),e.stateAttr())&&be(n.element(),e.stateAttr())!==o&&e.onFinish()(n,o),ve(n.element(),e.stateAttr(),o)}function Xa(n){return ho(n,"format").getOr(n.title)}function Ja(n){return In(n,"items")?(t=b(kn(e=n,["items"]),{menu:!0}),o=cf(e.items),{item:t,menus:b(o.menus,vo(e.title,o.items)),expansions:b(o.expansions,vo(e.title,e.title))}):{item:n,menus:{},expansions:{}};var e,t,o}function Qa(n){return 0<(n=n.replace(/\|/g," ").trim()).length?n.split(/\s+/):[]}function Za(n){return n=void 0!==n.toolbar?n.toolbar:lf,(a(n)?df:Qa)(n)}function ns(a,s){return function(n){var e,t,o,r,i,u,c;a(n)&&(r=jt.fromDom(n.target),c=l(u=function(){n.preventDefault()},i=function(){n.stopPropagation()}),e=r,t=n.clientX,o=n.clientY,r=i,i=u,u=c,c=n,c={target:O(e),x:O(t),y:O(o),stop:r,prevent:i,kill:u,raw:O(c)},s(c))}}function es(n,e,t,o,r){return o=ns(t,o),n.dom().addEventListener(e,o,r),{unbind:s(pf,n,e,o,r)}}function ts(n,e,t){return es(n,e,hf,t,!1)}function os(n,e,t){return es(n,e,hf,t,!0)}function rs(n){return n=n.matchMedia("(orientation: portrait)").matches,{isPortrait:O(n)}}var is=na,us=function(n){n=jt.fromDom(n.selection.getStart());return pi(n,"a")},cs={getInfo:function(n){return us(n).fold(function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:Ne.none()}},function(n){return t=ta(e=n),o=be(e,"href"),r=be(e,"title"),n=be(e,"target"),{url:ra(o),text:t!==o?ra(t):"",title:ra(r),target:ra(n),link:Ne.some(e)};var e,t,o,r})},applyInfo:function(r,i){i.url.filter(oa).fold(function(){var e;e=r,i.link.bind(v).each(function(n){e.execCommand("unlink")})},function(t){var n,e,o=(n=i,(e={}).href=t,n.title.filter(oa).each(function(n){e.title=n}),n.target.filter(oa).each(function(n){e.target=n}),e);i.link.bind(v).fold(function(){var n=i.text.filter(oa).getOr(t);r.insertContent(r.dom.createHTML("a",o,r.dom.encode(n)))},function(e){var n=ia(e,t,i);ye(e,o),n.each(function(n){n=n,e.dom().textContent=n})})})},query:us},as=Tt.detect(),ss=function(n,e){(as.os.isAndroid()?ua:r)(e,n)},fs=function(n,e){return{key:n,value:{config:{},me:function(n,e){e=Bo(e);return pe({fields:[Wn("enabled")],name:n,active:{events:O(e)}})}(n,e),configAsRaw:O({}),initialConfig:{},state:qo}}},Ht=Object.freeze({getCurrent:function(n,e,t){return e.find()(n)}}),bt=[Wn("find")],ls=pe({fields:bt,name:"composing",apis:Ht}),ds=zt({name:"Container",factory:function(n){return{uid:n.uid(),dom:b({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:tu(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[Xn("components",[]),Gr("containerBehaviours",[]),Xn("events",{}),Xn("domModification",{}),Xn("eventOrder",{})]}),ms=zt({name:"DataField",factory:function(t){return{uid:t.uid(),dom:t.dom(),behaviours:b(Ko([Vc.config({store:{mode:"memory",initialValue:t.getInitialValue()()}}),ls.config({find:Ne.some})]),tu(t.dataBehaviours())),events:Bo([Vo(function(n,e){Vc.setValue(n,t.getInitialValue()())})])}},configFields:[Wn("uid"),Wn("dom"),Wn("getInitialValue"),Gr("dataBehaviours",[Vc,ls])]}),Wr=O([qn("data"),Xn("inputAttributes",{}),Xn("inputStyles",{}),Xn("type","input"),Xn("tag","input"),Xn("inputClasses",[]),Ur("onSetValue"),Xn("styles",{}),qn("placeholder"),Xn("eventOrder",{}),Gr("inputBehaviours",[Vc,ii]),Xn("selectOnFocus",!0)]),gs=zt({name:"Input",configFields:Wr(),factory:function(n,e){return{uid:n.uid(),dom:{tag:(t=n).tag(),attributes:b(En([{key:"type",value:t.type()}].concat(t.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),t.inputAttributes()),styles:t.inputStyles(),classes:t.inputClasses()},components:[],behaviours:sa(n),eventOrder:n.eventOrder()};var t}}),bt=Object.freeze({exhibit:function(n,e){return Po({attributes:En([{key:e.tabAttr(),value:"true"}])})}}),Ht=[Xn("tabAttr","data-alloy-tabstop")],ps=pe({fields:Ht,name:"tabstopping",active:bt}),hs=["input","button","textarea"],vs=function(e,n,t){n.disableClass().each(function(n){Ee(e.element(),n)}),(da(e)?ma:pa)(e)},Wr=Object.freeze({enable:function(e,n,t){n.disableClass().each(function(n){De(e.element(),n)}),(da(e)?ga:ha)(e)},disable:vs,isDisabled:va,onLoad:la}),Ht=Object.freeze({exhibit:function(n,e,t){return Po({classes:e.disabled()?e.disableClass().map(H).getOr([]):[]})},events:function(n,e){return Bo([ee(Et(),function(n,e){return va(n)}),se(n,e,la)])}}),bt=[Xn("disabled",!1),qn("disableClass")],ys=pe({fields:bt,name:"disabling",active:Ht,apis:Wr}),bs=[Gr("formBehaviours",[Vc])],ws=function(o,n,e){return b({"debug.sketcher":{Form:e},uid:o.uid(),dom:o.dom(),components:n,behaviours:b(Ko([Vc.config({store:{mode:"manual",getValue:function(n){var e,t,e=(e=o,t=n.getSystem(),T(e.partUids(),function(n,e){return O(t.getByUid(n))}));return T(e,function(n,e){return n().bind(ls.getCurrent).map(Vc.getValue)})},setValue:function(t,n){je(n,function(e,n){lu(t,o,n).each(function(n){ls.getCurrent(n).each(function(n){Vc.setValue(n,e)})})})}}})]),tu(o.formBehaviours())),apis:{getField:function(n,e){return lu(n,o,e).bind(ls.getCurrent)}}})},xs=(hu(function(n,e,t){return n.getField(e,t)}),function(n){var o,e=(o=[],{field:function(n,e){return o.push(n),t="form",n=ya(n),e=e,{uiType:Hu(),owner:t,name:n,config:e,validated:{}};var t},record:function(){return o}}),n=n(e),e=e.record(),e=pt(e,function(n){return Lu({name:n,pname:ya(n)})});return yu("form",bs,e,ws,n)}),Ts=function(n){return{xValue:n,points:[]}},Ss=function(n,e){if(e===n.xValue)return n;var t=0<e-n.xValue?1:-1,o={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([o])}},Os=function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,n=n.points[n.points.length-1].direction;return-1===e&&-1===n?-1:1===e&&1===n?1:0},ks=k(function(e,t){return[{label:"the link group",items:[xa({fields:[fa("url","Type or paste URL"),fa("text","Link text"),fa("title","Link title"),fa("target","Link target"),{name:"link",spec:ms.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return Ne.none()}})}],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return Ne.some(cs.getInfo(t))},onExecute:function(n){n=Vc.getValue(n);cs.applyInfo(t,n),e.restoreToolbar(),t.focus()}})]}]}),Cs=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Ht=Bo([{key:Ot(),value:Zn({can:function(n,e){var t,o=e.event().originator(),r=e.event().target();return t=r,!(un(e=o,n.element())&&!un(e,t))||(f.console.warn(Ot()+" did not get interpreted by the desired target. \nOriginator: "+mr(o)+"\nTarget: "+mr(r)+"\nCheck the "+Ot()+" event handlers"),!1)}})}]),Es=Object.freeze({events:Ht}),Ds=v,Is=Go(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),As={classes:function(n,e){n=N(n,function(n){return n.modification().getOr([])});return io.value(vo(e,n))},attributes:Ht=function(u,c){return F(u,function(n,e){var t=e.modification().getOr({});return n.bind(function(i){var n=ze(t,function(n,e){return void 0!==i[e]?(t=c,o=e,r=u,io.error("Mulitple behaviours have tried to change the _"+o+'_ "'+t+'". The guilty behaviours are: '+wo(N(r,function(n){return void 0!==n.modification().getOr({})[o]?[n.name()]:[]}),null,2)+". This is not currently supported.")):io.value(vo(e,n));var t,o,r});return Dn(n,i)})},io.value({})).map(function(n){return vo(c,n)})},styles:Ht,domChildren:Wr=function(n,e){return 1<n.length?io.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+wo(pt(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?io.value({}):io.value(n[0].modification().fold(function(){return{}},function(n){return vo(e,n)}))},defChildren:Wr,innerHtml:Wr,value:Wr},Ms=function(n,e){return e=s.apply(void 0,[n.handler].concat(e)),n=n.purpose(),{cHandler:e,purpose:O(n)}},Fs=function(n,r){n=ze(n,function(t,o){return(1===t.length?io.value(t[0].handler()):Da(t,r,o)).map(function(n){var e=Ea(n),n=1<t.length?A(r,function(e){return D(t,function(n){return n.name()===e})}).join(" > "):t[0].name();return vo(o,{handler:e,purpose:O(n)})})});return Dn(n,{})},Rs=function(n){n=zo(n);return Ba(n)},Bs=Go(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),Vs=function(n){var t=$n("external.component",_n([Wn("element"),qn("uid")]),n),e=tr(Ta());t.uid().each(function(n){var e;e=t.element(),ve(e,Xu,n)});var o=Bs({getSystem:e.get,config:Ne.none,hasConfigured:O(!1),connect:function(n){e.set(n)},disconnect:function(){e.set(Ta(function(){return o}))},element:O(t.element()),spec:O(n),readState:O("No state"),syncComponents:S,components:O([]),events:O({})});return pu(o)},Ns=function(e){return ho(e,Uu).fold(function(){var n=b({uid:Qu("")},e);return Ha(n).getOrDie()},function(n){return n})},_s=pu,js="alloy.item-hover",Hs="alloy.item-focus",zs=O(js),Ls=O(Hs),Ht=[Wn("data"),Wn("components"),Wn("dom"),qn("toggling"),Xn("itemBehaviours",{}),Xn("ignoreFocus",!1),Xn("domModification",{}),vr("builder",function(n){return{dom:b(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:b(Ko([n.toggling().fold(Zr.revoke,function(n){return Zr.config(b({aria:{mode:"checked"}},n))}),ii.config({ignore:n.ignoreFocus(),onFocus:function(n){Pa(n)}}),Ru.config({mode:"execution"}),Vc.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Bo([(e=At(),o=W,te(e,function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){o(e,n,t)})})),ue(We()),te(qe(),La),te(Dt(),ii.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()};var e,o}),Xn("eventOrder",{})],Wr=[Wn("dom"),Wn("components"),vr("builder",function(n){return{dom:n.dom(),components:n.components(),events:Bo([(n=Dt(),te(n,function(n,e){e.stop()}))])}})],Ps=O([Lu({name:"widget",overrides:function(e){return{behaviours:Ko([Vc.config({store:{mode:"manual",getValue:function(n){return e.data()},setValue:function(){}}})])}}})]),Go=[Wn("uid"),Wn("data"),Wn("components"),Wn("dom"),Xn("autofocus",!1),Xn("domModification",{}),gu(Ps()),vr("builder",function(t){function o(n){return lu(n,t,"widget").map(function(n){return Ru.focusIn(n),n})}var n=su($a(),t,Ps()),e=fu($a(),t,n.internals()),n=function(n,e){return Fi(e.event().target())||t.autofocus()&&e.setSource(n.element()),Ne.none()};return b({dom:t.dom(),components:e,domModification:t.domModification(),events:Bo([jo(function(n,e){o(n).each(function(n){e.stop()})}),te(qe(),La),te(Dt(),function(n,e){t.autofocus()?o(n):ii.focus(n)})]),behaviours:Ko([Vc.config({store:{mode:"memory",initialValue:t.data()}}),ii.config({onFocus:function(n){Pa(n)}}),Ru.config({mode:"special",focusIn:t.autofocus()?function(n){o(n)}:Qo(),onLeft:n,onRight:n,onEscape:function(n,e){return ii.isFocused(n)||t.autofocus()?(t.autofocus()&&e.setSource(n.element()),Ne.none()):(ii.focus(n),Ne.some(!0))}})])})})],$s=Ao("type",{widget:Go,item:Ht,separator:Wr}),Wr=O([Zo({factory:{sketch:function(n){n=$n("menu.spec item",$s,n);return n.builder()(n)}},name:"items",unit:"item",defaults:function(n,e){var t=Qu("");return b({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),Yr=O([Wn("value"),Wn("items"),Wn("dom"),Wn("components"),Xn("eventOrder",{}),Gr("menuBehaviours",[ku,Vc,ls,Ru]),Jn("movement",{mode:"menu",moveOnTab:!0},Ao("mode",{grid:[Yr(),vr("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[Xn("moveOnTab",!0),vr("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),Un("markers",$r()),Xn("fakeFocus",!1),Xn("focusManager",Ai()),Ur("onHighlight")]),Ws=O("alloy.menu-focus"),Us=Nr({name:"Menu",configFields:Yr(),partFields:Wr(),factory:function(n,e,t,o){return b({dom:b(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:b(Ko([ku.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),Vc.config({store:{mode:"memory",initialValue:n.value()}}),ls.config({find:Ne.some}),Ru.config(n.movement().config()(n,n.movement()))]),tu(n.menuBehaviours())),events:Bo([te(Ls(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){ku.highlight(e,n),t.stop(),$(e,Ws(),{menu:e,item:n})})}),te(zs(),function(n,e){e=e.event().item();ku.highlight(n,e)})]),components:e,eventOrder:n.eventOrder()})}}),Gs=function(n,e){return n.components()},qs=pe({fields:[],name:"replacing",apis:Object.freeze({append:function(n,e,t,o){Ua(n,0,Qt,o)},prepend:function(n,e,t,o){Ua(n,0,dn,o)},remove:function(n,e,t,o){n=Gs(n);R(n,function(n){return un(o.element(),n.element())}).each(vn)},set:function(e,n,t,o){var r,i;i=(r=e).components(),I(i,hn),gn(r.element()),r.syncComponents(),Wa(function(){var n=pt(o,e.getSystem().build);I(n,function(n){pn(e,n)})},e.element())},contents:Gs})}),Ys=function(t,o,r,n){return ho(r,n).bind(function(n){return ho(t,n).bind(function(n){var e=Ys(t,o,r,n);return Ne.some([n].concat(e))})}).getOr([])},Ks=function(){function n(n){return ho(i.get(),n)}var r=tr({}),i=tr({}),u=tr({}),c=tr(Ne.none()),a=tr({});return{setContents:function(n,e,t,o){c.set(Ne.some(n)),r.set(t),i.set(e),a.set(o);t=Ga(o,t);u.set(t)},expand:function(t){return ho(r.get(),t).map(function(n){var e=ho(u.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return ho(u.get(),n)},collapse:function(n){return ho(u.get(),n).bind(function(n){return 1<n.length?Ne.some(n.slice(1)):Ne.none()})},lookupMenu:n,otherMenus:function(n){var e,t=a.get();return t=_e(t),e=n,A(t,function(n){return!D(e,n)})},getPrimary:function(){return c.get().bind(n)},getMenus:function(){return i.get()},clear:function(){r.set({}),i.set({}),u.set({}),c.set(Ne.none())},isClear:function(){return c.get().isNone()}}},Xs=O("collapse-item"),Js=zt({name:"TieredMenu",configFields:[qr("onExecute"),qr("onEscape"),n("onOpenMenu"),n("onOpenSubmenu"),Ur("onCollapseMenu"),Xn("openImmediately",!0),Gn("data",[Wn("primary"),Wn("menus"),Wn("expansions")]),Xn("fakeFocus",!1),Ur("onHighlight"),Ur("onHover"),Gn("markers",[Wn("backgroundMenu")].concat(Lr()).concat(Pr())),Wn("dom"),Xn("navigateOnHover",!0),Xn("stayInDom",!1),Gr("tmenuBehaviours",[Ru,ku,ls,qs]),Xn("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(i,o){function r(t,n){return T(n,function(n,e){n=Us.sketch(b(n,{value:e,items:n.items,markers:On(o.markers,["item","selectedItem"]),fakeFocus:i.fakeFocus(),onHighlight:i.onHighlight(),focusManager:i.fakeFocus()?{get:function(n){return ku.getHighlighted(n).map(function(n){return n.element()})},set:function(e,n){e.getSystem().getByDom(n).fold(S,function(n){ku.highlight(e,n)})}}:Ai()}));return t.getSystem().build(n)})}function u(n){return Vc.getValue(n).value}function c(e,n){ku.highlight(e,n),ku.getHighlighted(n).orThunk(function(){return ku.getFirst(n)}).each(function(n){U(e,n.element(),Dt())})}function a(n,e){return gr(pt(e,n.lookupMenu))}function s(t,o,r){return Ne.from(r[0]).bind(o.lookupMenu).map(function(n){var e=a(o,r.slice(1));I(e,function(n){Ee(n.element(),i.markers().backgroundMenu())}),Y(n.element())||qs.append(t,_s(n)),Fa(n.element(),[i.markers().backgroundMenu()]),c(t,n);e=a(o,o.otherMenus(r));return I(e,function(n){Fa(n.element(),[i.markers().backgroundMenu()]),i.stayInDom()||qs.remove(t,n)}),n})}function f(e,t){var n=u(t);return l.expand(n).bind(function(n){return Ne.from(n[0]).bind(l.lookupMenu).each(function(n){Y(n.element())||qs.append(e,_s(n)),i.onOpenSubmenu()(e,t,n),ku.highlightFirst(n)}),s(e,l,n)})}function t(e,t){var n=u(t);return l.collapse(n).bind(function(n){return s(e,l,n).map(function(n){return i.onCollapseMenu()(e,t,n),n})})}function n(t){return function(e,n){return pi(n.getSource(),"."+i.markers().item()).bind(function(n){return e.getSystem().getByDom(n).toOption().bind(function(n){return t(e,n).map(function(){return!0})})})}}var l=Ks(),d=function(n){return T(i.data().menus(),function(n,e){return N(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},e=Bo([te(Ws(),function(n,e){e=e.event().menu();ku.highlight(n,e)}),jo(function(e,n){n=n.event().target();e.getSystem().getByDom(n).each(function(n){0===u(n).indexOf("collapse-item")&&t(e,n),f(e,n).fold(function(){i.onExecute()(e,n)},function(){})})}),Vo(function(e,n){var t,o;o=r(t=e,i.data().menus()),t=d(),l.setContents(i.data().primary(),o,i.data().expansions(),t),l.getPrimary().each(function(n){qs.append(e,_s(n)),i.openImmediately()&&(c(e,n),i.onOpenMenu()(e,n))})})].concat(i.navigateOnHover()?[te(zs(),function(n,e){var t,o=e.event().item();t=n,e=u(e=o),l.refresh(e).bind(function(n){return s(t,l,n)}),f(n,o),i.onHover()(n,o)})]:[]));return{uid:i.uid(),dom:i.dom(),behaviours:b(Ko([Ru.config({mode:"special",onRight:n(function(n,e){return Fi(e.element())?Ne.none():f(n,e)}),onLeft:n(function(n,e){return Fi(e.element())?Ne.none():t(n,e)}),onEscape:n(function(n,e){return t(n,e).orThunk(function(){return i.onEscape()(n,e).map(function(){return n})})}),focusIn:function(e,n){l.getPrimary().each(function(n){U(e,n.element(),Dt())})}}),ku.config({highlightClass:i.markers().selectedMenu(),itemClass:i.markers().menu()}),ls.config({find:function(n){return ku.getHighlighted(n)}}),qs.config({})]),tu(i.tmenuBehaviours())),eventOrder:i.eventOrder(),apis:{collapseMenu:function(e){ku.getHighlighted(e).each(function(n){ku.getHighlighted(n).each(function(n){t(e,n)})})}},events:e}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:vo(n,e),expansions:{}}},collapseItem:function(n){return{value:iu(Xs()),text:n}}}}),Qs=function(n,e,t,o){return qa(0,e,0,o).bind(function(e){return e.transition().map(function(n){return{transition:O(n),route:O(e)}})})},Zs=function(n,e,t){var o=n.element();return we(o,e.destinationAttr())?Ne.some({start:O(be(n.element(),e.stateAttr())),destination:O(be(n.element(),e.destinationAttr()))}):Ne.none()},qr=Object.freeze({findRoute:qa,disableTransition:Ya,getCurrentRoute:Zs,jumpTo:Ka,progressTo:function(e,t,o,r){i=t,we((n=e).element(),i.destinationAttr())&&(ve(n.element(),i.stateAttr(),be(n.element(),i.destinationAttr())),xe(n.element(),i.destinationAttr()));var n,i,i=(n=t,i=r,{start:O(be(e.element(),n.stateAttr())),destination:O(i)});Qs(e,t,o,i).fold(function(){Ka(e,t,o,r)},function(n){Ya(e,t,o);n=n.transition();Ee(e.element(),n.transitionClass()),ve(e.element(),t.destinationAttr(),r)})},getState:function(n,e,t){n=n.element();return we(n,e.stateAttr())?Ne.some(be(n,e.stateAttr())):Ne.none()}}),n=Object.freeze({events:function(r,i){return Bo([te(Qe(),function(t,n){var o=n.event().raw();Zs(t,r).each(function(e){qa(0,r,0,e).each(function(n){n.transition().each(function(n){o.propertyName===n.property()&&(Ka(t,r,i,e.destination()),r.onTransition()(t,e))})})})}),Vo(function(n,e){Ka(n,r,i,r.initialState())})])}}),So=[Xn("destinationAttr","data-transitioning-destination"),Xn("stateAttr","data-transitioning-state"),Wn("initialState"),Ur("onTransition"),Ur("onFinish"),Un("routes",So(io.value,So(io.value,_n([Kn("transition",[Wn("property"),Wn("transitionClass")])]))))],nf=pe({fields:So,name:"transitioning",active:n,apis:qr,extra:{createRoutes:function(n){var t={};return je(n,function(n,e){e=e.split("<->");t[e[0]]=vo(e[1],n),t[e[1]]=vo(e[0],n)}),t},createBistate:function(n,e,t){return En([{key:n,value:vo(e,t)},{key:e,value:vo(n,t)}])},createTristate:function(n,e,t,o){return En([{key:n,value:En([{key:e,value:o},{key:t,value:o}])},{key:e,value:En([{key:n,value:o},{key:t,value:o}])},{key:t,value:En([{key:n,value:o},{key:e,value:o}])}])}}}),ef=ri.resolve("scrollable"),tf={register:function(n){Ee(n,ef)},deregister:function(n){De(n,ef)},scrollable:O(ef)},of=function(n,e,t,o,r){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:r?[ri.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:ri.resolve("format-matches"),selected:t},itemBehaviours:Ko(r?[]:[ni(n,function(n,e){(e?Zr.on:Zr.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:o},innerHtml:e}}]}},rf=function(n,e,t,o){return{value:n,dom:{tag:"div"},components:[kc.sketch({dom:{tag:"div",classes:[ri.resolve("styles-collapser")]},components:o?[{dom:{tag:"span",classes:[ri.resolve("styles-collapse-icon")]}},za(n)]:[za(n)],action:function(n){o&&(n=t().get(n),Js.collapseMenu(n))}}),{dom:{tag:"div",classes:[ri.resolve("styles-menu-items-container")]},components:[Us.parts().items({})],behaviours:Ko([fs("adhoc-scrollable-menu",[Vo(function(n,e){ui(n.element(),"overflow-y","auto"),ui(n.element(),"-webkit-overflow-scrolling","touch"),tf.register(n.element())}),No(function(n){Ar(n.element(),"overflow-y"),Ar(n.element(),"-webkit-overflow-scrolling"),tf.deregister(n.element())})])])}],items:e,menuBehaviours:Ko([nf.config({initialState:"after",routes:nf.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},uf=function(o){var t,r,n,e,n=(t=o.formats,r=function(){return i},n=rf("Styles",[].concat(pt(t.items,function(n){return of(Xa(n),n.title,n.isSelected(),n.getPreview(),In(t.expansions,Xa(n)))})),r,!1),e=T(t.menus,function(n,e){n=pt(n,function(n){return of(Xa(n),n.title,void 0!==n.isSelected&&n.isSelected(),void 0!==n.getPreview?n.getPreview():"",In(t.expansions,Xa(n)))});return rf(e,n,r,!0)}),n=b(e,vo("styles",n)),{tmenu:Js.tieredData("styles",n,t.expansions)}),i=wc(Js.sketch({dom:{tag:"div",classes:[ri.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(n,e){var t=Vc.getValue(e);return o.handle(e,t.value),Ne.none()},onEscape:function(){return Ne.none()},onOpenMenu:function(n,e){n=gc(n.element());mc(e.element(),n),nf.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var o=gc(n.element()),e=mi(e.element(),'[role="menu"]').getOrDie("hacky"),e=n.getSystem().getByDom(e).getOrDie();mc(t.element(),o),nf.progressTo(e,"before"),nf.jumpTo(t,"after"),nf.progressTo(t,"current")},onCollapseMenu:function(n,e,t){e=mi(e.element(),'[role="menu"]').getOrDie("hacky"),e=n.getSystem().getByDom(e).getOrDie();nf.progressTo(e,"after"),nf.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:n.tmenu,markers:{backgroundMenu:ri.resolve("styles-background-menu"),menu:ri.resolve("styles-menu"),selectedMenu:ri.resolve("styles-selected-menu"),item:ri.resolve("styles-item"),selectedItem:ri.resolve("styles-selected-item")}}));return i.asSpec()},cf=function(n){return M(n,function(n,e){e=Ja(e);return{menus:b(n.menus,e.menus),items:[e.item].concat(n.items),expansions:b(n.expansions,e.expansions)}},{menus:{},expansions:{},items:[]})},af={expand:cf},sf=function(o,n){function r(n){return function(){return o.formatter.match(n)}}function i(n){return function(){return o.formatter.getCssText(n)}}var n=ho(n,"style_formats").getOr(Cs),u=function(n){return pt(n,function(n){if(In(n,"items")){var e=u(n.items);return b(b(n,{isSelected:O(!1),getPreview:O("")}),{items:e})}return In(n,"format")?b(t=n,{isSelected:r(t.format),getPreview:i(t.format)}):(n=iu((t=n).title),t=b(t,{format:n,isSelected:r(n),getPreview:i(n)}),o.formatter.register(n,t),t);var t})};return u(n)},ff=function(t,n,o){var e,r,n=(e=t,n=(r=function(n){return N(n,function(n){return void 0===n.items?!In(n,"format")||e.formatter.canApply(n.format)?[n]:[]:0<r(n.items).length?[n]:[]})})(n=n),af.expand(n));return uf({formats:n,handle:function(n,e){t.undoManager.transact(function(){Zr.isOn(n)?t.formatter.remove(e):t.formatter.apply(e)}),o()}})},lf=["undo","bold","italic","link","image","bullist","styleselect"],df=function(n){return N(n,function(n){return(a(n)?df:Qa)(n)})},mf=function(o,r){function e(){return ff(r,m,function(){r.fire("scrollIntoView")})}var n=function(n){return function(){return Ic.forToolbarCommand(r,n)}},t=function(n){return function(){return Ic.forToolbarStateCommand(r,n)}},i=function(n,e,t){return function(){return Ic.forToolbarStateAction(r,n,e,t)}},u=n("undo"),c=n("redo"),a=t("bold"),s=t("italic"),f=t("underline"),l=n("removeformat"),d=i("unlink","link",function(){r.execCommand("unlink",null,!1)}),t=i("unordered-list","ul",function(){r.execCommand("InsertUnorderedList",null,!1)}),n=i("ordered-list","ol",function(){r.execCommand("InsertOrderedList",null,!1)}),m=sf(r,r.settings),i=function(n,e){return{isSupported:function(){return n.forall(function(n){return In(r.buttons,n)})},sketch:e}};return{undo:i(Ne.none(),u),redo:i(Ne.none(),c),bold:i(Ne.none(),a),italic:i(Ne.none(),s),underline:i(Ne.none(),f),removeformat:i(Ne.none(),l),link:i(Ne.none(),function(){return e=o,t=r,Ic.forToolbarStateAction(t,"link","link",function(){var n=ks(e,t);e.setContextToolbar(n),ss(t,function(){e.focusToolbar()}),cs.query(t).each(function(n){t.selection.select(n.dom())})});var e,t}),unlink:i(Ne.none(),d),image:i(Ne.none(),function(){return ea(r)}),bullist:i(Ne.some("bullist"),t),numlist:i(Ne.some("numlist"),n),fontsizeselect:i(Ne.none(),function(){return e=r,n={onChange:function(n){$c.apply(e,n)},getInitialValue:function(){return $c.get(e)}},pc(o,"font-size",function(){return bc(n)});var e,n}),forecolor:i(Ne.none(),function(){return Hc(o,r)}),styleselect:i(Ne.none(),function(){return Ic.forToolbar("style-formats",function(n){r.fire("toReading"),o.dropup().appear(e,Zr.on,n)},Ko([Zr.config({toggleClass:ri.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Kr.config({channels:En([ti(Vr.orientationChanged(),Zr.off),ti(Vr.dropupDismissed(),Zr.off)])})]))})}},gf=function(n,t){var n=Za(n),o={};return N(n,function(n){var e=!In(o,n)&&In(t,n)&&t[n].isSupported()?[t[n].sketch()]:[];return o[n]=!0,e})},pf=function(n,e,t,o){n.dom().removeEventListener(e,t,o)},hf=O(!0),vf=rs,yf=function(o,e){var n=jt.fromDom(o),r=null,t=ts(n,"orientationchange",function(){clearInterval(r);var n=rs(o);e.onChange(n),i(function(){e.onReady(n)})}),i=function(n){clearInterval(r);var e=o.innerHeight,t=0;r=setInterval(function(){e!==o.innerHeight?(clearInterval(r),n(Ne.some(o.innerHeight))):20<t&&(clearInterval(r),n(Ne.none())),t++},50)};return{onAdjustment:i,destroy:function(){t.unbind()}}},bf=function(n){var e=Tt.detect().os.isiOS(),t=rs(n).isPortrait();return e&&!t?n.screen.height:n.screen.width};function wf(n){return void 0===(n=n.raw()).touches||1!==n.touches.length?Ne.none():Ne.some(n.touches[0])}function xf(t){var o,r,i,u=tr(Ne.none()),c=(o=function(n){u.set(Ne.none()),t.triggerEvent(Mt(),n)},r=400,i=null,{cancel:function(){null!==i&&(f.clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i=f.setTimeout(function(){o.apply(null,n),i=null},r)}}),a=En([{key:Le(),value:function(e){return wf(e).each(function(n){c.cancel();n={x:O(n.clientX),y:O(n.clientY),target:e.target};c.schedule(e),u.set(Ne.some(n))}),Ne.none()}},{key:Pe(),value:function(n){return c.cancel(),wf(n).each(function(o){u.get().each(function(n){var e,t;e=o,t=n,n=Math.abs(e.clientX-t.x()),t=Math.abs(e.clientY-t.y()),(5<n||5<t)&&u.set(Ne.none())})}),Ne.none()}},{key:$e(),value:function(e){c.cancel();return u.get().filter(function(n){return un(n.target(),e.target())}).map(function(n){return t.triggerEvent(It(),e)})}}]);return{fireIfReady:function(e,n){return ho(a,n).bind(function(n){return n(e)})}}}var Tf=function(t){var e=xf({triggerEvent:function(n,e){t.onTapContent(e)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return ts(t.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return ts(t.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}},Sf=6<=Tt.detect().os.version.major,Of=function(t,e,o){function r(n){return!un(n.start(),n.finish())||n.soffset()!==n.foffset()}function n(){var n=t.doc().dom().hasFocus()&&t.getSelection().exists(r);o.getByDom(e).each(!0===(n||ar(u).filter(function(n){return"input"===q(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd}))?Zr.on:Zr.off)}var i=Tf(t),u=cn(e),c=[ts(t.body(),"touchstart",function(n){t.onTouchContent(),i.fireTouchstart(n)}),i.onTouchmove(),i.onTouchend(),ts(e,"touchstart",function(n){t.onTouchToolstrip()}),t.onToReading(function(){cr(t.body())}),t.onToEditing(S),t.onScrollToCursor(function(n){n.preventDefault(),t.getCursorBox().each(function(n){var e=t.win(),n=n.top()>e.innerHeight||n.bottom()>e.innerHeight?n.bottom()-e.innerHeight+50:0;0!=n&&e.scrollTo(e.pageXOffset,e.pageYOffset+n)})})].concat(!0==Sf?[]:[ts(jt.fromDom(t.win()),"blur",function(){o.getByDom(e).each(Zr.off)}),ts(u,"select",n),ts(t.doc(),"selectionchange",n)]);return{destroy:function(){I(c,function(n){n.unbind()})}}},kf=function(n,e){e=parseInt(be(n,e),10);return isNaN(e)?0:e};function Cf(n){return"img"===q(n)?1:(e=n,ol.getOption(e).fold(function(){return Jt(n).length},function(n){return n.length}));var e}function Ef(n,e,t){var o,r,n=n.document.createRange();return o=n,e.fold(function(n){o.setStartBefore(n.dom())},function(n,e){o.setStart(n.dom(),e)},function(n){o.setStartAfter(n.dom())}),r=n,t.fold(function(n){r.setEndBefore(n.dom())},function(n,e){r.setEnd(n.dom(),e)},function(n){r.setEndAfter(n.dom())}),n}function Df(n,e,t,o,r){return(n=n.document.createRange()).setStart(e.dom(),t),n.setEnd(o.dom(),r),n}function If(n){return{left:O(n.left),top:O(n.top),right:O(n.right),bottom:O(n.bottom),width:O(n.width),height:O(n.height)}}function Af(n,e,t){return e(jt.fromDom(t.startContainer),t.startOffset,jt.fromDom(t.endContainer),t.endOffset)}function Mf(n,e){var r,t,e=(r=n,e.match({domRange:function(n){return{ltr:O(n),rtl:Ne.none}},relative:function(n,e){return{ltr:k(function(){return Ef(r,n,e)}),rtl:k(function(){return Ne.some(Ef(r,e,n))})}},exact:function(n,e,t,o){return{ltr:k(function(){return Df(r,n,e,t,o)}),rtl:k(function(){return Ne.some(Df(r,t,o,n,e))})}}}));return(t=(e=e).ltr()).collapsed?e.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return al.rtl(jt.fromDom(n.endContainer),n.endOffset,jt.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return Af(0,al.ltr,t)}):Af(0,al.ltr,t)}function Ff(n,e){var t=q(n);return"input"===t?il.after(n):D(["br","img"],t)?0===e?il.before(n):il.after(n):il.on(n,e)}function Rf(n,e,t,o){var r,i,u,c,a=(i=e,u=t,c=o,(a=cn(r=n).dom().createRange()).setStart(r.dom(),i),a.setEnd(u.dom(),c),a),o=un(n,t)&&e===o;return a.collapsed&&!o}function Bf(n,e,t,o,r){var i,r=Df(n,e,t,o,r);n=n,i=r,Ne.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(i)})}function Vf(f,n){return Mf(f,n).match({ltr:function(n,e,t,o){Bf(f,n,e,t,o)},rtl:function(e,t,o,r){var n,i,u,c,a,s=f.getSelection();if(s.setBaseAndExtent)s.setBaseAndExtent(e.dom(),t,o.dom(),r);else if(s.extend)try{i=e,u=t,c=o,a=r,(n=s).collapse(i.dom(),u),n.extend(c.dom(),a)}catch(n){Bf(f,o,r,e,t)}else Bf(f,o,r,e,t)}})}function Nf(n,e,t,o,r){r=function(n,e,t,o){e=Ff(n,e),o=Ff(t,o);return cl.relative(e,o)}(e,t,o,r),Vf(n,r)}function _f(n){var e=jt.fromDom(n.anchorNode),t=jt.fromDom(n.focusNode);return Rf(e,n.anchorOffset,t,n.focusOffset)?Ne.some(rl.create(e,n.anchorOffset,t,n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),n=n.getRangeAt(n.rangeCount-1);return Ne.some(rl.create(jt.fromDom(e.startContainer),e.startOffset,jt.fromDom(n.endContainer),n.endOffset))}return Ne.none()}(n)}function jf(n){return Ne.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(_f)}function Hf(n,e){var i,n=Mf(i=n,e).match({ltr:function(n,e,t,o){var r=i.document.createRange();return r.setStart(n.dom(),e),r.setEnd(t.dom(),o),r},rtl:function(n,e,t,o){var r=i.document.createRange();return r.setStart(t.dom(),o),r.setEnd(n.dom(),e),r}});return 0<(e=0<(n=(e=n).getClientRects()).length?n[0]:e.getBoundingClientRect()).width||0<e.height?Ne.some(e).map(If):Ne.none()}function zf(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:O(2),height:n.height}}function Lf(n){return{left:O(n.left),top:O(n.top),right:O(n.right),bottom:O(n.bottom),width:O(n.width),height:O(n.height)}}function Pf(n,e){ve(n,ll,e)}function $f(n){return{top:O(n.top()),bottom:O(n.top()+n.height())}}function Wf(n,e){return e=kf(e,ll),(n=n.innerHeight)<e?Ne.some(e-n):Ne.none()}function Uf(n){return Ne.some(jt.fromDom(n.dom().contentWindow.document.body))}function Gf(n){return Ne.some(jt.fromDom(n.dom().contentWindow.document))}function qf(n){return Ne.from(n.dom().contentWindow)}function Yf(n){return qf(n).bind(jf)}function Kf(n){return n.getFrame()}function Xf(n,e,t,o){return n[t].getOrThunk(function(){return function(n){return ts(e,o,n)}})}function Jf(n){return{left:O(n.left),top:O(n.top),right:O(n.right),bottom:O(n.bottom),width:O(n.width),height:O(n.height)}}function Qf(t,o){var r=null;return{cancel:function(){null!==r&&(f.clearTimeout(r),r=null)},throttle:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];null!==r&&f.clearTimeout(r),r=f.setTimeout(function(){t.apply(null,n),r=null},o)}}}function Zf(n){return"true"===be(n,El)?0<(e=n).dom().scrollLeft||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(e):0<(n=n).dom().scrollTop||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(n);var e}var nl,el,tl,ol=(nl=Ut,el="text",{get:function(n){if(!nl(n))throw new Error("Can only get "+el+" value of a "+el+" node");return tl(n).getOr("")},getOption:tl=function(n){return nl(n)?Ne.from(n.dom().nodeValue):Ne.none()},set:function(n,e){if(!nl(n))throw new Error("Can only set raw "+el+" value of a "+el+" node");n.dom().nodeValue=e}}),rl={create:Yt("start","soffset","finish","foffset")},il={before:(n=uo([{before:["element"]},{on:["element","offset"]},{after:["element"]}])).before,on:n.on,after:n.after,cata:function(n,e,t,o){return n.fold(e,t,o)},getStart:function(n){return n.fold(v,v,v)}},ul=uo([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),cl={domRange:ul.domRange,relative:ul.relative,exact:ul.exact,exactFromRange:function(n){return ul.exact(n.start(),n.soffset(),n.finish(),n.foffset())},getWin:function(n){n=n.match({domRange:function(n){return jt.fromDom(n.startContainer)},relative:function(n,e){return il.getStart(n)},exact:function(n,e,t,o){return n}});return an(n)},range:rl.create},al=uo([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),sl=function(n){n=n.getSelection();return void 0!==n&&0<n.rangeCount?function(e){if(e.collapsed){var t=jt.fromDom(e.startContainer);return sn(t).bind(function(n){n=cl.exact(t,e.startOffset,n,Cf(n));return Hf(e.startContainer.ownerDocument.defaultView,n).map(zf).map(H)}).getOr([])}return pt(e.getClientRects(),Lf)}(n.getRangeAt(0)):[]},fl=function(n){n.focus();var e=jt.fromDom(n.document.body);(ar().exists(function(n){return D(["input","textarea"],q(n))})?function(n){setTimeout(function(){n()},0)}:r)(function(){ar().each(cr),ur(e)})},ll="data-"+ri.resolve("last-outer-height"),dl=function(n,r){var e=jt.fromDom(r.document.body),t=ts(jt.fromDom(n),"resize",function(){Wf(n,e).each(function(o){!function(n){n=sl(n);return 0<n.length?Ne.some(n[0]).map($f):Ne.none()}(r).each(function(n){var e,t,e=(e=r,t=o,(n=n).top()>e.innerHeight||n.bottom()>e.innerHeight?Math.min(t,n.bottom()-e.innerHeight+50):0);0!==e&&r.scrollTo(r.pageXOffset,r.pageYOffset+e)})}),Pf(e,n.innerHeight)});Pf(e,n.innerHeight);return{toEditing:function(){fl(r)},destroy:function(){t.unbind()}}},ml={getBody:(qr=function(n,t){return function(e){return e[n].getOrThunk(function(){var n=Kf(e);return function(){return t(n)}})()}})("getBody",Uf),getDoc:qr("getDoc",Gf),getWin:qr("getWin",qf),getSelection:qr("getSelection",Yf),getFrame:Kf,getActiveApi:function(c){var a=Kf(c);return Uf(a).bind(function(u){return Gf(a).bind(function(i){return qf(a).map(function(r){var n=jt.fromDom(i.dom().documentElement),e=c.getCursorBox.getOrThunk(function(){return function(){return jf(r).map(function(n){return cl.exact(n.start(),n.soffset(),n.finish(),n.foffset())}).bind(function(n){return Hf(r,n).orThunk(function(){return jf(r).filter(function(n){return un(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){n=n.start().dom().getBoundingClientRect();return 0<n.width||0<n.height?Ne.some(n).map(Jf):Ne.none()})})})}}),t=c.setSelection.getOrThunk(function(){return function(n,e,t,o){Nf(r,n,e,t,o)}}),o=c.clearSelection.getOrThunk(function(){return function(){r.getSelection().removeAllRanges()}});return{body:O(u),doc:O(i),win:O(r),html:O(n),getSelection:s(Yf,a),setSelection:t,clearSelection:o,frame:O(a),onKeyup:Xf(c,i,"onKeyup","keyup"),onNodeChanged:Xf(c,i,"onNodeChanged","selectionchange"),onDomChanged:c.onDomChanged,onScrollToCursor:c.onScrollToCursor,onScrollToElement:c.onScrollToElement,onToReading:c.onToReading,onToEditing:c.onToEditing,onToolbarScrollStart:c.onToolbarScrollStart,onTouchContent:c.onTouchContent,onTapContent:c.onTapContent,onTouchToolstrip:c.onTouchToolstrip,getCursorBox:e}})})})}},gl="data-ephox-mobile-fullscreen-style",pl="position:absolute!important;",hl="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;height:100%!important;overflow:visible!important;",vl=Tt.detect().os.isAndroid(),yl=function(n,e){function t(t){return function(n){var e=be(n,"style"),e=void 0===e?"no-styles":e.trim();e===t||(ve(n,gl,e),ve(n,"style",t))}}var o,r=(o="*",fi(n,function(n){return en(n,o)},i)),i=N(r,function(n){var e;return e="*",li(n,function(n){return en(n,e)})}),e=function(n){n=Dr(n,"background-color");return void 0!==n&&""!==n?"background-color:"+n+"!important":"background-color:rgb(255,255,255)!important;"}(e);I(i,t("display:none!important;")),I(r,t(pl+hl+e)),t((!0===vl?"":pl)+hl+e)(n)},bl=function(){var n=on("["+gl+"]");I(n,function(n){var e=be(n,gl);"no-styles"!==e?ve(n,"style",e):xe(n,"style"),xe(n,gl)})},wl=function(){var e=rn("head").getOrDie(),n=rn('meta[name="viewport"]').getOrThunk(function(){var n=jt.fromTag("meta");return ve(n,"name","viewport"),Qt(e,n),n}),t=be(n,"content");return{maximize:function(){ve(n,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){null!=t&&0<t.length?ve(n,"content",t):ve(n,"content","user-scalable=yes")}}},xl=function(e,n){var t=wl(),o=ba(),r=ba();return{enter:function(){n.hide(),Ee(e.container,ri.resolve("fullscreen-maximized")),Ee(e.container,ri.resolve("android-maximized")),t.maximize(),Ee(e.body,ri.resolve("android-scroll-reload")),o.set(dl(e.win,ml.getWin(e.editor).getOrDie("no"))),ml.getActiveApi(e.editor).each(function(n){yl(e.container,n.body()),r.set(Of(n,e.toolstrip,e.alloy))})},exit:function(){t.restore(),n.show(),De(e.container,ri.resolve("fullscreen-maximized")),De(e.container,ri.resolve("android-maximized")),bl(),De(e.body,ri.resolve("android-scroll-reload")),r.clear(),o.clear()}}},Tl=function(n,e){var t,o,r,i=wc(ds.sketch({dom:Ec('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:Ko([Zr.config({toggleClass:ri.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),u=(t=n,o=200,r=null,{cancel:function(){null!==r&&(f.clearTimeout(r),r=null)},throttle:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];null===r&&(r=f.setTimeout(function(){t.apply(null,n),r=null},o))}});return ds.sketch({dom:Ec('<div class="${prefix}-disabled-mask"></div>'),components:[ds.sketch({dom:Ec('<div class="${prefix}-content-container"></div>'),components:[kc.sketch({dom:Ec('<div class="${prefix}-content-tap-section"></div>'),components:[i.asSpec()],action:function(n){u.throttle()},buttonBehaviours:Ko([Zr.config({toggleClass:ri.resolve("mask-tap-icon-selected")})])})]})]})},Sl=To([Gn("editor",[Wn("getFrame"),qn("getBody"),qn("getDoc"),qn("getWin"),qn("getSelection"),qn("setSelection"),qn("clearSelection"),qn("cursorSaver"),qn("onKeyup"),qn("onNodeChanged"),qn("getCursorBox"),Wn("onDomChanged"),Xn("onTouchContent",S),Xn("onTapContent",S),Xn("onTouchToolstrip",S),Xn("onScrollToCursor",O({unbind:S})),Xn("onScrollToElement",O({unbind:S})),Xn("onToEditing",O({unbind:S})),Xn("onToReading",O({unbind:S})),Xn("onToolbarScrollStart",v)]),Wn("socket"),Wn("toolstrip"),Wn("dropup"),Wn("toolbar"),Wn("container"),Wn("alloy"),ko("win",function(n){return cn(n.socket).dom().defaultView}),ko("body",function(n){return jt.fromDom(n.socket.dom().ownerDocument.body)}),Xn("translate",v),Xn("setReadOnly",S),Xn("readOnlyOnInit",O(!0))]),Ol=function(n){var e=Pn("Getting AndroidWebapp schema",Sl,n);ui(e.toolstrip,"width","100%");var t=Ns(Tl(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);n={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};Qt(e.container,t.element());var o=xl(e,n);return{setReadOnly:e.setReadOnly,refreshStructure:S,enter:o.enter,exit:o.exit,destroy:S}},n=O([Xn("shell",!0),Gr("toolbarBehaviours",[qs])]),qr=O([Pu({name:"groups",overrides:function(n){return{behaviours:Ko([qs.config({})])}}})]),kl=Nr({name:"Toolbar",configFields:n(),partFields:qr(),factory:function(e,n,t,o){var r=function(n){return e.shell()?Ne.some(n):lu(n,e,"groups")},n=e.shell()?{behaviours:[qs.config({})],components:[]}:{behaviours:[],components:n};return{uid:e.uid(),dom:e.dom(),components:n.components,behaviours:b(Ko(n.behaviours),tu(e.toolbarBehaviours())),apis:{setGroups:function(n,e){r(n).fold(function(){throw f.console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){qs.set(n,e)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),Gr=O([Wn("items"),Gn("markers",pt(["itemClass"],Wn)),Gr("tgroupBehaviours",[Ru])]),Zo=O([Zo({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),Cl=Nr({name:"ToolbarGroup",configFields:Gr(),partFields:Zo(),factory:function(n,e,t,o){return b({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:b(Ko([Ru.config({mode:"flow",selector:"."+n.markers().itemClass()})]),tu(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),El="data-"+ri.resolve("horizontal-scroll"),Dl={exclusive:function(n,e){return ts(n,"touchmove",function(n){pi(n.target(),e).filter(Zf).fold(function(){n.raw().preventDefault()},S)})},markAsHorizontal:function(n){ve(n,El,"true")}};function Il(){function e(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Ec('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:Ko([fs("adhoc-scrollable-toolbar",!0===n.scrollable?[_o(function(n,e){ui(n.element(),"overflow-x","auto"),Dl.markAsHorizontal(n.element()),tf.register(n.element())})]:[])]),components:[ds.sketch({components:[Cl.parts().items({})]})],markers:{itemClass:ri.resolve("toolbar-group-item")},items:n.items}}function t(){kl.setGroups(o,r.get()),Zr.off(o)}var o=Ns(kl.sketch({dom:Ec('<div class="${prefix}-toolbar"></div>'),components:[kl.parts().groups({})],toolbarBehaviours:Ko([Zr.config({toggleClass:ri.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),Ru.config({mode:"cyclic"})]),shell:!0})),n=Ns(ds.sketch({dom:{classes:[ri.resolve("toolstrip")]},components:[_s(o)],containerBehaviours:Ko([Zr.config({toggleClass:ri.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=tr([]);return{wrapper:O(n),toolbar:O(o),createGroups:function(n){return pt(n,l(Cl.sketch,e))},setGroups:function(n){r.set(n),t()},setContextToolbar:function(n){Zr.on(o),kl.setGroups(o,n)},restoreToolbar:function(){Zr.isOn(o)&&t()},refresh:function(){},focus:function(){Ru.focusIn(o)}}}function Al(n,e){qs.append(n,_s(e))}function Ml(n,e){qs.remove(n,e)}function Fl(e,n){return n.getAnimationRoot().fold(function(){return e.element()},function(n){return n(e)})}function Rl(n){return n.dimension().property()}function Bl(n,e){return n.dimension().getDimension()(e)}function Vl(n,e){n=Fl(n,e),Fa(n,[e.shrinkingClass(),e.growingClass()])}function Nl(n,e){De(n.element(),e.openClass()),Ee(n.element(),e.closedClass()),ui(n.element(),Rl(e),"0px"),Mr(n.element())}function _l(n,e,t){t.setCollapsed(),ui(n.element(),Rl(e),Bl(e,n.element())),Mr(n.element()),t=Fl(n,e),Ee(t,e.shrinkingClass()),Nl(n,e),e.onStartShrink()(n)}function jl(n,e,t){var o=function(n,e){Kl(n,e);var t=Bl(e,n.element());return Nl(n,e),t}(n,e),r=Fl(n,e);Ee(r,e.growingClass()),Kl(n,e),ui(n.element(),Rl(e),o),t.setExpanded(),e.onStartGrow()(n)}function Hl(n,e,t){return n=Fl(n,e),!0===Ae(n,e.growingClass())}function zl(n,e,t){return n=Fl(n,e),!0===Ae(n,e.shrinkingClass())}function Ll(e,t){var o=Ns(ds.sketch({dom:{tag:"div",classes:[ri.resolve("dropup")]},components:[],containerBehaviours:Ko([qs.config({}),Xl.config({closedClass:ri.resolve("dropup-closed"),openClass:ri.resolve("dropup-open"),shrinkingClass:ri.resolve("dropup-shrinking"),growingClass:ri.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){e(),t(),qs.set(n,[])},onGrown:function(n){e(),t()}}),ei(function(n,e){r(S)})])})),r=function(n){f.window.requestAnimationFrame(function(){n(),Xl.shrink(o)})};return{appear:function(n,e,t){!0===Xl.hasShrunk(o)&&!1===Xl.isTransitioning(o)&&f.window.requestAnimationFrame(function(){e(t),qs.set(o,[n()]),Xl.grow(o)})},disappear:r,component:O(o),element:o.element}}function Pl(e,n){var t=Pn("Getting GUI events settings",Ql,n),o=Tt.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],r=xf(t),i=pt(o.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(n){return ts(e,n,function(e){r.fireIfReady(e,n).each(function(n){n&&e.kill()}),t.triggerEvent(n,e)&&e.kill()})}),u=ts(e,"keydown",function(n){var e;t.triggerEvent("keydown",n)?n.kill():!0!==t.stopBackspace||(8!==(e=n).raw().which||D(["input","textarea"],q(e.target())))||n.prevent()}),c=(n=e,o=function(n){t.triggerEvent("focusin",n)&&n.kill()},Jl?os(n,"focus",o):ts(n,"focusin",o)),a=(n=e,o=function(n){t.triggerEvent("focusout",n)&&n.kill(),f.setTimeout(function(){t.triggerEvent(kt(),n)},0)},Jl?os(n,"blur",o):ts(n,"focusout",o)),o=an(e),s=ts(o,"scroll",function(n){t.broadcastEvent(Rt(),n)&&n.kill()});return{unbind:function(){I(i,function(n){n.unbind()}),u.unbind(),c.unbind(),a.unbind(),s.unbind()}}}function $l(n,e){return e=ho(n,"target").map(function(n){return n()}).getOr(e),tr(e)}function Wl(n,o,e,t,r,i){var u,c,n=n(o,t),a=(e=e,r=r,u=tr(!1),c=tr(!1),{stop:function(){u.set(!0)},cut:function(){c.set(!0)},isStopped:u.get,isCut:c.get,event:O(e),setSource:r.set,getSource:r.get});return n.fold(function(){return i.logEventNoHandlers(o,t),Zl.complete()},function(e){var t=e.descHandler();return Oa(t)(a),a.isStopped()?(i.logEventStopped(o,e.element(),t.purpose()),Zl.stopped()):a.isCut()?(i.logEventCut(o,e.element(),t.purpose()),Zl.complete()):sn(e.element()).fold(function(){return i.logNoParent(o,e.element(),t.purpose()),Zl.complete()},function(n){return i.logEventResponse(o,e.element(),t.purpose()),Zl.resume(n)})})}function Ul(n,e,t){var o,r=(e=e,o=tr(!1),{stop:function(){o.set(!0)},cut:S,isStopped:o.get,isCut:O(!1),event:O(e),setSource:i("Cannot set source of a broadcasted event"),getSource:i("Cannot get source of a broadcasted event")});return I(n,function(n){n=n.descHandler();Oa(n)(r)}),r.isStopped()}var Gl=function(n){return Ns(kc.sketch({dom:Ec('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},ql=function(){return Ns(ds.sketch({dom:Ec('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:Ko([qs.config({})])}))},Yl=function(n,e,t,o){(!0===t?er.toAlpha:er.toOmega)(o),(t?Al:Ml)(n,e)},Kl=function(n,e){De(n.element(),e.closedClass()),Ee(n.element(),e.openClass()),Ar(n.element(),Rl(e))},Gr=Object.freeze({grow:function(n,e,t){t.isExpanded()||jl(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&_l(n,e,t)},immediateShrink:function(n,e,t){t.isExpanded()&&(n=n,e=e,t.setCollapsed(),ui(n.element(),Rl(e),Bl(e,n.element())),Mr(n.element()),Vl(n,e),Nl(n,e),e.onStartShrink()(n),e.onShrunk()(n))},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:Hl,isShrinking:zl,isTransitioning:function(n,e,t){return!0===Hl(n,e)||!0===zl(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?_l:jl)(n,e,t)},disableTransitions:Vl}),Zo=Object.freeze({exhibit:function(n,e){var t=e.expanded();return Po(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:vo(e.dimension().property(),"0px")})},events:function(t,o){return Bo([te(Qe(),function(n,e){e.event().raw().propertyName===t.dimension().property()&&(Vl(n,t),o.isExpanded()&&Ar(n.element(),t.dimension().property()),(o.isExpanded()?t.onGrown():t.onShrunk())(n))})])}}),Ur=[Wn("closedClass"),Wn("openClass"),Wn("shrinkingClass"),Wn("growingClass"),qn("getAnimationRoot"),Ur("onShrunk"),Ur("onStartShrink"),Ur("onGrown"),Ur("onStartGrow"),Xn("expanded",!1),Un("dimension",Ao("property",{width:[vr("property","width"),vr("getDimension",function(n){return gc(n)+"px"})],height:[vr("property","height"),vr("getDimension",function(n){return si(n)+"px"})]}))],Xl=pe({fields:Ur,name:"sliding",active:Zo,apis:Gr,state:Object.freeze({init:function(n){var e=tr(n.expanded());return Yo({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:s(e.set,!1),setExpanded:s(e.set,!0),readState:function(){return"expanded: "+e.get()}})}})}),Jl=Tt.detect().browser.isFirefox(),Ql=_n([Ro("triggerEvent"),Ro("broadcastEvent"),Xn("stopBackspace",!0)]),Zl=uo([{stopped:[]},{resume:["element"]},{complete:[]}]),nd=function(e,t,o,n,r,i){return Wl(e,t,o,n,r,i).fold(function(){return!0},function(n){return nd(e,t,o,n,r,i)},function(){return!1})},ed=function(n,e,t,o,r){var i=$l(t,o);return nd(n,e,t,o,i,r)},td=function(n,e,t){return ir(n,function(n){return e(n).isSome()},t).bind(e)},od=Yt("element","descHandler"),rd=function(n,e){return{id:O(n),descHandler:O(e)}};function id(){var i={};return{registerId:function(o,r,n){je(n,function(n,e){var t=void 0!==i[e]?i[e]:{};t[r]=Ms(n,o),i[e]=t})},unregisterId:function(t){je(i,function(n,e){n.hasOwnProperty(t)&&delete n[t]})},filterByType:function(n){return ho(i,n).map(function(n){return ze(n,function(n,e){return rd(e,n)})}).getOr([])},find:function(n,e,t){var o=po(e)(i);return td(t,function(n){return e=o,Ju(t=n).fold(function(){return Ne.none()},function(n){n=po(n);return e.bind(n).map(function(n){return od(t,n)})});var e,t},n)}}}function ud(){function o(n){var e=n.element();return Ju(e).fold(function(){return function(n,e){n=iu(Ku+n);return ve(e,Xu,n),n}("uid-",n.element())},function(n){return n})}var r=id(),i={},u=function(n){Ju(n.element()).each(function(n){i[n]=void 0,r.unregisterId(n)})};return{find:function(n,e,t){return r.find(n,e,t)},filter:function(n){return r.filterByType(n)},register:function(n){var e=o(n);In(i,e)&&function(n,e){var t=i[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+mr(t.element())+"\nCannot use it for: "+mr(n.element())+"\nThe conflicting element is"+(Y(t.element())?" ":" not ")+"already in the DOM");u(n)}(n,e);var t=[n];r.registerId(t,e,n.events()),i[e]=n},unregister:u,getById:function(n){return po(n)(i)}}}var cd=function(t){function o(e){return sn(t.element()).fold(function(){return!0},function(n){return un(e,n)})}function a(n,e){return i.find(o,n,e)}function r(e){var n=i.filter(Ct());I(n,function(n){n=n.descHandler();Oa(n)(e)})}var i=ud(),n=Pl(t.element(),{triggerEvent:function(i,u){return pr(i,u.target(),function(n){return e=a,t=i,r=n,n=(o=u).target(),ed(e,t,o,n,r);var e,t,o,r})},broadcastEvent:function(n,e){n=i.filter(n);return Ul(n,e)}}),u=Is({debugInfo:O("real"),triggerEvent:function(e,t,o){pr(e,t,function(n){ed(a,e,o,t,n)})},triggerFocus:function(u,c){Ju(u).fold(function(){ur(u)},function(n){pr(Ot(),u,function(n){var e,t,o,r,i;e=a,t=Ot(),o={originator:O(c),kill:S,prevent:S,target:O(u)},i=n,n=$l(o,r=u),Wl(e,t,o,r,n,i)})})},triggerEscape:function(n,e){u.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return m(n)},getByDom:function(n){return g(n)},build:Ns,addToGui:function(n){s(n)},removeFromGui:function(n){f(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){c(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},isConnected:O(!0)}),e=function(n){n.connect(u),Ut(n.element())||(i.register(n),I(n.components(),e),u.triggerEvent(Ft(),n.element(),{target:O(n.element())}))},c=function(n){Ut(n.element())||(I(n.components(),c),i.unregister(n)),n.disconnect()},s=function(n){pn(t,n)},f=function(n){vn(n)},l=function(n){r({universal:O(!0),data:O(n)})},d=function(n,e){r({universal:O(!1),channels:O(n),data:O(e)})},m=function(n){return i.getById(n).fold(function(){return io.error(new Error('Could not find component with uid: "'+n+'" in system.'))},io.value)},g=function(n){n=Ju(n).getOr("not found");return m(n)};return e(t),{root:O(t),element:t.element,destroy:function(){n.unbind(),Zt(t.element())},add:s,remove:f,getByUid:m,getByDom:g,addToWorld:e,removeFromWorld:c,broadcast:l,broadcastOn:d}},ad=O(ri.resolve("readonly-mode")),sd=O(ri.resolve("edit-mode"));function fd(n){n=Ns(ds.sketch({dom:{classes:[ri.resolve("outer-container")].concat(n.classes)},containerBehaviours:Ko([er.config({alpha:ad(),omega:sd()})])}));return cd(n)}var ld,dd,md,gd,pd=function(n,e){var t=jt.fromTag("input");Er(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),Qt(n,t),ur(t),e(t),Zt(t)},hd=function(n){var e,t=n.getSelection();0<t.rangeCount&&(e=t.getRangeAt(0),(n=n.document.createRange()).setStart(e.startContainer,e.startOffset),n.setEnd(e.endContainer,e.endOffset),t.removeAllRanges(),t.addRange(n))},vd=function(n,e){ar().each(function(n){un(n,e)||cr(n)}),n.focus(),ur(jt.fromDom(n.document.body)),hd(n)},yd={stubborn:function(n,e,t,o){function r(){vd(e,o)}var i=ts(t,"keydown",function(n){D(["input","textarea"],q(n.target()))||r()});return{toReading:function(){pd(n,cr)},toEditing:r,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,e,t,o){function r(){cr(o)}return{toReading:function(){r()},toEditing:function(){vd(e,o)},onToolbarTouch:function(){r()},destroy:S}}},bd=function(t,o,r,i,n){function u(){o.run(function(n){n.refreshSelection()})}function e(n,e){var t=n-i.dom().scrollTop;o.run(function(n){n.scrollIntoView(t,t+e)})}function c(){o.run(function(n){n.clearSelection()})}function a(){t.getCursorBox().each(function(n){e(n.top(),n.height())}),o.run(function(n){n.syncHeight()})}var s=Tf(t),f=Qf(a,300),l=[t.onKeyup(function(){c(),f.throttle()}),t.onNodeChanged(u),t.onDomChanged(f.throttle),t.onDomChanged(u),t.onScrollToCursor(function(n){n.preventDefault(),f.throttle()}),t.onScrollToElement(function(n){n.element(),e(o,i)}),t.onToEditing(function(){o.run(function(n){n.toEditing()})}),t.onToReading(function(){o.run(function(n){n.toReading()})}),ts(t.doc(),"touchend",function(n){un(t.html(),n.target())||un(t.body(),n.target())}),ts(r,"transitionend",function(n){var e;"height"===n.raw().propertyName&&(e=si(r),o.run(function(n){n.setViewportOffset(e)}),u(),a())}),os(r,"touchstart",function(n){var e;o.run(function(n){n.highlightSelection()}),e=n,o.run(function(n){n.onToolbarTouch(e)}),t.onTouchToolstrip()}),ts(t.body(),"touchstart",function(n){c(),t.onTouchContent(),s.fireTouchstart(n)}),s.onTouchmove(),s.onTouchend(),ts(t.body(),"click",function(n){n.kill()}),ts(r,"touchmove",function(){t.onToolbarScrollStart()})];return{destroy:function(){I(l,function(n){n.unbind()})}}};function wd(e,t){var n=e.document,o=jt.fromTag("div");Ee(o,ri.resolve("unfocused-selections")),Qt(jt.fromDom(n.documentElement),o);function r(n){var e=jt.fromTag("span");return Ma(e,[ri.resolve("layer-editor"),ri.resolve("unfocused-selection")]),Er(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e}var i=ts(o,"touchstart",function(n){n.prevent(),vd(e,t),u()}),u=function(){gn(o)};return{update:function(){u();var n=sl(e),n=pt(n,r);mn(o,n)},isActive:function(){return 0<Jt(o).length},destroy:function(){i.unbind(),Zt(o)},clear:u}}function xd(n){f.setTimeout(function(){throw n},0)}function Td(n,e,t){return Math.abs(n-e)<=t?Ne.none():n<e?Ne.some(n+t):Ne.some(n-t)}function Sd(n){var e=vf(n).isPortrait(),t=Hd((t=n).screen.width,t.screen.height),t=e?t.portrait:t.landscape;return(e?n.screen.height:n.screen.width)-n.innerHeight>t?0:t}function Od(n,e){var t=cn(n).dom().defaultView;return si(n)+si(e)-Sd(t)}function kd(n){return kf(n,$d)}function Cd(n,e){var t=be(n,Wd);return Pd.fixed(n,t,e)}function Ed(n,e){return Pd.scroller(n,e)}function Dd(n){var e=kd(n);return("true"===be(n,Ud)?Ed:Cd)(n,e)}function Id(n,e,t){var o=cn(n).dom().defaultView.innerHeight;return ve(n,Gd,o+"px"),o-e-t}function Ad(n){return n=Ir(n,"top").getOr("0"),parseInt(n,10)}function Md(n){return parseInt(n.dom().scrollTop,10)}function Fd(n,e){e=e+Kd(n)+"px",ui(n,"top",e)}dd=Ro={},md=Yt={exports:Ro},gd=ld=void 0,function(n){"object"==typeof dd&&void 0!==md?md.exports=n():"function"==typeof ld&&ld.amd?ld([],n):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=n()}(function(){return function o(r,i,u){function c(e,n){if(!i[e]){if(!r[e]){var t="function"==typeof gd&&gd;if(!n&&t)return t(e,!0);if(a)return a(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}t=i[e]={exports:{}},r[e][0].call(t.exports,function(n){return c(r[e][1][n]||n)},t,t.exports,o,r,i,u)}return i[e].exports}for(var a="function"==typeof gd&&gd,n=0;n<u.length;n++)c(u[n]);return c}({1:[function(n,e,t){var o,r,e=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function c(e){if(o===setTimeout)return setTimeout(e,0);if((o===i||!o)&&setTimeout)return o=setTimeout,setTimeout(e,0);try{return o(e,0)}catch(n){try{return o.call(null,e,0)}catch(n){return o.call(this,e,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:i}catch(n){o=i}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(n){r=u}}();var a,s=[],f=!1,l=-1;function d(){f&&a&&(f=!1,a.length?s=a.concat(s):l=-1,s.length&&m())}function m(){if(!f){var n=c(d);f=!0;for(var e=s.length;e;){for(a=s,s=[];++l<e;)a&&a[l].run();l=-1,e=s.length}a=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(n){try{return r.call(null,e)}catch(n){return r.call(this,e)}}}(n)}}function g(n,e){this.fun=n,this.array=e}function p(){}e.nextTick=function(n){var e=new Array(arguments.length-1);if(1<arguments.length)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];s.push(new g(n,e)),1!==s.length||f||c(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=p,e.addListener=p,e.once=p,e.off=p,e.removeListener=p,e.removeAllListeners=p,e.emit=p,e.prependListener=p,e.prependOnceListener=p,e.listeners=function(n){return[]},e.binding=function(n){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(n){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],2:[function(n,l,e){!function(e){function o(){}function i(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(n,this)}function r(t,o){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,i._immediateFn(function(){var n,e=1===t._state?o.onFulfilled:o.onRejected;if(null!==e){try{n=e(t._value)}catch(n){return void c(o.promise,n)}u(o.promise,n)}else(1===t._state?u:c)(o.promise,t._value)})):t._deferreds.push(o)}function u(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if(n instanceof i)return e._state=3,e._value=n,void a(e);if("function"==typeof t)return void f((o=t,r=n,function(){o.apply(r,arguments)}),e)}e._state=1,e._value=n,a(e)}catch(n){c(e,n)}var o,r}function c(n,e){n._state=2,n._value=e,a(n)}function a(n){2===n._state&&0===n._deferreds.length&&i._immediateFn(function(){n._handled||i._unhandledRejectionFn(n._value)});for(var e=0,t=n._deferreds.length;e<t;e++)r(n,n._deferreds[e]);n._deferreds=null}function s(n,e,t){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.promise=t}function f(n,e){var t=!1;try{n(function(n){t||(t=!0,u(e,n))},function(n){t||(t=!0,c(e,n))})}catch(n){if(t)return;t=!0,c(e,n)}}var n,t;n=this,t=setTimeout,i.prototype.catch=function(n){return this.then(null,n)},i.prototype.then=function(n,e){var t=new this.constructor(o);return r(this,new s(n,e,t)),t},i.all=function(n){var c=Array.prototype.slice.call(n);return new i(function(r,i){if(0===c.length)return r([]);var u=c.length;for(var n=0;n<c.length;n++)!function e(t,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if("function"==typeof o)return void o.call(n,function(n){e(t,n)},i)}c[t]=n,0==--u&&r(c)}catch(n){i(n)}}(n,c[n])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(n){n(e)})},i.reject=function(t){return new i(function(n,e){e(t)})},i.race=function(r){return new i(function(n,e){for(var t=0,o=r.length;t<o;t++)r[t].then(n,e)})},i._immediateFn="function"==typeof e?function(n){e(n)}:function(n){t(n,0)},i._unhandledRejectionFn=function(n){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",n)},i._setImmediateFn=function(n){i._immediateFn=n},i._setUnhandledRejectionFn=function(n){i._unhandledRejectionFn=n},void 0!==l&&l.exports?l.exports=i:n.Promise||(n.Promise=i)}.call(this,n("timers").setImmediate)},{timers:3}],3:[function(a,n,s){!function(n,e){var o=a("process/browser.js").nextTick,t=Function.prototype.apply,r=Array.prototype.slice,i={},u=0;function c(n,e){this._id=n,this._clearFn=e}s.setTimeout=function(){return new c(t.call(setTimeout,window,arguments),clearTimeout)},s.setInterval=function(){return new c(t.call(setInterval,window,arguments),clearInterval)},s.clearTimeout=s.clearInterval=function(n){n.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},s.enroll=function(n,e){clearTimeout(n._idleTimeoutId),n._idleTimeout=e},s.unenroll=function(n){clearTimeout(n._idleTimeoutId),n._idleTimeout=-1},s._unrefActive=s.active=function(n){clearTimeout(n._idleTimeoutId);var e=n._idleTimeout;0<=e&&(n._idleTimeoutId=setTimeout(function(){n._onTimeout&&n._onTimeout()},e))},s.setImmediate="function"==typeof n?n:function(n){var e=u++,t=!(arguments.length<2)&&r.call(arguments,1);return i[e]=!0,o(function(){i[e]&&(t?n.apply(null,t):n.call(null),s.clearImmediate(e))}),e},s.clearImmediate="function"==typeof e?e:function(n){delete i[n]}}.call(this,a("timers").setImmediate,a("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(n,e,t){var o=n("promise-polyfill"),n="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:n.Promise||o}},{"promise-polyfill":2}]},{},[4])(4)});var Rd=Yt.exports.boltExport,Bd=function(n){var t=Ne.none(),e=[],o=function(n){r()?u(n):e.push(n)},r=function(){return t.isSome()},i=function(n){I(n,u)},u=function(e){t.each(function(n){f.setTimeout(function(){e(n)},0)})};return n(function(n){t=Ne.some(n),i(e),e=[]}),{get:o,map:function(t){return Bd(function(e){o(function(n){e(t(n))})})},isReady:r}},Vd={nu:Bd,pure:function(e){return Bd(function(n){n(e)})}},Nd=function(t){function n(n){t().then(n,xd)}return{map:function(n){return Nd(function(){return t().then(n)})},bind:function(e){return Nd(function(){return t().then(function(n){return e(n).toPromise()})})},anonBind:function(n){return Nd(function(){return t().then(function(){return n.toPromise()})})},toLazy:function(){return Vd.nu(n)},toCached:function(){var n=null;return Nd(function(){return n=null===n?t():n})},toPromise:t,get:n}},_d=function(n){return Nd(function(){return new Rd(n)})},jd=function(n){return Nd(function(){return Rd.resolve(n)})},Yt=function(){var s=null;return{animate:function(o,r,n,i,e,t){function u(n){c=!0,e(n)}var c=!1;clearInterval(s);function a(n){clearInterval(s),u(n)}s=setInterval(function(){var t=o();Td(t,r,n).fold(function(){clearInterval(s),u(r)},function(n){var e;i(n,a),c||((e=o())!==n||Math.abs(e-r)>Math.abs(t-r))&&(clearInterval(s),u(r))})},t)}}},Hd=function(t,o){return function(n,e){for(var t=0;t<n.length;t++){var o=e(n[t],t);if(o.isSome())return o}return Ne.none()}([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(n){return e=t<=n.width&&o<=n.height,n=n.keyboard,e?Ne.some(n):Ne.none();var e}).getOr({portrait:o/5,landscape:t/4})},zd=Od,Ld=function(n,e,t){var o=Od(e,t),o=si(e)+si(t)-o;ui(n,"padding-bottom",o+"px")},Pd=uo([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),$d="data-"+ri.resolve("position-y-fixed"),Wd="data-"+ri.resolve("y-property"),Ud="data-"+ri.resolve("scrolling"),Gd="data-"+ri.resolve("last-window-height"),qd=function(n){n=di(n,"["+$d+"]");return pt(n,Dd)},Yd=function(t,o,r,i){function e(){var n,e;l&&(n=si(r),e=si(i),e=Id(t,n,e),ve(t,$d,n+"px"),ui(t,"height",e+"px"),Ld(o,t,i))}var u=cn(t).dom().defaultView,n=function(n){var e=be(n,"style");Er(n,{position:"absolute",top:"0px"}),ve(n,$d,"0px"),ve(n,Wd,"top");return{restore:function(){ve(n,"style",e||""),xe(n,$d),xe(n,Wd)}}}(r),c=si(r),a=si(i),s=function(n,e,t){var o=be(t,"style");tf.register(t),Er(t,{position:"absolute",height:e+"px",width:"100%",top:n+"px"}),ve(t,$d,n+"px"),ve(t,Ud,"true"),ve(t,Wd,"top");return{restore:function(){tf.deregister(t),ve(t,"style",o||""),xe(t,$d),xe(t,Ud),xe(t,Wd)}}}(c,Id(t,c,a),t),f=function(n){var e=be(n,"style");Er(n,{position:"absolute",bottom:"0px"}),ve(n,$d,"0px"),ve(n,Wd,"bottom");return{restore:function(){ve(n,"style",e||""),xe(n,$d),xe(n,Wd)}}}(i),l=!0,a=function(){var n=u.innerHeight;return kf(t,Gd)<n};return Ld(o,t,i),{setViewportOffset:function(n){ve(t,$d,n+"px"),e()},isExpanding:a,isShrinking:d(a),refresh:e,restore:function(){l=!1,n.restore(),s.restore(),f.restore()}}},Kd=kd,Xd=Yt(),Jd="data-"+ri.resolve("last-scroll-top"),Qd=function(t,o,r){return _d(function(n){var e=s(Md,t);Xd.animate(e,o,15,function(n){t.dom().scrollTop=n,ui(t,"top",Ad(t)+15+"px")},function(){t.dom().scrollTop=o,ui(t,"top",r+"px"),n(o)},10)})},Zd=function(o,r){return _d(function(n){var e=s(Md,o);ve(o,Jd,e());var t=Math.abs(r-e()),t=Math.ceil(t/10);Xd.animate(e,r,t,function(n,e){kf(o,Jd)!==o.dom().scrollTop?e(o.dom().scrollTop):(o.dom().scrollTop=n,ve(o,Jd,n))},function(){o.dom().scrollTop=r,ve(o,Jd,r),n(r)},10)})},nm=function(r,i){return _d(function(n){function e(n){ui(r,"top",n+"px")}var t=s(Ad,r),o=Math.abs(i-t()),o=Math.ceil(o/10);Xd.animate(t,i,o,e,function(){e(i),n(i)},10)})},em=function(e,t,o){var r=cn(e).dom().defaultView;return _d(function(n){Fd(e,o),Fd(t,o),r.scrollTo(0,o),n(o)})};function tm(u,n){return n(function(o){var r=[],i=0;0===u.length?o([]):I(u,function(n,e){var t;n.get((t=e,function(n){r[t]=n,++i>=u.length&&o(r)}))})})}function om(n,o){return n.fold(function(n,e,t){return ui(n,e,o+(t=t)+"px"),jd(t)},function(n,e){return function(n,e,t){e+=t,t=Ir(n,"top").getOr(t),t=e-parseInt(t,10),t=n.dom().scrollTop+t;return Qd(n,t,e)}(n,o,e)})}function rm(e,t,n,o,r,i){var u,c,a=(u=function(n){return em(e,t,n)},c=tr(Vd.pure({})),{start:function(e){var n=Vd.nu(function(n){return u(e).get(n)});c.set(n)},idle:function(n){c.get().get(function(){n()})}}),s=Qf(function(){a.idle(function(){um(n,o.pageYOffset).get(function(){var n;(n=sl(i),Ne.from(n[0]).bind(function(n){var e=n.top()-t.dom().scrollTop;return e>o.innerHeight+5||e<-5?Ne.some({top:O(e),bottom:O(e+n.height())}):Ne.none()})).each(function(n){t.dom().scrollTop=t.dom().scrollTop+n.top()}),a.start(0),r.refresh()})})},1e3),f=ts(jt.fromDom(o),"scroll",function(){o.pageYOffset<0||s.throttle()});return um(n,o.pageYOffset).get(v),{unbind:f.unbind}}var im=function(n,e,t,o,r){t=zd(e,t),n=s(hd,n);t<o||t<r?Zd(e,e.dom().scrollTop-t+r).get(n):o<0&&Zd(e,e.dom().scrollTop+o).get(n)},um=function(n,e){n=qd(n),n=pt(n,function(n){return om(n,e)});return tm(n,_d)},cm=function(n){var t=n.cWin(),e=n.ceBody(),o=n.socket(),r=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),c=n.keyboardType(),a=n.outerWindow(),s=n.dropup(),f=Yd(o,e,r,s),l=c(n.outerBody(),t,Gt(),u,r,i),d=yf(a,{onChange:S,onReady:f.refresh});d.onAdjustment(function(){f.refresh()});var m=ts(jt.fromDom(a),"resize",function(){f.isExpanding()&&f.refresh()}),g=rm(r,o,n.outerBody(),a,f,t),p=wd(t,u),h=function(){p.clear()};return{toEditing:function(){l.toEditing(),h()},toReading:function(){l.toReading()},onToolbarTouch:function(n){l.onToolbarTouch(n)},refreshSelection:function(){p.isActive()&&p.update()},clearSelection:h,highlightSelection:function(){p.update()},scrollIntoView:function(n,e){im(t,o,s,n,e)},updateToolbarPadding:S,setViewportOffset:function(n){f.setViewportOffset(n),nm(o,n).get(v)},syncHeight:function(){ui(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:f.refresh,destroy:function(){f.restore(),d.destroy(),g.unbind(),m.unbind(),l.destroy(),p.destroy(),pd(Gt(),cr)}}},am=function(o,n){var r=wl(),i=wa(),u=wa(),c=ba(),a=ba();return{enter:function(){n.hide();var t=jt.fromDom(f.document);ml.getActiveApi(o.editor).each(function(n){i.set({socketHeight:Ir(o.socket,"height"),iframeHeight:Ir(n.frame(),"height"),outerScroll:f.document.body.scrollTop}),u.set({exclusives:Dl.exclusive(t,"."+tf.scrollable())}),Ee(o.container,ri.resolve("fullscreen-maximized")),yl(o.container,n.body()),r.maximize(),ui(o.socket,"overflow","scroll"),ui(o.socket,"-webkit-overflow-scrolling","touch"),ur(n.body());var e=nn(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);c.set(cm(e({cWin:n.win(),ceBody:n.body(),socket:o.socket,toolstrip:o.toolstrip,toolbar:o.toolbar,dropup:o.dropup.element(),contentElement:n.frame(),cursor:S,outerBody:o.body,outerWindow:o.win,keyboardType:yd.stubborn,isScrolling:function(){return u.get().exists(function(n){return n.socket.isScrolling()})}}))),c.run(function(n){n.syncHeight()}),a.set(bd(n,c,o.toolstrip,o.socket,o.dropup))})},refreshStructure:function(){c.run(function(n){n.refreshStructure()})},exit:function(){r.restore(),a.clear(),c.clear(),n.show(),i.on(function(n){n.socketHeight.each(function(n){ui(o.socket,"height",n)}),n.iframeHeight.each(function(n){ui(o.editor.getFrame(),"height",n)}),f.document.body.scrollTop=n.scrollTop}),i.clear(),u.on(function(n){n.exclusives.unbind()}),u.clear(),De(o.container,ri.resolve("fullscreen-maximized")),bl(),tf.deregister(o.toolbar),Ar(o.socket,"overflow"),Ar(o.socket,"-webkit-overflow-scrolling"),cr(o.editor.getFrame()),ml.getActiveApi(o.editor).each(function(n){n.clearSelection()})}}},sm=function(n){var e=Pn("Getting IosWebapp schema",Sl,n);ui(e.toolstrip,"width","100%"),ui(e.container,"position","relative");var t=Ns(Tl(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var n={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}},o=am(e,n);return{setReadOnly:e.setReadOnly,refreshStructure:o.refreshStructure,enter:o.enter,exit:o.exit,destroy:S}};function fm(n,e,t){n.system().broadcastOn([Vr.formatChanged()],{command:e,state:t})}var lm=tinymce.util.Tools.resolve("tinymce.EditorManager"),dm=function(n){n=ho(n.settings,"skin_url").fold(function(){return lm.baseURL+"/skins/lightgray"},function(n){return n});return{content:n+"/content.mobile.min.css",ui:n+"/skin.mobile.min.css"}},mm=function(o,n){var e=_e(n.formatter.get());I(e,function(e){n.formatter.formatChanged(e,function(n){fm(o,e,n)})}),I(["ul","ol"],function(t){n.selection.selectorChanged(t,function(n,e){fm(o,t,n)})})},gm=(O(["x-small","small","medium","large","x-large"]),function(n){function e(){n._skinLoaded=!0,n.fire("SkinLoaded")}return function(){n.initialized?e():n.on("init",e)}}),pm=O("toReading"),hm=O("toEditing");Rr.add("mobile",function(T){return{getNotificationManagerImpl:function(){return{open:O({progressBar:{value:S},close:S}),close:S,reposition:S,getArgs:v}},renderUI:function(n){var e=dm(T);!1===T.settings.skin==!1?(T.contentCSS.push(e.content),Fr.DOM.styleSheetLoader.load(e.ui,gm(T))):gm(T)();function t(){T.fire("scrollIntoView")}var o,r,i,u,c,a,s,f,l,d,m,g=jt.fromTag("div"),p=Tt.detect().os.isAndroid()?(e=t,a=fd({classes:[ri.resolve("android-container")]}),s=Il(),f=ba(),l=Gl(f),d=ql(),e=Ll(S,e),a.add(s.wrapper()),a.add(d),a.add(e.component()),{system:O(a),element:a.element,init:function(n){f.set(Ol(n))},exit:function(){f.run(function(n){n.exit(),qs.remove(d,l)})},setToolbarGroups:function(n){n=s.createGroups(n);s.setGroups(n)},setContextToolbar:function(n){n=s.createGroups(n);s.setContextToolbar(n)},focusToolbar:function(){s.focus()},restoreToolbar:function(){s.restoreToolbar()},updateMode:function(n){Yl(d,l,n,a.root())},socket:O(d),dropup:O(e)}):(h=t,o=fd({classes:[ri.resolve("ios-container")]}),r=Il(),i=ba(),u=Gl(i),c=ql(),h=Ll(function(){i.run(function(n){n.refreshStructure()})},h),o.add(r.wrapper()),o.add(c),o.add(h.component()),{system:O(o),element:o.element,init:function(n){i.set(sm(n))},exit:function(){i.run(function(n){qs.remove(c,u),n.exit()})},setToolbarGroups:function(n){n=r.createGroups(n);r.setGroups(n)},setContextToolbar:function(n){n=r.createGroups(n);r.setContextToolbar(n)},focusToolbar:function(){r.focus()},restoreToolbar:function(){r.restoreToolbar()},updateMode:function(n){Yl(c,u,n,o.root())},socket:O(c),dropup:O(h)}),h=jt.fromDom(n.targetNode);ln(h,g),h=g,m=p.system(),Qt(h,m.element()),h=Jt(m.element()),I(h,function(n){m.getByDom(n).each(eo)});function v(n,e,t,o){!1===o&&T.selection.collapse(),t=x(n,e,t),p.setToolbarGroups(!0===o?t.readOnly:t.main),T.setMode(!0===o?"readonly":"design"),T.fire((!0===o?pm:hm)()),p.updateMode(o)}function y(n,e){return T.on(n,e),{unbind:function(){T.off(n)}}}var b=n.targetNode.ownerDocument.defaultView,w=yf(b,{onChange:function(){p.system().broadcastOn([Vr.orientationChanged()],{width:bf(b)})},onReady:S}),x=function(n,e,t){n=n.get();return{readOnly:n.backToMask.concat(e.get()),main:n.backToMask.concat(t.get())}};return T.on("init",function(){p.init({editor:{getFrame:function(){return jt.fromDom(T.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:S}},onToReading:function(n){return y(pm(),n)},onToEditing:function(n){return y(hm(),n)},onScrollToCursor:function(e){T.on("scrollIntoView",function(n){e(n)});return{unbind:function(){T.off("scrollIntoView"),w.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){var n=jt.fromDom(T.editorContainer.querySelector("."+ri.resolve("toolbar")));sr(n).bind(function(n){return p.system().getByDom(n).toOption()}).each(W),p.restoreToolbar(),e()},onTapContent:function(n){var e=n.target();"img"===q(e)?(T.selection.select(e.dom()),n.kill()):"a"===q(e)&&p.system().getByDom(jt.fromDom(T.editorContainer)).each(function(n){er.isAlpha(n)&&Br(e.dom())})}},container:jt.fromDom(T.editorContainer),socket:jt.fromDom(T.contentAreaContainer),toolstrip:jt.fromDom(T.editorContainer.querySelector("."+ri.resolve("toolstrip"))),toolbar:jt.fromDom(T.editorContainer.querySelector("."+ri.resolve("toolbar"))),dropup:p.dropup(),alloy:p.system(),translate:S,setReadOnly:function(n){v(c,u,i,n)},readOnlyOnInit:function(){return!1}});var e=function(){p.dropup().disappear(function(){p.system().broadcastOn([Vr.dropupDismissed()],{})})},n={label:"The first group",scrollable:!1,items:[Ic.forToolbar("back",function(){T.selection.collapse(),p.exit()},{})]},t={label:"Back to read only",scrollable:!1,items:[Ic.forToolbar("readonly-back",function(){v(c,u,i,!0)},{})]},o=mf(p,T),r=gf(T.settings,o),o={label:"The extra group",scrollable:!1,items:[]},i=tr([{label:"the action group",scrollable:!0,items:r},o]),u=tr([{label:"The read only mode group",scrollable:!0,items:[]},o]),c=tr({backToMask:[n],backToReadOnly:[t]});mm(p,T)}),T.on("remove",function(){p.exit()}),T.on("detach",function(){var e,n;e=p.system(),n=Jt(e.element()),I(n,function(n){e.getByDom(n).each(no)}),Zt(e.element()),p.system().destroy(),Zt(g)}),{iframeContainer:p.socket().element().dom(),editorContainer:p.element().dom()}}}})}(window);