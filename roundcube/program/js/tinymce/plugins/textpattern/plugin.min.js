!function(i){"use strict";var e=function(t){var n=t,t=function(){return n};return{get:t,set:function(t){n=t},clone:function(){return e(n)}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager");function a(t){return function(){return t}}var n,f=a(!1),s=a(!0),u=(n={fold:function(t,n){return t()},is:f,isSome:f,isNone:s,getOr:o,getOrThunk:r,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:o,orThunk:r,map:A=function(){return u},each:function(){},bind:A,exists:f,forall:s,filter:A,equals:n=function(t){return t.isNone()},equals_:n,toArray:function(){return[]},toString:a("none()")},Object.freeze&&Object.freeze(n),n);function r(t){return t()}function o(t){return t}function c(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var a=t[r];n(a,r)&&e.push(a)}return e}function l(t){return w(t,"start")&&w(t,"end")}function d(t){return!w(t,"end")&&!w(t,"replacement")}function g(t){return w(t,"replacement")}function m(t){return function(t,n){t=N.call(t,0);return t.sort(n),t}(t,function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1})}function h(t){return{inlinePatterns:m(c(t,l)),blockPatterns:m(c(t,d)),replacementPatterns:c(t,g)}}function p(t){var n,t=(w(n=t,t="textpattern_patterns")?S.from(n[t]):S.none()).getOr(j);return h(t)}function v(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(0===n.indexOf(r.start)&&(!r.end||n.lastIndexOf(r.end)===n.length-r.end.length))return r}}function y(t,n,e){if(!1!==n.collapsed){var r=n.startContainer,o=r.data,a=!0===e?1:0;if(3===r.nodeType){e=function(t,n,e,r){for(var o,a,i,f,s=0;s<t.length;s++)if(void 0!==(o=t[s]).end&&(a=o,i=e,f=r,n.substr(i-a.end.length-f,a.end.length)===a.end)&&0<e-r-(a=o).end.length-a.start.length)return o}(t,o,n.startOffset,a);if(void 0!==e){n=o.lastIndexOf(e.end,n.startOffset-a),a=o.lastIndexOf(e.start,n-e.end.length),n=o.indexOf(e.end,a+e.start.length);if(-1!==a){o=i.document.createRange();o.setStart(r,a),o.setEnd(r,n+e.end.length);o=v(t,o.toString());if(!(void 0===e||o!==e||r.data.length<=e.start.length+e.end.length))return{pattern:e,startOffset:a,endOffset:n}}}}}}function O(t){return t&&3===t.nodeType}function P(t,n,e){var r=t.dom.createRng();r.setStart(n,e),r.setEnd(n,e),t.selection.setRng(r)}function x(o,a,i,f){var s=M.isArray(i.pattern.format)?i.pattern.format:[i.pattern.format];if(0!==M.grep(s,function(t){t=o.formatter.get(t);return t&&t[0].inline}).length)return o.undoManager.transact(function(){var t,n,e,r;t=a,n=i.pattern,e=i.endOffset,r=i.startOffset,(t=0<r?t.splitText(r):t).splitText(e-r+n.end.length),t.deleteData(0,n.start.length),t.deleteData(t.data.length-n.end.length,n.end.length),a=t,f&&o.selection.setCursorLocation(a.nextSibling,1),s.forEach(function(t){o.formatter.apply(t,{},a)})}),a}function T(n,t,e){var r=n.selection.getRng();return S.from(y(t,r,e)).map(function(t){return x(n,r.startContainer,t,e)})}function b(i,t,f){var n=i.selection.getRng(),s=n.startContainer;n.collapsed&&O(s)&&!function(t,n,e){for(var r=0;r<t.length;r++){var o=e.lastIndexOf(t[r].start,n);if(-1!==o)return S.some({pattern:t[r],startOffset:o})}return S.none()}(t,n.startOffset,s.data).each(function(t){var n,e,r,o,a,e=f?S.some((n=s,r=(e=t).startOffset+e.pattern.start.length,e=n.data.slice(r,r+1),n.deleteData(r,1),e)):S.none();o=i,t=t,(a=s).deleteData(t.startOffset,t.pattern.start.length),o.insertContent(t.pattern.replacement),S.from(a.nextSibling).filter(O).each(function(t){t.insertData(0,a.data),o.dom.remove(a)}),e.each(function(t){var n,e,r,o;e=t,r=(n=i).selection.getRng(),o=r.startContainer,O(o)?(t=r.startOffset,o.insertData(t,e),P(n,o,t+e.length)):(e=n.dom.doc.createTextNode(e),r.insertNode(e),P(n,e,e.length))})})}function k(t,n,e){for(var r=0;r<t.length;r++)if(e(t[r],n))return!0}var C,D=function(e){function t(){return o}function n(t){return t(e)}var r=a(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:s,isNone:f,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return D(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:u},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(f,function(t){return n(e,t)})}};return o},S={some:D,none:A,from:function(t){return null==t?u:D(t)}},A=(C="function",function(t){return function(t){if(null===t)return"null";var n=typeof t;return"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n}(t)===C}),N=Array.prototype.slice,R=(A(Array.from)&&Array.from,Object.hasOwnProperty),w=function(t,n){return R.call(t,n)},I=function(n){return{setPatterns:function(t){n.set(h(t))},getPatterns:function(){return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var a=arguments[n],i=0,f=a.length;i<f;i++,o++)r[o]=a[i];return r}(n.get().inlinePatterns,n.get().blockPatterns,n.get().replacementPatterns)}}},j=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],E=tinymce.util.Tools.resolve("tinymce.util.Delay"),q=tinymce.util.Tools.resolve("tinymce.util.VK"),L=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),M=tinymce.util.Tools.resolve("tinymce.util.Tools"),U=function(t,n){var e,r,o;e=t,o=n.replacementPatterns,b(e,o,!1),r=t,o=n.inlinePatterns,T(r,o,!1).each(function(t){P(r,t,t.data.length)}),function(t,n){var e,r,o,a,i,f,s=t.selection,u=t.dom;if(s.isCollapsed()&&(a=u.getParent(s.getStart(),"p"))){for(f=new L(a,a);r=f.next();)if(O(r)){e=r;break}e&&(i=v(n,e.data))&&(a=(u=s.getRng(!0)).startContainer,n=u.startOffset,e===a&&(n=Math.max(0,n-i.start.length)),M.trim(e.data).length!==i.start.length&&(i.format&&(o=t.formatter.get(i.format))&&o[0].block&&(e.deleteData(0,i.start.length),t.formatter.apply(i.format,{},e),u.setStart(a,n),u.collapse(!0),s.setRng(u)),i.cmd&&t.undoManager.transact(function(){e.deleteData(0,i.start.length),t.execCommand(i.cmd)})))}}(t,n.blockPatterns)},_=function(t,n){var e,r,o;e=t,r=n.replacementPatterns,b(e,r,!0),o=t,n=n.inlinePatterns,T(o,n,!0).each(function(t){var n=t.data.slice(-1);/[\u00a0 ]/.test(n)&&(t.deleteData(t.data.length-1,1),n=o.dom.doc.createTextNode(n),o.dom.insertAfter(n,t.parentNode),P(o,n,1))})},z=function(t,n){return k(t,n,function(t,n){return t.charCodeAt(0)===n.charCode})},K=function(t,n){return k(t,n,function(t,n){return t===n.keyCode&&!1===q.modifierPressed(n)})},V=function(n,e){var r=[",",".",";",":","!","?"],o=[32];n.on("keydown",function(t){13!==t.keyCode||q.modifierPressed(t)||U(n,e.get())},!0),n.on("keyup",function(t){K(o,t)&&_(n,e.get())}),n.on("keypress",function(t){z(r,t)&&E.setEditorTimeout(n,function(){_(n,e.get())})})};t.add("textpattern",function(t){var n=e(p(t.settings));return V(t,n),I(n)})}(window);