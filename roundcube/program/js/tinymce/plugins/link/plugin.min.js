!function(o){"use strict";function e(t){return t.target_list}function n(t){return t.rel_list}function i(t){return t.link_class_list}function l(t,e){var n=["noopener"],o=t?t.split(/\s+/):[],t=function(t){return t.filter(function(t){return-1===P.inArray(n,t)})};return(o=e?(e=t(e=o)).length?e.concat(n):n:t(o)).length?(o=o,P.trim(o.sort().join(" "))):null}function a(t,e){return e=e||t.selection.getNode(),E(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")}function r(t){return t&&"A"===t.nodeName&&t.href}function x(t,o,e){var i=function(t,n){return n=n||[],P.each(t,function(t){var e={text:t.text||t.title};t.menu?e.menu=i(t.menu):(e.value=t.value,o&&o(e)),n.push(e)}),n};return i(t,e||[])}function p(e,t,n){var o=e.selection.getRng();H.setEditorTimeout(e,function(){e.windowManager.confirm(t,function(t){e.selection.setRng(o),n(t)})})}function u(l,t){function o(t){var e=i.find("#text");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),i.find("#href").value(t.control.value())}function n(){a||!v||d.text||this.parent().parent().find("#text")[0].value(this.value())}var a,i,e,r,u,c,s,f,d={},m=l.selection,g=l.dom,v=F(m.getContent()),h=q(l);d.text=a=V(l.selection,h),d.href=h?g.getAttrib(h,"href"):"",h?d.target=g.getAttrib(h,"target"):y(l.settings)&&(d.target=b(l.settings)),(m=g.getAttrib(h,"rel"))&&(d.rel=m),(m=g.getAttrib(h,"class"))&&(d.class=m),(m=g.getAttrib(h,"title"))&&(d.title=m),v&&(e={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){d.text=this.value()}}),t&&(r={type:"listbox",label:"Link list",values:x(t,function(t){t.value=l.convertURL(t.value||t.url,"href")},[{text:"None",value:""}]),onselect:o,value:l.convertURL(d.href,"href"),onPostRender:function(){r=this}}),T(l.settings)&&(void 0===_(l.settings)&&w(l,[{text:"None",value:""},{text:"New window",value:"_blank"}]),c={name:"target",type:"listbox",label:"Target",values:x(_(l.settings))}),M(l.settings)&&(u={name:"rel",type:"listbox",label:"Rel",values:x(C(l.settings),function(t){!1===A(l.settings)&&(t.value=z(t.value,"_blank"===d.target))})}),R(l.settings)&&(s={name:"class",type:"listbox",label:"Class",values:x(O(l.settings),function(t){t.value&&(t.textStyle=function(){return l.formatter.getCssText({inline:"a",classes:[t.value]})})})}),N(l.settings)&&(f={name:"title",type:"textbox",label:"Title",value:d.title}),i=l.windowManager.open({title:"Insert link",data:d,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(t){var e=t.meta||{};r&&r.value(l.convertURL(this.value(),"href")),P.each(t.meta,function(t,e){var n=i.find("#"+e);"text"===e?0===a.length&&(n.value(t),d.text=t):n.value(t)}),e.attach&&($={href:this.value(),attach:e.attach}),e.text||n.call(this)},onkeyup:n,onpaste:n,onbeforecall:function(t){t.meta=i.toJSON()}},e,f,function(e){var n=[];if(P.each(l.dom.select("a:not([href])"),function(t){t=t.name||t.id;t&&n.push({text:t,value:"#"+t,selected:-1!==e.indexOf("#"+t)})}),n.length)return n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:o}}(d.href),r,u,c,s],onSubmit:function(t){var e=k(l.settings),n=K(l,$),o=U(l),i=P.extend({},d,t.data),r=i.href;r?(v&&i.text!==a||delete i.text,0<r.indexOf("@")&&-1===r.indexOf("//")&&-1===r.indexOf("mailto:")?p(l,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(i.href="mailto:"+r),n(i)}):!0===e&&!/^\w+:/i.test(r)||!1===e&&/^\s*www[\.|\d\.]/i.test(r)?p(l,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(i.href="http://"+r),n(i)}):n(i)):o()}})}function c(t,e){return t.dom.getParent(e,"a[href]")}function s(t){return c(t,t.selection.getStart())}function f(t,e){var n;e&&(n=(n=e).getAttribute("data-mce-href")||n.getAttribute("href"),/^#/.test(n)?(n=t.$(n)).length&&t.selection.scrollIntoView(n[0],!0):L(e.href))}var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),d=tinymce.util.Tools.resolve("tinymce.util.VK"),k=function(t){return"boolean"==typeof t.link_assume_external_targets&&t.link_assume_external_targets},m=function(t){return"boolean"==typeof t.link_context_toolbar&&t.link_context_toolbar},g=function(t){return t.link_list},y=function(t){return"string"==typeof t.default_link_target},b=function(t){return t.default_link_target},_=e,w=function(t,e){t.settings.target_list=e},T=function(t){return!1!==e(t)},C=n,M=function(t){return void 0!==n(t)},O=i,R=function(t){return void 0!==i(t)},N=function(t){return!1!==t.link_title},A=function(t){return"boolean"==typeof t.allow_unsafe_link_target&&t.allow_unsafe_link_target},v=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),h=tinymce.util.Tools.resolve("tinymce.Env"),L=function(t){var e,n;!h.ie||10<h.ie?((e=o.document.createElement("a")).target="_blank",e.href=t,e.rel="noreferrer noopener",(n=o.document.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,o.window,0,0,0,0,0,!1,!1,!1,!1,0,null),e=e,n=n,o.document.body.appendChild(e),e.dispatchEvent(n),o.document.body.removeChild(e)):(e=o.window.open("","_blank"))&&(e.opener=null,(e=e.document).open(),e.write('<meta http-equiv="refresh" content="0; url='+v.DOM.encode(t)+'">'),e.close())},P=tinymce.util.Tools.resolve("tinymce.util.Tools"),E=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},S=function(t,e){var n,o=t.dom.select("img",e)[0];o&&(n=t.dom.getParents(o,"a[href]",e)[0])&&(n.parentNode.insertBefore(o,n),t.dom.remove(n))},I=function(t,e,n){e=t.dom.select("img",e)[0];e&&(n=t.dom.create("a",n),e.parentNode.insertBefore(n,e),n.appendChild(e))},K=function(i,r){return function(o){i.undoManager.transact(function(){var t=i.selection.getNode(),e=a(i,t),n={href:o.href,target:o.target||null,rel:o.rel||null,class:o.class||null,title:o.title||null};M(i.settings)||!1!==A(i.settings)||(n.rel=l(n.rel,"_blank"===n.target)),o.href===r.href&&(r.attach(),r={}),e?(i.focus(),o.hasOwnProperty("text")&&("innerText"in e?e.innerText=o.text:e.textContent=o.text),i.dom.setAttribs(e,n),i.selection.select(e),i.undoManager.add()):E(t)?I(i,t,n):o.hasOwnProperty("text")?i.insertContent(i.dom.createHTML("a",n,i.dom.encode(o.text))):i.execCommand("mceInsertLink",!1,n)})}},U=function(e){return function(){e.undoManager.transact(function(){var t=e.selection.getNode();E(t)?S(e,t):e.execCommand("unlink")})}},D=r,B=function(t){return 0<P.grep(t,r).length},F=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},q=a,V=function(t,e){return(e?e.innerText||e.textContent:t.getContent({format:"text"})).replace(/\uFEFF/g,"")},z=l,H=tinymce.util.Tools.resolve("tinymce.util.Delay"),J=tinymce.util.Tools.resolve("tinymce.util.XHR"),$={},j=function(t){var e,n;n=u,"string"==typeof(t=g((e=t).settings))?J.send({url:t,success:function(t){n(e,JSON.parse(t))}}):"function"==typeof t?t(function(t){n(e,t)}):n(e,t)},G=function(t){return function(){j(t)}},X=function(t){return function(){f(t,s(t))}},Q=function(i){return function(t){var e,n,o;return!!(m(i.settings)&&!function(t){t=t.plugins.contextmenu;return!!t&&t.isContextMenuVisible()}(i)&&D(t)&&3===(o=(n=(e=i.selection).getRng()).startContainer).nodeType&&e.isCollapsed()&&0<n.startOffset&&n.startOffset<o.data.length)}},W=function(o){o.on("click",function(t){var e=c(o,t.target);e&&d.metaKeyPressed(t)&&(t.preventDefault(),f(o,e))}),o.on("keydown",function(t){var e,n=s(o);n&&13===t.keyCode&&(!0===(e=t).altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey)&&(t.preventDefault(),f(o,n))})},Y=function(n){return function(){var e=this;n.on("nodechange",function(t){e.active(!n.readonly&&!!q(n,t.element))})}},Z=function(n){return function(){function t(t){B(t.parents)?e.show():e.hide()}var e=this;B(n.dom.getParents(n.selection.getStart()))||e.hide(),n.on("nodechange",t),e.on("remove",function(){n.off("nodechange",t)})}},tt=function(t){t.addCommand("mceLink",G(t))},et=function(t){t.addShortcut("Meta+K","",G(t))},nt=function(t){t.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:G(t),onpostrender:Y(t)}),t.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:U(t),onpostrender:Y(t)}),t.addContextToolbar&&t.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:X(t)})},ot=function(t){t.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:X(t),onPostRender:Z(t),prependToContext:!0}),t.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:G(t),stateSelector:"a[href]",context:"insert",prependToContext:!0}),t.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:U(t),stateSelector:"a[href]"})},it=function(t){t.addContextToolbar&&t.addContextToolbar(Q(t),"openlink | link unlink")};t.add("link",function(t){nt(t),ot(t),it(t),W(t),tt(t),et(t)})}(window);