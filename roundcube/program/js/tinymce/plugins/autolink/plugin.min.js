!function(){"use strict";function o(e,t){return t<0&&(t=0),3!==e.nodeType||(e=e.data.length)<t&&(t=e),t}function c(e,t,n){1!==t.nodeType||t.hasChildNodes()?e.setStart(t,o(t,n)):e.setStartBefore(t)}function u(e,t,n){1!==t.nodeType||t.hasChildNodes()?e.setEnd(t,o(t,n)):e.setEndAfter(t)}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.Env"),g=function(e){return e.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},h=function(e){return e.getParam("default_link_target","")},i=function(e,t,n){var o,i,r,a,f,s,d=g(e),l=h(e);if("A"!==e.selection.getNode().tagName){if((o=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(a=o.endContainer.previousSibling)){if(!o.endContainer.firstChild||!o.endContainer.firstChild.nextSibling)return;a=o.endContainer.firstChild.nextSibling}if(f=a.length,c(o,a,f),u(o,a,f),o.endOffset<5)return;i=o.endOffset,r=a}else{if(3!==(r=o.endContainer).nodeType&&r.firstChild){for(;3!==r.nodeType&&r.firstChild;)r=r.firstChild;3===r.nodeType&&(c(o,r,0),u(o,r,r.nodeValue.length))}i=1===o.endOffset?2:o.endOffset-1-t}for(a=i;c(o,r,2<=i?i-2:0),u(o,r,1<=i?i-1:0),--i,s=o.toString()," "!==s&&""!==s&&160!==s.charCodeAt(0)&&0<=i-2&&s!==n;);(t=o.toString())===n||" "===t||160===t.charCodeAt(0)?(c(o,r,i),u(o,r,a),i+=1):(0===o.startOffset?c(o,r,0):c(o,r,i),u(o,r,a)),"."===(t=o.toString()).charAt(t.length-1)&&u(o,r,a-1),(t=(t=o.toString().trim()).match(d))&&("www."===t[1]?t[1]="http://www.":/@$/.test(t[1])&&!/^mailto:/.test(t[1])&&(t[1]="mailto:"+t[1]),d=e.selection.getBookmark(),e.selection.setRng(o),e.execCommand("createlink",!1,t[1]+t[2]),l&&e.dom.setAttrib(e.selection.getNode(),"target",l),e.selection.moveToBookmark(d),e.nodeChanged())}},t=function(t){var e;t.on("keydown",function(e){13===e.keyCode&&i(t,-1,"")}),n.ie?t.on("focus",function(){if(!e){e=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(e){}}}):(t.on("keypress",function(e){41===e.keyCode&&i(t,-1,"(")}),t.on("keyup",function(e){32===e.keyCode&&i(t,0,"")}))};e.add("autolink",function(e){t(e)})}();