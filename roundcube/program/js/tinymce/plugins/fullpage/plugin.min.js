!function(){"use strict";function d(e){return t({validate:!1,root_name:"#document"}).parse(e)}function m(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})}var l=function(e){var t=e,e=function(){return t};return{get:e,set:function(e){t=e},clone:function(){return l(t)}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),h=tinymce.util.Tools.resolve("tinymce.util.Tools"),t=tinymce.util.Tools.resolve("tinymce.html.DomParser"),u=tinymce.util.Tools.resolve("tinymce.html.Node"),f=tinymce.util.Tools.resolve("tinymce.html.Serializer"),p=function(e){return e.getParam("fullpage_hide_in_source_view")},i=function(e){return e.getParam("fullpage_default_xml_pi")},r=function(e){return e.getParam("fullpage_default_encoding")},o=function(e){return e.getParam("fullpage_default_font_family")},a=function(e){return e.getParam("fullpage_default_font_size")},c=function(e){return e.getParam("fullpage_default_text_color")},s=function(e){return e.getParam("fullpage_default_title")},g=function(e){return e.getParam("fullpage_default_doctype","<!DOCTYPE html>")},y=d,v=function(e,t){var n=d(t),i={};function l(e,t){return e.attr(t)||""}return i.fontface=o(e),i.fontsize=a(e),7===(t=n.firstChild).type&&(i.xml_pi=!0,(e=/encoding="([^"]+)"/.exec(t.value))&&(i.docencoding=e[1])),(t=n.getAll("#doctype")[0])&&(i.doctype="<!DOCTYPE"+t.value+">"),(t=n.getAll("title")[0])&&t.firstChild&&(i.title=t.firstChild.value),h.each(n.getAll("meta"),function(e){var t,n=e.attr("name"),l=e.attr("http-equiv");n?i[n.toLowerCase()]=e.attr("content"):"Content-Type"===l&&(t=/charset\s*=\s*(.*)\s*/gi.exec(e.attr("content")))&&(i.docencoding=t[1])}),(t=n.getAll("html")[0])&&(i.langcode=l(t,"lang")||l(t,"xml:lang")),i.stylesheets=[],h.each(n.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&i.stylesheets.push(e.attr("href"))}),(t=n.getAll("body")[0])&&(i.langdir=l(t,"dir"),i.style=l(t,"style"),i.visited_color=l(t,"vlink"),i.link_color=l(t,"link"),i.active_color=l(t,"alink")),i},_=function(e,r,t){var o,n,a,l=e.dom;function i(e,t,n){e.attr(t,n||void 0)}function c(e){n.firstChild?n.insert(e,n.firstChild):n.append(e)}o=d(t),(n=o.getAll("head")[0])||(a=o.getAll("html")[0],n=new u("head",1),a.firstChild?a.insert(n,a.firstChild,!0):a.append(n)),a=o.firstChild,r.xml_pi?(t='version="1.0"',r.docencoding&&(t+=' encoding="'+r.docencoding+'"'),7!==a.type&&(a=new u("xml",7),o.insert(a,o.firstChild,!0)),a.value=t):a&&7===a.type&&a.remove(),a=o.getAll("#doctype")[0],r.doctype?(a||(a=new u("#doctype",10),r.xml_pi?o.insert(a,o.firstChild):c(a)),a.value=r.doctype.substring(9,r.doctype.length-1)):a&&a.remove(),a=null,h.each(o.getAll("meta"),function(e){"Content-Type"===e.attr("http-equiv")&&(a=e)}),r.docencoding?(a||((a=new u("meta",1)).attr("http-equiv","Content-Type"),a.shortEnded=!0,c(a)),a.attr("content","text/html; charset="+r.docencoding)):a&&a.remove(),a=o.getAll("title")[0],r.title?(a?a.empty():c(a=new u("title",1)),a.append(new u("#text",3)).value=r.title):a&&a.remove(),h.each("keywords,description,author,copyright,robots".split(","),function(e){for(var t,n=o.getAll("meta"),l=r[e],i=0;i<n.length;i++)if((t=n[i]).attr("name")===e)return void(l?t.attr("content",l):t.remove());l&&((a=new u("meta",1)).attr("name",e),a.attr("content",l),a.shortEnded=!0,c(a))});var s={};return h.each(o.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&(s[e.attr("href")]=e)}),h.each(r.stylesheets,function(e){s[e]||((a=new u("link",1)).attr({rel:"stylesheet",text:"text/css",href:e}),a.shortEnded=!0,c(a)),delete s[e]}),h.each(s,function(e){e.remove()}),(a=o.getAll("body")[0])&&(i(a,"dir",r.langdir),i(a,"style",r.style),i(a,"vlink",r.visited_color),i(a,"link",r.link_color),i(a,"alink",r.active_color),l.setAttribs(e.getBody(),{style:r.style,dir:r.dir,vLink:r.visited_color,link:r.link_color,aLink:r.active_color})),(a=o.getAll("html")[0])&&(i(a,"lang",r.langcode),i(a,"xml:lang",r.langcode)),n.firstChild||n.remove(),(e=f({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(o)).substring(0,e.indexOf("</body>"))},n=function(t,n){var l=v(t,n.get());t.windowManager.open({title:"Document properties",data:l,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(e){e=_(t,h.extend(l,e.data),n.get());n.set(e)}})},b=function(e,t){e.addCommand("mceFullPageProperties",function(){n(e,t)})},x=function(e,t){return h.each(e,function(e){t=t.replace(e,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})}),t},k=function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(e,t){return unescape(t)})},C=h.each,A=function(e){var t,n="",l="";return i(e)&&(n+='<?xml version="1.0" encoding="'+(r(e)||"ISO-8859-1")+'" ?>\n'),n+=g(e),n+="\n<html>\n<head>\n",(t=s(e))&&(n+="<title>"+t+"</title>\n"),(t=r(e))&&(n+='<meta http-equiv="Content-Type" content="text/html; charset='+t+'" />\n'),(t=o(e))&&(l+="font-family: "+t+";"),(t=a(e))&&(l+="font-size: "+t+";"),(t=c(e))&&(l+="color: "+t+";"),n+="</head>\n<body"+(l?' style="'+l+'"':"")+">\n"},w=function(u,f,g){u.on("BeforeSetContent",function(e){var t,n,l,i,r,o,a,c,s,d;n=f,l=g,i=e,s="",d=(t=u).dom,i.selection||(c=x(t.settings.protect,i.content),"raw"===i.format&&n.get()||i.source_view&&p(t)||(-1!==(r=(c=(c=0===c.length&&!i.source_view?h.trim(n.get())+"\n"+h.trim(c)+"\n"+h.trim(l.get()):c).replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(r=c.indexOf(">",r),n.set(m(c.substring(0,r+1))),-1===(e=c.indexOf("</body",r))&&(e=c.length),i.content=h.trim(c.substring(r+1,e)),l.set(m(c.substring(e)))):(n.set(A(t)),l.set("\n</body>\n</html>")),l=y(n.get()),C(l.getAll("style"),function(e){e.firstChild&&(s+=e.firstChild.value)}),(n=l.getAll("body")[0])&&d.setAttribs(t.getBody(),{style:n.attr("style")||"",dir:n.attr("dir")||"",vLink:n.attr("vlink")||"",link:n.attr("link")||"",aLink:n.attr("alink")||""}),d.remove("fullpage_styles"),o=t.getDoc().getElementsByTagName("head")[0],s&&(d.add(o,"style",{id:"fullpage_styles"},s),(n=d.get("fullpage_styles")).styleSheet&&(n.styleSheet.cssText=s)),a={},h.each(o.getElementsByTagName("link"),function(e){"stylesheet"===e.rel&&e.getAttribute("data-mce-fullpage")&&(a[e.href]=e)}),h.each(l.getAll("link"),function(e){var t=e.attr("href");if(!t)return!0;a[t]||"stylesheet"!==e.attr("rel")||d.add(o,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"}),delete a[t]}),h.each(a,function(e){e.parentNode.removeChild(e)})))}),u.on("GetContent",function(e){var t,n,l;t=u,n=f.get(),l=g.get(),(e=e).selection||e.source_view&&p(t)||(e.content=k(h.trim(n)+"\n"+h.trim(e.content)+"\n"+h.trim(l)))})},P=function(e){e.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),e.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"})};e.add("fullpage",function(e){var t=l(""),n=l("");b(e,t),P(e),w(e,t,n)})}();