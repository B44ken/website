!function(t){"use strict";function i(n){return function(){return n}}var r=function(n){var e=n,n=function(){return e};return{get:n,set:function(n){e=n},clone:function(){return r(e)}}},n=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=function(n){return{isEnabled:function(){return n.get()}}},u=function(n,e){return n.fire("VisualChars",{state:e})},c=i(!1),a=i(!0),e=function(){return f},f=(_={fold:function(n,e){return n()},is:c,isSome:c,isNone:a,getOr:l,getOrThunk:s,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:l,orThunk:s,map:e,each:function(){},bind:e,exists:c,forall:a,filter:e,equals:_=function(n){return n.isNone()},equals_:_,toArray:function(){return[]},toString:i("none()")},Object.freeze&&Object.freeze(_),_);function s(n){return n()}function l(n){return n}function d(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t)}function m(n){return n.dom().nodeValue}function N(t,n){var r,o,n=k.filterDescendants(D.fromDom(n),k.isMatch);d(n,function(n){var e=k.replaceWithSpans(t.dom.encode(m(n)));for(o=t.dom.create("div",null,e);r=o.lastChild;)t.dom.insertAfter(r,n.dom());t.dom.remove(n.dom())})}function g(e,n){n=e.dom.select(w.selector,n),d(n,function(n){e.dom.remove(n,1)})}function E(t){return function(n){var e=n.control;t.on("VisualChars",function(n){e.active(n.state)})}}var h,v,T=function(t){function n(){return o}function e(n){return n(t)}var r=i(t),o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:a,isNone:c,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return T(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?o:f},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(c,function(n){return e(t,n)})}};return o},p=function(n){return null==n?f:T(n)},O=(h="function",function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"==e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===h}),y=(Array.prototype.slice,O(Array.from)&&Array.from,function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:i(n)}}),D={fromHtml:function(n,e){e=(e||t.document).createElement("div");if(e.innerHTML=n,!e.hasChildNodes()||1<e.childNodes.length)throw t.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return y(e.childNodes[0])},fromTag:function(n,e){n=(e||t.document).createElement(n);return y(n)},fromText:function(n,e){n=(e||t.document).createTextNode(n);return y(n)},fromDom:y,fromPoint:function(n,e,t){n=n.dom();return p(n.elementFromPoint(e,t)).map(y)}},_=(t.Node.ATTRIBUTE_NODE,t.Node.CDATA_SECTION_NODE,t.Node.COMMENT_NODE,t.Node.DOCUMENT_NODE,t.Node.DOCUMENT_TYPE_NODE,t.Node.DOCUMENT_FRAGMENT_NODE,t.Node.ELEMENT_NODE,t.Node.TEXT_NODE),C=(t.Node.PROCESSING_INSTRUCTION_NODE,t.Node.ENTITY_REFERENCE_NODE,t.Node.ENTITY_NODE,t.Node.NOTATION_NODE,void 0!==t.window?t.window:Function("return this;")(),v=_,function(n){return n.dom().nodeType===v}),_=function(n){var e,t="";for(e in n)t&&(t+=","),t+="span.mce-"+n[e];return t},w={charMap:e={" ":"nbsp","­":"shy"},regExp:(O=function(n,e){var t,r="";for(t in n)r+=t;return new RegExp("["+r+"]",e?"g":"")})(e),regExpGlobal:O(e,!0),selector:_(e),charMapToRegExp:O,charMapToSelector:_},M=function(n){return'<span data-mce-bogus="1" class="mce-'+w.charMap[n]+'">'+n+"</span>"},b=function(n,e){var t=[],n=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r}(n.dom().childNodes,D.fromDom);return d(n,function(n){t=(t=e(n)?t.concat([n]):t).concat(b(n,e))}),t},k={isMatch:function(n){var e=m(n);return C(n)&&void 0!==e&&w.regExp.test(e)},filterDescendants:b,findParentElm:function(n,e){for(;n.parentNode;){if(n.parentNode===e)return n;n=n.parentNode}},replaceWithSpans:function(n){return n.replace(w.regExpGlobal,M)}},S=N,A=g,x=function(n){var e=n.getBody(),t=n.selection.getBookmark(),r=k.findParentElm(n.selection.getNode(),e);g(n,r=void 0!==r?r:e),N(n,r),n.selection.moveToBookmark(t)},P=function(n,e){var t,r=n.getBody(),o=n.selection;e.set(!e.get()),u(n,e.get()),t=o.getBookmark(),(!0===e.get()?S:A)(n,r),o.moveToBookmark(t)},R=function(n,e){n.addCommand("mceVisualChars",function(){P(n,e)})},I=tinymce.util.Tools.resolve("tinymce.util.Delay"),B=function(e,t){var r=I.debounce(function(){x(e)},300);!1!==e.settings.forced_root_block&&e.on("keydown",function(n){!0===t.get()&&(13===n.keyCode?x(e):r())})},U=function(n){return n.getParam("visualchars_default_state",!1)},V=function(e,t){e.on("init",function(){var n=!U(e);t.set(n),P(e,t)})};n.add("visualchars",function(n){var e,t=r(!1);return R(n,t),(e=n).addButton("visualchars",{active:!1,title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:E(e)}),e.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:E(e),selectable:!0,context:"view",prependToContext:!0}),B(n,t),V(n,t),o(t)})}(window);